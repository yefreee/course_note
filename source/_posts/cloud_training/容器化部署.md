根据您提供的链接（典型的技术博客/教程风格）以及提供的ERP容器化部署内容，我为您整理了以下文档。

**设计风格分析：**

* **结构清晰**：采用层级分明的标题（3.1, 3.2...）。
* **实战导向**：命令与配置文件分开展示，代码块高亮。
* **环境明确**：保留了命令提示符（如 `[root@k8s-master-node1 ~]#`），明确操作是在 Master 节点还是 Worker 节点执行。
* **图文并茂**：在关键验证步骤预留图片展示位。

---

# ERP管理系统容器化部署实战

> **发布时间**：2025-12-21  
> **分类**：Cloud Training / 容器化技术  
> **标签**：Docker, Docker-Compose, ERP

## 3.1 ERP管理系统介绍

企业资源计划即 **ERP (Enterprise Resource Planning)**，建立在信息技术基础上，以系统化的管理思想，为企业决策层及员工提供决策运行手段的管理平台。

> **背景知识**：
> ERP 由美国 Gartner Group 公司于1990年提出。它是 MRP II（企业制造资源计划）下一代的制造业系统和资源计划软件。除了MRP II 已有的生产资源计划、制造、财务、销售、采购等功能外，还集成了质量管理、实验室管理、业务流程管理、产品数据管理、存货、分销与运输管理、人力资源管理和定期报告系统。

在我国，ERP 所代表的含义已经被扩大，用于企业的各类软件，已经统统被纳入 ERP 的范畴。它跳出了传统企业边界，从供应链范围去优化企业的资源，是基于网络经济时代的新一代信息系统。它主要用于改善企业业务流程以提高企业核心竞争力。

## 3.2 容器化部署 MariaDB

### （1）基础环境准备

首先在 Master 节点下载软件包并完成解压与镜像导入：

```bash
# 下载并解压资源包
[root@k8s-master-node1 ~]# curl -O http://mirrors.douxuedu.com/competition/ERP.tar.gz
[root@k8s-master-node1 ~]# tar -zxvf ERP.tar.gz

# 导入CentOS基础镜像
[root@k8s-master-node1 ~]# docker load -i ERP/CentOS_7.9.2009.tar
```

### （2）编写 Dockerfile 及相关脚本

切换到 Worker 节点的工作目录，准备构建所需的配置文件。

**1. 编写 yum 源配置文件 `local.repo`**

```ini
[root@k8s-worker-node1 ~]# cd ERP/
[root@k8s-worker-node1 ERP]# vi local.repo

[erp]
name=erp
baseurl=file:///root/yum
gpgcheck=0
enabled=1
```

**2. 编写数据库初始化脚本 `mysql_init.sh`**

```bash
[root@k8s-worker-node1 ERP]# vi mysql_init.sh

#!/bin/bash
mysql_install_db --user=root
mysqld_safe --user=root &
sleep 8
mysqladmin -u root password 'tshoperp'
mysql -uroot -ptshoperp -e "grant all on *.* to 'root'@'%' identified by 'tshoperp'; flush privileges;"
mysql -uroot -ptshoperp -e " create database jsh_erp;use jsh_erp;source /opt/jsh_erp.sql;"
```

**3. 编写 `Dockerfile-mariadb`**

```dockerfile
[root@k8s-worker-node1 ERP]# vi Dockerfile-mariadb

FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rf /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
ENV LC_ALL en_US.UTF-8
RUN yum -y install mariadb-server
COPY jsh_erp.sql /opt/
COPY mysql_init.sh /opt/
RUN bash /opt/mysql_init.sh
EXPOSE 3306
CMD ["mysqld_safe","--user=root"]
```

### （3）构建镜像

在 Master 节点执行镜像构建命令：

```bash
[root@k8s-master-node1 ERP]# docker build -t erp-mysql:v1.0 -f Dockerfile-mariadb .
```

*输出示例：*

```text
[+] Building 0.3s (13/13) FINISHED                             docker:default 
 => [internal] load build definition from Dockerfile-mariadb              0.0s
 ...
 => => naming to docker.io/library/erp-mysql:v1.0                        0.0s
```

## 3.3 容器化部署 Redis

### （1）编写 Dockerfile

Redis 服务需要修改配置文件以允许外部访问并关闭保护模式。

```dockerfile
[root@k8s-worker-node1 ERP]# vi Dockerfile-redis

FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rf /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
RUN yum -y install redis
RUN sed -i 's/127.0.0.1/0.0.0.0/g' /etc/redis.conf && \
    sed -i 's/protected-mode yes/protected-mode no/g' /etc/redis.conf
EXPOSE 6379
CMD ["/usr/bin/redis-server","/etc/redis.conf"]
```

### （2）构建镜像

```bash
[root@k8s-worker-node1 ERP]# docker build -t erp-redis:v1.0 -f Dockerfile-redis .
```

*输出示例：*

```text
[+] Building 14.0s (11/11) FINISHED
 ...
 => => naming to docker.io/library/erp-redis:v1.0                       0.0s
```

## 3.4 容器化部署前端服务 (Nginx)

### （1）编写 Dockerfile

前端服务基于 Nginx 构建，需将静态资源包 `app.tar.gz` 解压至容器内。

```dockerfile
[root@k8s-worker-node1 ERP]# vi Dockerfile-nginx

FROM centos:centos7.9.2009
MAINTAINER Chinaskills
RUN rm -rf /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/
COPY yum /root/yum
RUN yum -y install nginx
COPY nginx/nginx.conf /etc/nginx/nginx.conf
COPY nginx/app.tar.gz /
RUN tar -zxvf /app.tar.gz -C /
RUN /bin/bash -c 'echo init ok'
EXPOSE 80
CMD ["nginx","-g","daemon off;"]
```

### （2）构建镜像

```bash
[root@k8s-worker-node1 ERP]# docker build -t erp-nginx:v1.0 -f Dockerfile-nginx .
```

## 3.5 容器化部署 ERP 后端服务

### （1）编写 Dockerfile

后端服务依赖 Java 环境，需安装 OpenJDK。

```dockerfile
[root@k8s-worker-node1 ERP]# vi Dockerfile-erp

FROM centos:centos7.9.2009
MAINTAINER Chinaskills
COPY app.jar /root
ADD yum /root/yum
RUN rm -rfv /etc/yum.repos.d/*
COPY local.repo /etc/yum.repos.d/local.repo
RUN yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel
EXPOSE 9999
CMD java -jar /root/app.jar
```

### （2）构建镜像

```bash
[root@k8s-worker-node1 ERP]# docker build -t erp-service:v1.0 -f Dockerfile-erp .
```

## 3.6 编排部署 ERP

使用 Docker Compose 对上述四个服务（MySQL, Redis, ERP-Server, Nginx）进行统一编排。

### （1）编写 docker-compose.yaml

```yaml
[root@k8s-master-node1 ERP]# vi docker-compose.yaml

version: '3'
services:
  erp-mysql:
    restart: always
    image: erp-mysql:v1.0
    container_name: erp-mysql
    environment:
      - "MYSQL_DATABASE=jsh_erp"
    ports:
      - 3306:3306
  erp-redis:
    image: erp-redis:v1.0
    container_name: erp-redis
    restart: always
    ports:
      - 6379:6379
    command: redis-server --port 6379 --requirepass tshoperp --appendonly yes

  erp-server:
    restart: always
    image: erp-service:v1.0
    container_name: erp-server
    ports:
      - 9999:9999

  erp-web-ui:
    restart: always
    image: erp-nginx:v1.0
    container_name: erp-web-ui
    ports:
      - 8888:80
```

### （2）启动服务与验证

**启动服务：**

```bash
[root@k8s-worker-node1 ERP]# docker-compose up -d
```

*输出：*

```text
Creating network "erp_default" with the default driver
Creating erp-redis  ... done
Creating erp-mysql  ... done
Creating erp-server ... done
Creating erp-web-ui ... done
```

**查看运行状态：**

```bash
[root@k8s-worker-node1 ERP]# docker-compose ps
```

*状态检查：*

```text
   Name                 Command               State                    Ports                  
----------------------------------------------------------------------------------------------
erp-mysql    mysqld_safe --user=root          Up      0.0.0.0:3306->3306/tcp,:::3306->3306/tcp
erp-redis    redis-server --port 6379 - ...   Up      0.0.0.0:6379->6379/tcp,:::6379->6379/tcp
erp-server   /bin/sh -c java -jar /root ...   Up      0.0.0.0:9999->9999/tcp,:::9999->9999/tcp
erp-web-ui   nginx -g daemon off;             Up      0.0.0.0:8888->80/tcp,:::8888->80/tcp    
```

### （3）访问测试

在浏览器中输入访问地址：`http://<IP地址>:8888`。

**系统登录页：**
![ERP系统登录页面](placeholder-login.png)
*(此处展示ERP系统登录界面截图)*

**登录操作：**

* **用户名**：admin
* **密码**：123456

登录成功后进入系统首页
