<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="理解Nova计算服务Nova计算服务简介Nova 管理虚拟机实例的整个生命周期，包括创建、启动、停止、暂停、恢复和销毁等操作。它提供了丰富的API接口和命令行工具，方便用户进行实例管理和监控。 Nova 根据用户的请求和资源的可用性，通过Nova Scheduler进行资源调度和分配。它会选择合适的物理主机来部署虚拟机实例，以实现资源的优化利用和负载均衡。 Nova需要下列OpenStack服务的">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack实例管理">
<meta property="og:url" content="http://example.com/2023/10/14/private_clouds/6.OpenStack%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name">
<meta property="og:description" content="理解Nova计算服务Nova计算服务简介Nova 管理虚拟机实例的整个生命周期，包括创建、启动、停止、暂停、恢复和销毁等操作。它提供了丰富的API接口和命令行工具，方便用户进行实例管理和监控。 Nova 根据用户的请求和资源的可用性，通过Nova Scheduler进行资源调度和分配。它会选择合适的物理主机来部署虚拟机实例，以实现资源的优化利用和负载均衡。 Nova需要下列OpenStack服务的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vault.taojie.fun:28089/i/2023/10/15/2023-10-15-1697380021.png">
<meta property="article:published_time" content="2023-10-14T11:18:37.000Z">
<meta property="article:modified_time" content="2023-10-16T12:41:47.807Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vault.taojie.fun:28089/i/2023/10/15/2023-10-15-1697380021.png">


<link rel="canonical" href="http://example.com/2023/10/14/private_clouds/6.OpenStack%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/10/14/private_clouds/6.OpenStack%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/","path":"2023/10/14/private_clouds/6.OpenStack实例管理/","title":"OpenStack实例管理"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>OpenStack实例管理 | </title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title"></p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%90%86%E8%A7%A3Nova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.</span> <span class="nav-text">理解Nova计算服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Nova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">Nova计算服务简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nova%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84"><span class="nav-number">1.2.</span> <span class="nav-text">Nova计算服务架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="nav-number">1.3.</span> <span class="nav-text">实例创建流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nova%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">Nova服务安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E4%B8%9A%E4%B8%8E%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="nav-number">2.1.</span> <span class="nav-text">作业与实验环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84Nova%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.2.</span> <span class="nav-text">安装配置控制节点上的Nova服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nova%E7%BB%84%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.3.</span> <span class="nav-text">Nova组件初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E4%B8%8A%E7%9A%84Nova%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.4.</span> <span class="nav-text">安装配置计算节点上的Nova服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E7%8E%B0%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E5%B9%B6%E6%A3%80%E9%AA%8C"><span class="nav-number">2.5.</span> <span class="nav-text">发现计算节点并检验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nova%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">Nova实例管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E5%89%8D%E6%8F%90"><span class="nav-number">3.1.</span> <span class="nav-text">实例创建前提</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%9E%E4%BE%8B%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="nav-number">3.2.</span> <span class="nav-text">虚拟机实例创建流程</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/14/private_clouds/6.OpenStack%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="OpenStack实例管理 | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenStack实例管理
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-14 19:18:37" itemprop="dateCreated datePublished" datetime="2023-10-14T19:18:37+08:00">2023-10-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-16 20:41:47" itemprop="dateModified" datetime="2023-10-16T20:41:47+08:00">2023-10-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="理解Nova计算服务"><a href="#理解Nova计算服务" class="headerlink" title="理解Nova计算服务"></a>理解Nova计算服务</h2><h3 id="Nova计算服务简介"><a href="#Nova计算服务简介" class="headerlink" title="Nova计算服务简介"></a>Nova计算服务简介</h3><p>Nova 管理虚拟机实例的整个生命周期，包括创建、启动、停止、暂停、恢复和销毁等操作。它提供了丰富的API接口和命令行工具，方便用户进行实例管理和监控。</p>
<p>Nova 根据用户的请求和资源的可用性，通过Nova Scheduler进行资源调度和分配。它会选择合适的物理主机来部署虚拟机实例，以实现资源的优化利用和负载均衡。</p>
<p>Nova需要下列OpenStack服务的支持：</p>
<ul>
<li><p>Keystone：为所有的OpenStack服务提供身份管理和认证。</p>
</li>
<li><p>Glance：提供计算用的镜像库。</p>
</li>
<li><p>Neutron：负责配置管理计算实例启动时的虚拟或物理网络连接。</p>
</li>
<li><p>Placement：负责跟踪云中可用的资源库存。</p>
</li>
</ul>
<h3 id="Nova计算服务架构"><a href="#Nova计算服务架构" class="headerlink" title="Nova计算服务架构"></a>Nova计算服务架构</h3><img src="https://vault.taojie.fun:28089/i/2023/10/15/2023-10-15-1697380021.png" alt="1697380021376.png" title="1697380021376.png" />

<ul>
<li><p>DB：用于数据存储的SQL数据库。</p>
</li>
<li><p>API：接收 HTTP 请求、转换命令并通过 oslo.messaging 队列或 HTTP 与其他组件通信的组件。</p>
</li>
<li><p>Scheduler：决定哪个主机获取每个实例。</p>
</li>
<li><p>Compute：管理虚拟机和虚拟机的通信。</p>
</li>
<li><p>Conductor：处理需要协调（构建&#x2F;调整大小）的请求，充当数据库代理，或处理对象转换。</p>
</li>
</ul>
<h3 id="实例创建流程"><a href="#实例创建流程" class="headerlink" title="实例创建流程"></a>实例创建流程</h3><ol>
<li><p>用户发起创建请求：用户通过 Nova API 或控制台发起创建实例的请求，提供所需的实例配置信息，如镜像、规格（flavor）、网络等。</p>
</li>
<li><p>Nova Scheduler 进行资源调度：Nova Scheduler 根据实例的需求和当前资源的可用性，在可用的计算节点中选择最合适的物理主机来部署实例。它考虑诸如资源利用率、负载均衡和亲和性等因素进行决策。</p>
</li>
<li><p>Nova Compute 创建实例：一旦 Nova Scheduler 选择了目标计算节点，它会将创建实例的请求发送给相应的 Nova Compute 节点。Nova Compute 负责与底层的 Hypervisor 进行通信，通过创建虚拟机实例的 API 或命令来执行实际的创建操作。</p>
</li>
<li><p>实例启动和初始化：Nova Compute 在目标计算节点上启动虚拟机实例，并进行初始化配置。这包括分配计算资源、设置网络连接、加载所需的镜像和用户数据等。</p>
</li>
<li><p>实例状态更新：Nova Compute 在实例创建过程中会定期向 Nova Conductor 汇报实例的状态更新。这包括实例的创建进度、IP 地址分配和可用性等信息，以便 Nova Conductor 进行监控和管理。</p>
</li>
</ol>
<h2 id="Nova服务安装"><a href="#Nova服务安装" class="headerlink" title="Nova服务安装"></a>Nova服务安装</h2><h3 id="作业与实验环境"><a href="#作业与实验环境" class="headerlink" title="作业与实验环境"></a>作业与实验环境</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://wxstc.fanya.chaoxing.com/portal">超星网址</a><br><code>快照管理</code>：控制节点选择<code>项目8</code>，计算节点选择<code>5.3.9</code></p>
</blockquote>
<h3 id="安装配置控制节点上的Nova服务"><a href="#安装配置控制节点上的Nova服务" class="headerlink" title="安装配置控制节点上的Nova服务"></a>安装配置<code>控制节点</code>上的Nova服务</h3><ol>
<li><p>安装Nova软件包</p>
<ol>
<li><p>使用<code>yum -y install</code>在控制节点上安装四个软件包：openstack-nova-api openstack-nova-conductor openstack-nova-scheduler openstack-nova-novncproxy</p>
</li>
<li><p>安装<code>openstack-nova-api</code>时会创建名为“nova”的同名用户和用户组，使用以下命令检查：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd |grep nova</span>
nova:x:162:162:OpenStack Nova Daemons:/var/lib/nova:/sbin/nologin
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/group |grep nova</span>
nobody:x:99:nova
nova:x:162:nova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>创建Nova数据库并授权</p>
<ol>
<li><p>进入数据库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p000000</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">9</span>
Server version: <span class="token number">10.3</span>.20-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用<code>CREATE DATABASE</code>命令新建“nova_api”，“nova_cell0”，“nova”三个数据库</p>
</li>
<li><p>使用以下命令进行数据库授权</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_api.* TO <span class="token string">'nova'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_api.* TO <span class="token string">'nova'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="token string">'nova'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="token string">'nova'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova.* TO <span class="token string">'nova'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova.* TO <span class="token string">'nova'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>修改Nova配置文件</p>
<ol>
<li><p>去掉配置文件中的空行</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 备份配置文件</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/nova/nova.conf /etc/nova/nova.bak</span>
<span class="token comment"># 2. 去掉空行</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev '^$|#' /etc/nova/nova.bak > /etc/nova/nova.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置连接“nova”和“nova_api”数据库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>api_database<span class="token punctuation">]</span>
<span class="token assign-left variable">connection</span><span class="token operator">=</span>mysql+pymysql://nova:000000@controller/nova_api
<span class="token punctuation">[</span>database<span class="token punctuation">]</span>
<span class="token assign-left variable">connection</span><span class="token operator">=</span>mysql+pymysql://nova:000000@controller/nova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Keystone组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>api<span class="token punctuation">]</span>
auth_strategy <span class="token operator">=</span> keystone
<span class="token punctuation">[</span>keystone_authtoken<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
memcached_servers <span class="token operator">=</span> controller:11211
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> nova
password <span class="token operator">=</span> 000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Placement组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>placement<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> placement
password <span class="token operator">=</span> 000000
region_name <span class="token operator">=</span> RegionOne<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Glance组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>glance<span class="token punctuation">]</span>
api_servers <span class="token operator">=</span> http://controller:9292<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置锁路径</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oslo_concurrency<span class="token punctuation">]</span>
lock_path <span class="token operator">=</span> /var/lib/nova/tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置消息队列和防火墙</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>DEFAULT<span class="token punctuation">]</span>
enabled_apis <span class="token operator">=</span> osapi_compute,metadata
transport_url <span class="token operator">=</span> rabbit://rabbitmq:000000@controller:5672
my_ip <span class="token operator">=</span> <span class="token number">192.168</span>.10.10
use_neutron <span class="token operator">=</span> <span class="token boolean">true</span>
firewall_driver <span class="token operator">=</span> nova.virt.firewall.NoopFirewallDriver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置VNC连接</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>vnc<span class="token punctuation">]</span>
enabled <span class="token operator">=</span> <span class="token boolean">true</span>
server_listen <span class="token operator">=</span> <span class="token variable">$my_ip</span>
server_proxyclient_address <span class="token operator">=</span> <span class="token variable">$my_ip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>初始化数据库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 同步nova_api数据库</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage api_db sync"</span>
<span class="token comment"># 创建cell1</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1"</span>
<span class="token comment"># 数据库映射</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage cell_v2 map_cell0"</span>
<span class="token comment"># 同步nova数据库</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage db sync"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>验证单元注册</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nova-manage cell_v2 list_cells</span>
+-------+--------------------------------------+----------------------------------------+-------------------------------------------------+----------+
<span class="token operator">|</span>  Name <span class="token operator">|</span>                 UUID                 <span class="token operator">|</span>             Transport URL              <span class="token operator">|</span>               Database Connection               <span class="token operator">|</span> Disabled <span class="token operator">|</span>
+-------+--------------------------------------+----------------------------------------+-------------------------------------------------+----------+
<span class="token operator">|</span> cell0 <span class="token operator">|</span> 00000000-0000-0000-0000-000000000000 <span class="token operator">|</span>                 none:/                 <span class="token operator">|</span> mysql+pymysql://nova:****@controller/nova_cell0 <span class="token operator">|</span>  False   <span class="token operator">|</span>
<span class="token operator">|</span> cell1 <span class="token operator">|</span> 0a7038d1-6f69-46ad-8b3f-bf8cadc831c5 <span class="token operator">|</span> rabbit://rabbitmq:****@controller:5672 <span class="token operator">|</span>    mysql+pymysql://nova:****@controller/nova    <span class="token operator">|</span>  False   <span class="token operator">|</span>
+-------+--------------------------------------+----------------------------------------+-------------------------------------------------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业1：单元注册结果截图</p>
</blockquote>
</li>
</ol>
<h3 id="Nova组件初始化"><a href="#Nova组件初始化" class="headerlink" title="Nova组件初始化"></a>Nova组件初始化</h3><ol>
<li><p>创建Nova用户</p>
<ol>
<li><p>执行<code>source admin-login</code>导入环境变量进行登录</p>
</li>
<li><p>在“default”域中创建用户“nova”，密码为“000000”：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack user create --domain default --password 000000 nova</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> Field               <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> domain_id           <span class="token operator">|</span> default                          <span class="token operator">|</span>
<span class="token operator">|</span> enabled             <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                  <span class="token operator">|</span> 5e2fbfe049194a748f6d040686bef9f5 <span class="token operator">|</span>
<span class="token operator">|</span> name                <span class="token operator">|</span> nova                             <span class="token operator">|</span>
<span class="token operator">|</span> options             <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> password_expires_at <span class="token operator">|</span> None                             <span class="token operator">|</span>
+---------------------+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这里所创建的用户和<code>nova.conf</code>配置文件中的[keystone_authtoken]配置的用户名密码一致</p>
</blockquote>
</li>
<li><p>分配“nova”用户在“project”项目中的“admin”角色</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role add --project project --user nova admin</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
</li>
<li><p>创建Nova服务和端点</p>
<ol>
<li><p>创建名为“nova”，类型为“compute”的服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack service create --name nova compute</span>
+---------+----------------------------------+
<span class="token operator">|</span> Field   <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------+----------------------------------+
<span class="token operator">|</span> enabled <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>      <span class="token operator">|</span> b6028ad5a1e545a992dcdeaff3e0f7a6 <span class="token operator">|</span>
<span class="token operator">|</span> name    <span class="token operator">|</span> nova                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">type</span>    <span class="token operator">|</span> compute                          <span class="token operator">|</span>
+---------+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建服务端点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 公众用户端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne nova public http://controller:8774/v2.1</span>
<span class="token comment"># 2. 内部组件端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne nova internal http://controller:8774/v2.1</span>
<span class="token comment"># 3. admin用户端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>启动控制节点的Nova服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 设置开机启动</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable openstack-nova-api openstack-nova-conductor openstack-nova-scheduler openstack-nova-novncproxy</span>
<span class="token comment"># 2. 设置立即启动</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl start openstack-nova-api openstack-nova-conductor openstack-nova-scheduler openstack-nova-novncproxy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>检查Nova组件的运行</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># netstat -nutpl|grep 877</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8774            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">6531</span>/python2
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8775            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">6531</span>/python2
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::8778                 :::*                    LISTEN      <span class="token number">1035</span>/httpd
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack compute service list</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span> ID <span class="token operator">|</span> Binary         <span class="token operator">|</span> Host       <span class="token operator">|</span> Zone     <span class="token operator">|</span> Status  <span class="token operator">|</span> State <span class="token operator">|</span> Updated At                 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> nova-conductor <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T00:33:33.000000 <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> nova-scheduler <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T00:33:26.000000 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业2：Nova组件运行截图</p>
</blockquote>
</li>
</ol>
<h3 id="安装配置计算节点上的Nova服务"><a href="#安装配置计算节点上的Nova服务" class="headerlink" title="安装配置计算节点上的Nova服务"></a>安装配置<code>计算节点</code>上的Nova服务</h3><ol>
<li><p>安装Nova软件包</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum -y install openstack-nova-compute</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>验证系统内是否有名为“nova”的用户和用户组</p>
</blockquote>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd |grep nova</span>
nova:x:162:162:OpenStack Nova Daemons:/var/lib/nova:/sbin/nologin
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/group |grep nova</span>
nobody:x:99:nova
qemu:x:107:nova
libvirt:x:991:nova
nova:x:162:nova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改Nova配置文件<code>/etc/nova/nova.conf</code></p>
<ol>
<li><p>去掉配置文件中的空行</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 备份配置文件</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/nova/nova.conf /etc/nova/nova.bak</span>
<span class="token comment"># 2. 去掉空行</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev '^$|#' /etc/nova/nova.bak > /etc/nova/nova.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Keystone组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>api<span class="token punctuation">]</span>
auth_strategy <span class="token operator">=</span> keystone
<span class="token punctuation">[</span>keystone_authtoken<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
memcached_servers <span class="token operator">=</span> controller:11211
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> nova
password <span class="token operator">=</span> 000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Placement组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>placement<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> placement
password <span class="token operator">=</span> 000000
region_name <span class="token operator">=</span> RegionOne<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Glance组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>glance<span class="token punctuation">]</span>
api_servers <span class="token operator">=</span> http://controller:9292<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置锁路径</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oslo_concurrency<span class="token punctuation">]</span>
lock_path <span class="token operator">=</span> /var/lib/nova/tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置消息队列和防火墙</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>DEFAULT<span class="token punctuation">]</span>
enabled_apis <span class="token operator">=</span> osapi_compute,metadata
transport_url <span class="token operator">=</span> rabbit://rabbitmq:000000@controller:5672
my_ip <span class="token operator">=</span> <span class="token number">192.168</span>.10.20
use_neutron <span class="token operator">=</span> <span class="token boolean">true</span>
firewall_driver <span class="token operator">=</span> nova.virt.firewall.NoopFirewallDriver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置VNC连接</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>vnc<span class="token punctuation">]</span>
enabled <span class="token operator">=</span> <span class="token boolean">true</span>
server_listen <span class="token operator">=</span> <span class="token number">0.0</span>.0.0
server_proxyclient_address <span class="token operator">=</span> <span class="token variable">$my_ip</span>
novncproxy_base_url <span class="token operator">=</span> http://192.168.10.10:6080/vnc_auto.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置<code>[libvirt]</code>部分，设置虚拟化类型<code>qemu</code></p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>libvirt<span class="token punctuation">]</span>
virt_type <span class="token operator">=</span> qemu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>启动计算节点的Nova服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable libvirtd openstack-nova-compute</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-compute.service to /usr/lib/systemd/system/openstack-nova-compute.service.
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl start libvirtd openstack-nova-compute</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ol>
<h3 id="发现计算节点并检验"><a href="#发现计算节点并检验" class="headerlink" title="发现计算节点并检验"></a>发现计算节点并检验</h3><blockquote>
<p>下面的命令在控制节点执行</p>
</blockquote>
<ol>
<li><p>执行<code>source admin-login</code>导入环境变量登录</p>
</li>
<li><p>发现新的计算节点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>设置<code>/etc/nova/nova.conf</code>配置自动发现计算节点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>scheduler<span class="token punctuation">]</span>
discover_hosts_in_cells_internal <span class="token operator">=</span> <span class="token number">60</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 重启nova-api服务使配置生效</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart openstack-nova-api</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>验证nova模块的状态</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看模块的运行状态</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack compute service list</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span> ID <span class="token operator">|</span> Binary         <span class="token operator">|</span> Host       <span class="token operator">|</span> Zone     <span class="token operator">|</span> Status  <span class="token operator">|</span> State <span class="token operator">|</span> Updated At                 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> nova-conductor <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T01:22:53.000000 <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> nova-scheduler <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T01:22:57.000000 <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> nova-compute   <span class="token operator">|</span> compute    <span class="token operator">|</span> nova     <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T01:22:57.000000 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用状态检测工具验证，应该显示4个success</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nova-status upgrade check</span>
+--------------------------------+
<span class="token operator">|</span> Upgrade Check Results          <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Cells v2                <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Placement API           <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Ironic Flavor Migration <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Cinder API              <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业3：Nova模块检测结果截图</p>
</blockquote>
</li>
</ol>
<h2 id="Nova实例管理"><a href="#Nova实例管理" class="headerlink" title="Nova实例管理"></a>Nova实例管理</h2><h3 id="实例创建前提"><a href="#实例创建前提" class="headerlink" title="实例创建前提"></a>实例创建前提</h3><p>执行以下命令查看所需的前提条件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openstack flavor list       <span class="token comment"># 列出可用的实例类型</span>
openstack image list        <span class="token comment"># 列出可用的镜像</span>
openstack network list      <span class="token comment"># 列出可用的网络</span>
openstack keypair list      <span class="token comment"># 列出可用的密钥对</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后执行实例创建命令<code>openstack server create</code>，具体格式如下：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">openstack server create --flavor &lt;flavor> --image &lt;image> --key-name &lt;key_pair> --network &lt;network> [--security-group &lt;security_group>] [--user-data &lt;user_data>] &lt;instance_name>
命令中的参数说明如下：

--flavor &lt;flavor>：指定虚拟机实例的规格（flavor），例如 m1.small。
--image &lt;image>：指定虚拟机实例的镜像，可以是映像名称、ID或URL。
--key-name &lt;key_pair>：指定用于 SSH 访问虚拟机实例的密钥对的名称。
--network &lt;network>：指定虚拟机实例连接到的网络，可以是网络名称或ID。
--security-group &lt;security_group>（可选）：指定用于虚拟机实例的安全组，可以是安全组名称或ID。
--user-data &lt;user_data>（可选）：指定启动虚拟机实例时要传递给实例的自定义用户数据（通常是启动脚本）。
&lt;instance_name>：指定要创建的虚拟机实例的名称。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命令行实例管理常用命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 列出虚拟机实例</span>
openstack server list
<span class="token comment"># 查看实例的详细信息</span>
openstack server show <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 启动虚拟机实例</span>
openstack server start <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 停止虚拟机实例</span>
openstack server stop <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 重启虚拟机实例</span>
openstack server <span class="token function">reboot</span> <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 调整虚拟机实例的实例类型</span>
openstack server resize <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span> <span class="token parameter variable">--flavor</span> <span class="token operator">&lt;</span>new_flavor<span class="token operator">></span>
<span class="token comment"># 删除虚拟机实例</span>
openstack server delete <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 迁移虚拟机实例到其他计算节点</span>
openstack server migrate <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="虚拟机实例创建流程"><a href="#虚拟机实例创建流程" class="headerlink" title="虚拟机实例创建流程"></a>虚拟机实例创建流程</h3><ol>
<li><p>创建密钥对</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack keypair create test-key</span>
-----BEGIN RSA PRIVATE KEY-----
MIIEpgIBAAKCAQEA4ezhYShGObIS2GsCMyepBz+beVnJbs5ngIkNor2okw2pNcwW
kFVf4XUYgAPk8UgzJWVjlbFzPYfYzmrGO/4DthjpnV9udkahIIn+IsfPajvbWn/n
aOjrncva99YvqpsLOaasaO5fS0k+YLQaWeVzhLW43pndT+e3BRa120msvItqIuK5
Fs4eCtjtAYeYBOlN/AReymXf6m2Et3TIk8tATk4De0q3u7p2TIfGYdbh22HiOWI4
2J1Q9y2sC2Jj/idV9+407iLbMN/CfdVDu6Wm2Z0Ec3z5a3nGqHsRHJwK2eAS8eQD
2AUksTMCBGBQDdgFTXnvXha8pjGz981kAjlYhQIDAQABAoIBAQDU56Z9KLcFKAsa
Z71q97USX57kfPiWs2xWdNGky5ZQ/k63o9yfp9TzYqXz/beCqceJNkLijpdLJPnr
jDPD1V0p/dApvgUa8PRm9aPIowOT2VSdtGsfMmDYE4QGipHg9LtfWPKg8AJdsGhY
OWGb1d9G8PmGzPkClBqlcQFv5b4i7nlkgNlqKMAxTTpYuw8VQ1bcekae1AMX4LJh
hObxjF2jrAwzKnX7oZtWpkKMNohbPoe4FnvPIbmwEWl6P9ewBqCUukGEYIu8C3u0
42nkCEzdjjsD4PQ7sQRABeFM045RVUVbWjWo+JhvnIrJYmpi1vMaqiaKnD+DF2nb
DKvTLNABAoGBAPc/lscQCW95kHvhhxVB3kwwTeUUz5fvMX6kyGfZp0C1oFc1Zp40
tHSdroZW7t0USJNAdPQXeBGmd3feM/8VsR09VOuaJCTTl0vvIq41JtU7jY6lk4a7
dkeomB8Dn8yswccvZ22id7CAsd378VKf3KklZQJiTRNaQwxHTsBVUBjRAoGBAOns
Ey7dHAzmpiv+Ws7UvaBN5Yz4l/9gbMsrpXICnbOGmVAW+WrP4Qloip8SGQLY2Csy
oj47UcdVLPISe0ChgUtzZCMh+u58fY3mpKlkEMnEahX2HommCzCJhwTa9G/lm/Js
I2Fnf+siwVzpeR8ZWbXh7NzZBhq1a67oglMpfjF1AoGBAL2shprHbrWZ6IFgjiR8
l3CTTe6DfI3t7WZeO2+PxYMa0pqUWNjdTeJ4ZL6iSjRHrzVnqVDoADBqKBRI3lK9
7VWlC1SCt1+ZAuQ5270RAW1rdjkMRJSDk0V9zNVeDmUR0sZfU1UD4hYBZHILKSJd
iQYprceaac6C3BS7T2q1B/FBAoGBALY8I/Wua9vhFDPRxAy9z7zC8sIQKNna1Oay
6gEX6KOjiGzMeSKtMDOULeoevz1okX+Vwq+Ypu0TfiBYJY0ERSXyj2CPaF3Cvk1+
EWmley60xbC2PLQflzgI7BbsPOGvjv4dILMRXqZgPSOU/7cqmKkJiO3EZO0JyQpK
OL1w5c7BAoGBALZI9+hh82MuOLLl9cd7EhgiNPos+HI4TZJLAlypd55v9cOIkjr+
olyRV9KLnHZiV086FRihPWbGxXMVg167efPciztS7Qlc+likocWztyIVll++A71M
547dAnIA4iw30MFMzQxs917RbRv++dJkuyvBLULGzMFOjCb48CzvR9q+
-----END RSA PRIVATE KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>其他密钥管理命令</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 列出密钥</span>
openstack keypair list
<span class="token comment"># 查看密钥详细信息</span>
openstack keypair show <span class="token operator">&lt;</span>密钥对名称<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建实例类型</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack flavor create --public test_flavor --id auto --ram 256 --disk 0 --vcpus 1</span>
+----------------------------+--------------------------------------+
<span class="token operator">|</span> Field                      <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+----------------------------+--------------------------------------+
<span class="token operator">|</span> OS-FLV-DISABLED:disabled   <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> OS-FLV-EXT-DATA:ephemeral  <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> disk                       <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                         <span class="token operator">|</span> 205ecf42-35b2-4f79-b928-c56c063cdbc2 <span class="token operator">|</span>
<span class="token operator">|</span> name                       <span class="token operator">|</span> test_flavor                          <span class="token operator">|</span>
<span class="token operator">|</span> os-flavor-access:is_public <span class="token operator">|</span> True                                 <span class="token operator">|</span>
<span class="token operator">|</span> properties                 <span class="token operator">|</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">ram</span>                        <span class="token operator">|</span> <span class="token number">256</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> rxtx_factor                <span class="token operator">|</span> <span class="token number">1.0</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> swap                       <span class="token operator">|</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> vcpus                      <span class="token operator">|</span> <span class="token number">1</span>                                    <span class="token operator">|</span>
+----------------------------+--------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>其他实例类型管理命令</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openstack flavor list
openstack flavor show <span class="token operator">&lt;</span>实例类型ID<span class="token operator">></span>
openstack flavor delete <span class="token operator">&lt;</span>实例类型ID<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建网络</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack network create --share --external --provider-network-type flat --provider-physical-network provider --project admin test_net</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack subnet create --network test_net --subnet-range 192.168.20.0/24 --gateway 192.168.20.2 --allocation-pool start=192.168.20.128,end=192.168.20.140 --dns-nameserver 114.114.114.114 test_subnet</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>创建实例</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack server create --flavor test_flavor --network test_net --key-name test-key --image cirros cirros-VM1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>计算节点</code>免密登录</p>
<ul>
<li>在<code>控制节点</code>使用实例管理命令获取实例的ip地址</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack server show cirror-VM1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>将之前的私钥复制并粘贴到<code>计算节点</code>的<code>/root/.ssh/demo-key.pem</code>，使用ssh命令免密登录</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># chmod 600 ~/.ssh/demo-key.pem</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># ssh -i ~/.ssh/demo-key.pem cirros@192.168.20.130</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>作业4：计算节点免密登录实例截图</p>
</blockquote>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/10/06/private_clouds/5.OpenStack%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/" rel="prev" title="OpenStack镜像管理与制作（二）">
                  <i class="fa fa-chevron-left"></i> OpenStack镜像管理与制作（二）
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
