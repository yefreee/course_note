<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ping命令Linux ping 命令用于检测主机。 执行 ping 指令会使用 ICMP 传输协议，发出要求回应的信息，若远端主机的网络功能没有问题，就会回应该信息，因而得知该主机运作正常。 -d 使用Socket的SO_DEBUG功能。 -c &lt;完成次数&gt; 设置完成要求回应的次数。 -f 极限检测。 -i&lt;间隔秒数&gt; 指定收发信息的间隔时间。 -I&lt;网络界面&amp;gt">
<meta property="og:type" content="article">
<meta property="og:title" content="项目实战集">
<meta property="og:url" content="http://example.com/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/index.html">
<meta property="og:site_name">
<meta property="og:description" content="ping命令Linux ping 命令用于检测主机。 执行 ping 指令会使用 ICMP 传输协议，发出要求回应的信息，若远端主机的网络功能没有问题，就会回应该信息，因而得知该主机运作正常。 -d 使用Socket的SO_DEBUG功能。 -c &lt;完成次数&gt; 设置完成要求回应的次数。 -f 极限检测。 -i&lt;间隔秒数&gt; 指定收发信息的间隔时间。 -I&lt;网络界面&amp;gt">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86%20b1f29f1f66bb4b5791f43d861b5bb655/Untitled.png">
<meta property="article:published_time" content="2023-06-16T13:36:20.000Z">
<meta property="article:modified_time" content="2023-09-03T05:17:06.149Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86%20b1f29f1f66bb4b5791f43d861b5bb655/Untitled.png">


<link rel="canonical" href="http://example.com/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/","path":"2023/06/16/linux_shell/12.项目实战集/","title":"项目实战集"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>项目实战集 | </title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title"></p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ping%E5%91%BD%E4%BB%A4"><span class="nav-number">1.</span> <span class="nav-text">ping命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8A%B6%E6%80%81%E6%A3%80%E6%B5%8B%E8%84%9A%E6%9C%AC"><span class="nav-number">2.</span> <span class="nav-text">服务器状态检测脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx%E6%97%A5%E5%BF%97%E5%8F%82%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">Nginx日志参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xargs%E5%91%BD%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">xargs命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9"><span class="nav-number">4.1.</span> <span class="nav-text">常用选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87cat%E5%91%BD%E4%BB%A4%E7%90%86%E8%A7%A3xargs%E7%94%A8%E6%B3%95"><span class="nav-number">4.2.</span> <span class="nav-text">通过cat命令理解xargs用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95"><span class="nav-number">4.3.</span> <span class="nav-text">常见用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uniq%E5%91%BD%E4%BB%A4"><span class="nav-number">5.</span> <span class="nav-text">uniq命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E6%9C%BA%E9%83%A8%E7%BD%B2MySQL"><span class="nav-number">6.</span> <span class="nav-text">多机部署MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">6.1.</span> <span class="nav-text">实验环境搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E9%80%81%E5%85%AC%E9%92%A5%E5%88%B0%E5%90%84%E4%B8%AA%E4%B8%BB%E6%9C%BA"><span class="nav-number">6.2.</span> <span class="nav-text">推送公钥到各个主机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E6%8E%A8%E9%80%81%E5%85%AC%E9%92%A5"><span class="nav-number">6.3.</span> <span class="nav-text">批量推送公钥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%9C%BA%E9%83%A8%E7%BD%B2MySQL%E8%84%9A%E6%9C%AC"><span class="nav-number">6.4.</span> <span class="nav-text">多机部署MySQL脚本</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="项目实战集 | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          项目实战集
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-16 21:36:20" itemprop="dateCreated datePublished" datetime="2023-06-16T21:36:20+08:00">2023-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h2><p>Linux ping 命令用于检测主机。</p>
<p>执行 ping 指令会使用 ICMP 传输协议，发出要求回应的信息，若远端主机的网络功能没有问题，就会回应该信息，因而得知该主机运作正常。</p>
<pre class="line-numbers language-test" data-language="test"><code class="language-test">-d 使用Socket的SO_DEBUG功能。
-c &lt;完成次数&gt; 设置完成要求回应的次数。
-f 极限检测。
-i&lt;间隔秒数&gt; 指定收发信息的间隔时间。
-I&lt;网络界面&gt; 使用指定的网络接口送出数据包。
-l&lt;前置载入&gt; 设置在送出要求信息之前，先行发出的数据包。
-n 只输出数值。
-p&lt;范本样式&gt; 设置填满数据包的范本样式。
-q 不显示指令执行过程，开头和结尾的相关信息除外。
-r 忽略普通的Routing Table，直接将数据包送到远端主机上。
-R 记录路由过程。
-s&lt;数据包大小&gt; 设置数据包的大小。
-t&lt;存活数值&gt; 设置存活数值TTL的大小。
-v 详细显示指令的执行过程。
-w &lt;deadline&gt; 在 deadline 秒后退出。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="服务器状态检测脚本"><a href="#服务器状态检测脚本" class="headerlink" title="服务器状态检测脚本"></a>服务器状态检测脚本</h2><p>使用for循环判断主机是否存活：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">ip_list</span><span class="token operator">=</span><span class="token string">"192.168.1.1 127.0.0.1 0.0.0.0"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">ip</span> <span class="token keyword">in</span> <span class="token variable">$ip_list</span>
<span class="token keyword">do</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">count</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">do</span>
                <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-w1</span> <span class="token variable">$ip</span> <span class="token operator">&amp;></span>/dev/null
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is ok"</span>
                        <span class="token builtin class-name">break</span>
                <span class="token keyword">fi</span>
        <span class="token keyword">done</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-eq</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is failure"</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用while循环判断主机是否存活：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment">#ip_list="192.168.1.1 127.0.0.1 0.0.0.0"</span>

<span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token function">ip</span>
<span class="token keyword">do</span>
        <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
        <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-le</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">do</span>
                <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-w1</span> <span class="token variable">$ip</span> <span class="token operator">&amp;></span>/dev/null
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is ok"</span>
                        <span class="token builtin class-name">break</span>
                <span class="token keyword">fi</span>
                <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$count<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>
        <span class="token keyword">done</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-eq</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is failure"</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span>ip.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Nginx日志参数"><a href="#Nginx日志参数" class="headerlink" title="Nginx日志参数"></a>Nginx日志参数</h2><table>
<thead>
<tr>
<th>变量名称</th>
<th>变量描述</th>
<th>举例说明</th>
</tr>
</thead>
<tbody><tr>
<td>$remote_addr</td>
<td>客户端地址</td>
<td>113.140.15.90</td>
</tr>
<tr>
<td>$remote_user</td>
<td>客户端用户名称</td>
<td>–</td>
</tr>
<tr>
<td>$time_local</td>
<td>访问时间和时区</td>
<td>18&#x2F;Jul&#x2F;2012:17:00:01 +0800</td>
</tr>
<tr>
<td>$request</td>
<td>请求的URI和HTTP协议</td>
<td>“GET &#x2F;pa&#x2F;img&#x2F;home&#x2F;logo-alipay-t.png HTTP:&#x2F;1.1″</td>
</tr>
<tr>
<td>$http_host</td>
<td>请求地址，即浏览器中你输入的地址（IP或域名）</td>
<td>img.alipay.com10.253.70.103</td>
</tr>
<tr>
<td>$status</td>
<td>HTTP请求状态</td>
<td>200</td>
</tr>
<tr>
<td>$upstream_status</td>
<td>upstream状态</td>
<td>200</td>
</tr>
<tr>
<td>$body_bytes_sent</td>
<td>发送给客户端文件内容大小</td>
<td>547</td>
</tr>
<tr>
<td>$http_referer</td>
<td>跳转来源</td>
<td>“<a target="_blank" rel="noopener" href="https://cashier.alip/ay.com%E2%80%A6/%E2%80%9D">https://cashier.alip/ay.com…/”</a></td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>用户终端代理</td>
<td>“Mozilla&#x2F;4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; GTB7.0; .NET4.0C;</td>
</tr>
<tr>
<td>$ssl_protocol</td>
<td>SSL协议版本</td>
<td>TLSv1</td>
</tr>
<tr>
<td>$ssl_cipher</td>
<td>交换数据中的算法</td>
<td>RC4-SHA</td>
</tr>
<tr>
<td>$upstream_addr</td>
<td>后台upstream的地址，即真正提供服务的主机地址</td>
<td>10.228.35.247:80</td>
</tr>
<tr>
<td>$request_time</td>
<td>整个请求的总时间</td>
<td>0.205</td>
</tr>
<tr>
<td>$upstream_response_time</td>
<td>请求过程中，upstream响应时间</td>
<td>0.002</td>
</tr>
</tbody></table>
<h2 id="xargs命令"><a href="#xargs命令" class="headerlink" title="xargs命令"></a>xargs命令</h2><p><code>xargs</code>是给命令传递参数的一个过滤器，也是组合多个命令的一个工具。</p>
<p><code>xargs</code>可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。</p>
<h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>定界符<span class="token operator">></span>：指定输入项的定界符，默认为换行符。
<span class="token parameter variable">-I</span> <span class="token operator">&lt;</span>占位符<span class="token operator">></span>：指定替代字符串，用于替换命令中的参数位置。
<span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>数量<span class="token operator">></span>：指定每次执行的参数数量。
-t：显示实际执行的命令。
-p：提示用户确认是否执行命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="通过cat命令理解xargs用法"><a href="#通过cat命令理解xargs用法" class="headerlink" title="通过cat命令理解xargs用法"></a>通过<code>cat</code>命令理解<code>xargs</code>用法</h3><ul>
<li><p>原始文件</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@sh:~<span class="token comment"># cat file.txt</span>
file1
file2
file3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过管道符号讲标准输出转换为标准输入传递给cat</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@sh:~<span class="token comment"># cat file.txt|cat</span>
file1
file2
file3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过管道符号和xargs将标准输出转换为参数传递给cat</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@sh:~<span class="token comment"># cat file.txt|xargs cat</span>
cat: file1: No such <span class="token function">file</span> or directory
cat: file2: No such <span class="token function">file</span> or directory
cat: file3: No such <span class="token function">file</span> or directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><ol>
<li><p>查找并打包日志</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"*.log"</span> <span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">tar</span> <span class="token parameter variable">-cvzf</span> log.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>对日志文件进行文字查找</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"*.log"</span> <span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">grep</span> <span class="token parameter variable">-n</span> <span class="token string">"error"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>批量创建目录</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span>  /var/log <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> d <span class="token operator">|</span><span class="token function">xargs</span> <span class="token parameter variable">-I</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token function">mkdir</span> .<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="uniq命令"><a href="#uniq命令" class="headerlink" title="uniq命令"></a>uniq命令</h2><p>Linux uniq命令用于检查及删除文本文件中重复出现的行列，一般与 sort 命令结合使用。</p>
<p>uniq命令可检查文本文件中重复出现的行列。</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-c或--count 在每列旁边显示该行重复出现的次数。
-d或--repeated 仅显示重复出现的行列。
-f&lt;栏位>或--skip-fields=&lt;栏位> 忽略比较指定的栏位。
-s&lt;字符位置>或--skip-chars=&lt;字符位置> 忽略比较指定的字符。
-u或--unique 仅显示出一次的行列。
-w&lt;字符位置>或--check-chars=&lt;字符位置> 指定要比较的字符。
--help 显示帮助。
--version 显示版本信息。
[输入文件] 指定已排序好的文本文件。如果不指定此项，则从标准读取数据；
[输出文件] 指定输出的文件。如果不指定此选项，则将内容显示到标准输出设备（显示终端）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>文本文件包含以下内容：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Copy code
apple
banana
apple
orange
orange
apple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>uniq -c</code>命令来统计重复行的次数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">uniq</span> <span class="token parameter variable">-c</span> data.txt
      <span class="token number">1</span> apple
      <span class="token number">1</span> banana
      <span class="token number">2</span> apple
      <span class="token number">2</span> orange
      <span class="token number">1</span> apple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出的每一行都包含两部分：重复行的次数和该行的内容。在上面的示例中，第一行的<code>apple</code>只出现了一次，第二行的<code>banana</code>只出现了一次，第三行的<code>apple</code>出现了两次，以此类推。</p>
<h2 id="多机部署MySQL"><a href="#多机部署MySQL" class="headerlink" title="多机部署MySQL"></a>多机部署MySQL</h2><h3 id="实验环境搭建"><a href="#实验环境搭建" class="headerlink" title="实验环境搭建"></a>实验环境搭建</h3><ol>
<li><p>配置<code>centos</code>虚拟机网络</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## 配置ip地址和子网掩码</span>
<span class="token function">sudo</span> <span class="token function">ifconfig</span> <span class="token punctuation">[</span>网口名<span class="token punctuation">]</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span>/24
<span class="token comment">## 配置默认网关</span>
<span class="token function">sudo</span> route <span class="token function">add</span> default gw <span class="token punctuation">[</span>网关<span class="token punctuation">]</span>
<span class="token function">ping</span> baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>本项目通过docker搭建实验环境，首先需要在<code>centos7</code>虚拟机中安装<code>docker</code><br>运行以下命令使用官方安装脚本自动安装Docker</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>启动docker服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">docker</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>通过镜像<code>linuxserver/openssh-server</code>创建多个主机</p>
<ol>
<li><p>创建主机1，默认ssh端口号2222，主机名设置为host1，外部ssh端口号2221</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> host1<span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD_ACCESS</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_PASSWORD</span><span class="token operator">=</span>password <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span>demo <span class="token punctuation">\</span>
 <span class="token parameter variable">-p</span> <span class="token number">2221</span>:2222 lscr.io/linuxserver/openssh-server:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建主机2，默认ssh端口号2222，主机名设置为host2，外部ssh端口号2222</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> host2 <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD_ACCESS</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_PASSWORD</span><span class="token operator">=</span>password <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span>demo <span class="token punctuation">\</span>
 <span class="token parameter variable">-p</span> <span class="token number">2222</span>:2222 lscr.io/linuxserver/openssh-server:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建主机3，默认ssh端口号2222，主机名设置为host3，外部ssh端口号2223</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> host3 <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD_ACCESS</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_PASSWORD</span><span class="token operator">=</span>password <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span>demo <span class="token punctuation">\</span>
 <span class="token parameter variable">-p</span> <span class="token number">2223</span>:2222 lscr.io/linuxserver/openssh-server:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>通过<code>sudo docker ps</code>查看容器信息</p>
<p> <img src="/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86%20b1f29f1f66bb4b5791f43d861b5bb655/Untitled.png" alt="Untitled"></p>
</li>
<li><p>容器常用命令</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## 查看当前运行的容器状态</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span>

<span class="token comment">## 停止容器</span>
<span class="token function">sudo</span> <span class="token function">docker</span> stop 容器名

<span class="token comment">## 删除容器</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">rm</span> 容器名

<span class="token comment">## 进入正在运行的容器</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器名 /bin/bash

<span class="token comment">##从容器中退出</span>
exit或者使用快捷键CTRL + p 然后CTRL + q<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过<code>ping -p 2221 localhost</code>验证centos和容器之间的网络</p>
</li>
<li><p>通过<code>ssh -p 2221 demo@localhost</code>验证ssh服务，使用用户名<code>demo</code>和密码<code>password</code>登录容器，在容器内使用exit断开ssh连接。</p>
</li>
</ol>
<h3 id="推送公钥到各个主机"><a href="#推送公钥到各个主机" class="headerlink" title="推送公钥到各个主机"></a>推送公钥到各个主机</h3><ul>
<li><p>ssh密钥登录原理</p>
<p>  我们一般使用 PuTTY 等 SSH 客户端来远程管理 Linux 服务器。但是，一般的密码方式登录，容易有密码被暴力破解的问题。所以，一般我们会将 SSH 的端口设置为默认的 22 以外的端口，或者禁用 root 账户登录。其实，有一个更好的办法来保证安全，而且让你可以放心地用 root 账户从远程登录——那就是通过密钥方式登录。</p>
<p>  密钥形式登录的原理是：利用密钥生成器制作一对密钥——一只公钥和一只私钥。将公钥添加到服务器的某个账户上，然后在客户端利用私钥即可完成认证并登录。</p>
</li>
</ul>
<ol>
<li><code>ssh-keygen</code>制作密钥对</li>
<li><code>ls ~/.ssh</code>查看密钥文件</li>
<li><code>ssh-copy-id -p 2221 demo@localhost</code> 推送公钥到目标主机</li>
<li><code>ssh -p 2221 demo@localhost</code>验证密钥登录</li>
</ol>
<h3 id="批量推送公钥"><a href="#批量推送公钥" class="headerlink" title="批量推送公钥"></a>批量推送公钥</h3><ol>
<li><p>centos虚拟机安装expect工具</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token function">expect</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> <code>expect</code> 是一个用于自动化交互式命令行工具的工具集，它可以用于编写脚本来处理需要与外部程序进行交互的场景。以下是 <code>expect</code> 常用的命令和用法：</p>
<ol>
<li><p><code>spawn</code>：启动一个新的进程并与其进行交互。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">spawn <span class="token function">ssh</span> user@hostname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 上述命令将启动一个 SSH 连接，并与远程主机进行交互。</p>
</li>
<li><p><code>expect</code>：匹配预期的输出或交互，并执行相应的操作。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">expect</span> <span class="token string">"password:"</span>
send <span class="token string">"mypassword<span class="token entity" title="\r">\r</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 上述命令会等待输出中出现 “password:”，然后发送密码。</p>
</li>
<li><p><code>send</code>：向进程发送字符串。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">send <span class="token string">"ls<span class="token entity" title="\r">\r</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 上述命令会发送 “ls” 命令给进程。</p>
</li>
</ol>
</li>
<li><p>批量推送公钥脚本</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">port_list</span><span class="token operator">=</span><span class="token string">"2221 2223"</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"password"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">$port_list</span>
<span class="token keyword">do</span>
        /usr/bin/expect <span class="token parameter variable">-c</span> <span class="token string">"
                spawn ssh-copy-id -p <span class="token variable">$i</span> demo@localhost
                expect &#123;
                <span class="token entity" title="\&quot;">\"</span>*connecting<span class="token entity" title="\&quot;">\"</span> &#123; send <span class="token entity" title="\&quot;">\"</span>yes<span class="token entity" title="\r">\r</span><span class="token entity" title="\&quot;">\"</span>; exp_continue &#125; &#125;
                expect &#123;
                <span class="token entity" title="\&quot;">\"</span>*password<span class="token entity" title="\&quot;">\"</span> &#123; send <span class="token entity" title="\&quot;">\"</span><span class="token variable">$password</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\&quot;">\"</span>; exp_continue &#125; &#125;
                expect eof
                "</span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="多机部署MySQL脚本"><a href="#多机部署MySQL脚本" class="headerlink" title="多机部署MySQL脚本"></a>多机部署MySQL脚本</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">port_list</span><span class="token operator">=</span><span class="token string">"2221 2222 2223"</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"password"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">$port_list</span>
<span class="token keyword">do</span>
        <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-w1</span> <span class="token parameter variable">-p</span> <span class="token variable">$i</span> localhost
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                /usr/bin/expect <span class="token parameter variable">-c</span> <span class="token string">"
                spawn ssh -p <span class="token variable">$i</span> demo@localhost <span class="token entity" title="\&quot;">\"</span>sudo apk add mysql mysql-client<span class="token entity" title="\&quot;">\"</span>      
                expect &#123;
                <span class="token entity" title="\&quot;">\"</span>*password<span class="token entity" title="\&quot;">\"</span> &#123; send <span class="token entity" title="\&quot;">\"</span><span class="token variable">$password</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\&quot;">\"</span>;exp_continue&#125;&#125;
                expect eof
                "</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/06/16/linux_shell/11.%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/" rel="prev" title="系统资源性能瓶颈脚本构建">
                  <i class="fa fa-chevron-left"></i> 系统资源性能瓶颈脚本构建
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/16/c_program/3.%E7%AC%AC%E4%B8%89%E5%91%A8/" rel="next" title="第三周">
                  第三周 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
