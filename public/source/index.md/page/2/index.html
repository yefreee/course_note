<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://example.com/source/index.md/page/2/index.html">
<meta property="og:site_name">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/source/index.md/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"source/index.md/page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title></title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title"></h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Shell初始,编辑器使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:25" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:25+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是Shell"><a href="#什么是Shell" class="headerlink" title="什么是Shell"></a>什么是Shell</h2><p>现在人们使用的操作系统（Windows、Android、iOS等）都带有图形界面，简单直观，容易上手。然而早期的计算机并没有图形界面，人们只能使用烦琐的命令来控制计算机。其实，真正能够控制计算机硬件（CPU、内存、显示器）的只有操作系统内核（Kernel），图形界面和命令行都是架设在用户和内核之间的桥梁，是为了方便用户控制计算机而存在的。由于安全等原因，用户不能直接接触内核，因此需要在用户和内核之间增加“命令解释器”，既能简化用户的操作，又能保障内核的安全。在Linux下的命令解释器叫作“Shell”，它能让用户更加高效、安全、低成本地使用Linux内核。  </p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-18-53-43.png" alt="1.Shell初识，编辑器使用-2023-04-19-18-53-43"></p>
<h2 id="Shell的各种版本"><a href="#Shell的各种版本" class="headerlink" title="Shell的各种版本"></a>Shell的各种版本</h2><ol>
<li>Bourne shell（sh）是Unix系统中最古老的shell，也是现在大多数shell的基础。它的命令行语法较为简单，缺乏一些高级特性，但是在大多数Unix系统中都内置了这个shell，因此可以保证可移植性。尽管Bourne shell已经被多种先进的shell所取代，但它作为shell编程的鼻祖，仍然具有重要的历史和学习价值。</li>
<li>Bourne Again Shell （bash）是Linux操作系统所使用的Shell，它是Bourne Shell的扩展，简称bash。bash与Bourne Shell完全向下兼容，也就是说bash可以兼容相同版本的Bourne Shell。bash在Bourne Shell的基础上增加、增强了很多特性，所以它比Bourne Shell能力更强。</li>
<li>zsh（Z shell）是Bourne shell（sh）的一个增强版本。与bash相比，zsh具有更好的命令补全功能、更好的主题和插件支持、更好的脚本语言、更好的历史命令管理和更好的可定制性。它还有许多其他功能，如自动提示，文件名扩展，别名扩展等。zsh是一种功能强大、易于使用和高度可定制的Shell，适用于任何需要使用命令行的用户。</li>
</ol>
<p><strong>练习</strong>：</p>
<pre class="line-numbers language-bash" data-language="bash"><div class="caption"><span>查看Shell版本、更换默认Shell并生效设置</span></div><code class="language-bash"><span class="token comment">##查看当前Shell版本</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$SHELL</span>
/bin/bash
<span class="token comment">##查看系统当前可用Shell</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/shells
/bin/sh
/bin/bash
/usr/bin/sh
/usr/bin/bash
<span class="token comment">##更换默认Shell</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ chsh <span class="token parameter variable">-s</span> /bin/sh
Changing shell <span class="token keyword">for</span> root.
Shell changed.
<span class="token comment">##退出当前登录状态重新登录</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">logout</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Shell的启动方式和提示符"><a href="#Shell的启动方式和提示符" class="headerlink" title="Shell的启动方式和提示符"></a>Shell的启动方式和提示符</h2><ol>
<li><p>终端上启动<br> Shell会以交互模式启动，提示符会显示在屏幕上，等待用户输入命令。<br> 用户输入命令后，Shell会解释和执行这些命令，并将执行结果输出到终端上。<br> 在终端启动模式下，Shell会自动设置一些环境变量，如PATH等，以便用户可以方便地执行命令。</p>
</li>
<li><p>脚本启动<br> 脚本启动是将Shell命令写入一个脚本文件中，然后通过执行这个脚本文件来启动Shell。它的基本过程如下：<br> （1）创建一个包含Shell命令的脚本文件（通常以.sh作为扩展名）。<br> （2）将脚本文件保存到磁盘上，并赋予执行权限。<br> （3）在终端中输入脚本文件的路径，并按下回车键。<br> （4）Shell会读取脚本文件中的命令，并依次执行这些命令。<br> 脚本启动模式适用于需要重复执行的一系列命令，可以将这些命令写入脚本文件中，并通过脚本文件来执行这些命令。此外，脚本启动模式还支持各种Shell的内置命令和选项。</p>
</li>
<li><p>练习修改系统提示符: <code>vim ~/.bashrc</code> 中的PS1变量</p>
</li>
</ol>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-19-21-30.png" alt="1.Shell初识，编辑器使用-2023-04-19-19-21-30"></p>
<h2 id="Linux的文件系统和权限信息"><a href="#Linux的文件系统和权限信息" class="headerlink" title="Linux的文件系统和权限信息"></a>Linux的文件系统和权限信息</h2><ul>
<li>Linux和Windows文件目录的比较</li>
<li>Linux根目录各子目录的作用</li>
<li>遍历目录</li>
</ul>
<h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-23-41-03.png" alt="1.Shell初识，编辑器使用-2023-04-19-23-41-03"></p>
<ul>
<li><p>Linux基本文件和目录命令使用综合练习</p>
<ol>
<li>新建一个名为<code>test</code>的目录，进入该目录并新建一个名为<code>file.txt</code>的文件。</li>
<li>将<code>file.txt</code>复制到<code>test</code>目录下，并将其重命名为<code>file2.txt</code>。</li>
<li>在当前目录下，新建一个名为<code>newdir</code>的目录。</li>
<li>将<code>file2.txt</code>移动到<code>newdir</code>目录下。</li>
<li>在当前目录下，使用<code>touch</code>命令创建一个名为<code>empty.txt</code>的空文件。</li>
<li>在<code>newdir</code>目录下，使用<code>find</code>命令查找以<code>.txt</code>结尾的文件，并将结果输出到名为<code>result.txt</code>的文件中。</li>
<li>在<code>newdir</code>目录下，使用<code>chmod</code>命令将<code>file2.txt</code>的所有用户的权限设置为可读可写可执行。</li>
<li>在当前目录下，使用<code>mkdir</code>命令递归创建一个名为<code>parent/child/grandchild</code>的目录树。</li>
</ol>
<p>  答案：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1</span>
<span class="token function">mkdir</span> <span class="token builtin class-name">test</span>
<span class="token builtin class-name">cd</span> <span class="token builtin class-name">test</span>
<span class="token function">touch</span> file.txt

<span class="token comment">#2</span>
<span class="token function">cp</span> file.txt file2.txt

<span class="token comment">#3</span>
<span class="token function">mkdir</span> newdir

<span class="token comment">#4</span>
<span class="token function">mv</span> file2.txt newdir/

<span class="token comment">#5</span>
<span class="token function">touch</span> empty.txt

<span class="token comment">#6</span>
<span class="token builtin class-name">cd</span> newdir
<span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"*.txt"</span> <span class="token parameter variable">-type</span> f <span class="token operator">></span> result.txt

<span class="token comment">#7</span>
<span class="token function">chmod</span> <span class="token number">777</span> file2.txt

<span class="token comment">#8</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> parent/child/grandchild
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="VIM使用"><a href="#VIM使用" class="headerlink" title="VIM使用"></a>VIM使用</h2><ol>
<li><p>学习平台：</p>
<p> <a target="_blank" rel="noopener" href="https://yianwillis.github.io/vimcdoc/doc/intro.html#intro.txt">VIM官方文档</a></p>
<p> <a target="_blank" rel="noopener" href="https://command-lab.com/cat-vim-ch-s/">VIM基础练习平台</a></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/MeiTianT/vim-galore-zh_cn#%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84">VIM进阶</a></p>
</li>
<li><p>vim常用命令</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.Shell%E5%88%9D%E8%AF%86%EF%BC%8C%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-2023-04-19-23-41-33.png" alt="1.Shell初识，编辑器使用-2023-04-19-23-41-33"></p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/2.%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/2.%E6%9E%84%E5%BB%BA%E5%9F%BA%E6%9C%AC%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">构建基本脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="构建基本脚本"><a href="#构建基本脚本" class="headerlink" title="构建基本脚本"></a>构建基本脚本</h2><ul>
<li><p>在命令行中使用分号组织命令  </p>
<p>  Shell脚本的关键在于输入多个命令并处理每个命令的结果，甚至需要将一个命令的结果传给另一个命令。Shell可以让你将多个命令串起来，一次执行完成。如果要两个命令一起运行，可以把它们放在同一行中，彼此间用分号隔开。</p>
  <pre class="line-numbers language-Shell" data-language="Shell"><div class="caption"><span>使用分号一次执行两个命令</span></div><code class="language-Shell">[centos@host1 &#x2F;]$ date;date
Tue Jun 13 14:16:40 UTC 2023
Tue Jun 13 14:16:40 UTC 2023
[centos@host1 &#x2F;]$ date;whoami
Tue Jun 13 14:16:44 UTC 2023
centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建Shell脚本文件  </p>
<p>  执行<code>vim test.sh</code>命令使用<code>vim</code>创建一个名为<code>test.sh</code>的脚本文件，编辑以下内容：  </p>
  <pre class="line-numbers language-bash" data-language="bash"><div class="caption"><span>第一个Shell脚本</span></div><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 这是一行注释，下面两行代码通过echo命令向标准输出发送指定字符</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Hello World!"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Hello World!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>在Shell脚本中，井号<code>#</code>用作注释行，Shell并不会处理Shell脚本中的注释行。但是Shell脚本文件的第一行是个例外，<code>#!</code>符号是一个特殊的标记，它会告诉系统用哪个Shell来运行脚本。  </li>
<li>在Shell脚本中，你可以在独立的行中书写命令，Shell会按根据命令在文件中出现的顺序进行处理。</li>
</ol>
</li>
</ul>
<h2 id="执行脚本文件的方式"><a href="#执行脚本文件的方式" class="headerlink" title="执行脚本文件的方式"></a>执行脚本文件的方式</h2><p>在执行脚本时先查看脚本是否有执行权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> test.sh
-rwxrwxr-x <span class="token number">1</span> centos centos <span class="token number">124</span> Jun <span class="token number">13</span> <span class="token number">14</span>:51 test.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li><p>第一种方式：在提示符中使用绝对或者相对文件路径来引用脚本文件</p>
</li>
<li><p>第二种方式：将Shell脚本文件所处目录添加到PATH变量中</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>第三种方式：使用 <code>bash + 脚本名</code> 或者 <code>source + 脚本名</code> 进行调用</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
Hello World<span class="token operator">!</span>
Hello World<span class="token operator">!</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">source</span> test.sh
Hello World<span class="token operator">!</span>
Hello World<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="Shell变量概念"><a href="#Shell变量概念" class="headerlink" title="Shell变量概念"></a>Shell变量概念</h2><ul>
<li><p>变量定义</p>
<p>  Shell变量是一种用于存储数据的容器。在Shell脚本中，变量用于存储各种类型的数据，例如数字、字符、字符串等。变量名通常是由一个字母、数字或下划线组成的字符串，并且不能以数字开头。</p>
</li>
<li><p>变量分类</p>
<p>  Shell中主要有两种类型的变量：环境变量和自定义变量。环境变量是在系统中定义的，可以由所有进程和用户访问。常见的环境变量包括PATH、HOME和USER等。自定义变量是在脚本中定义的，只能在脚本中使用，不能在脚本外部访问。</p>
</li>
<li><p>定义变量的语法格式： <code>varName=varValue</code></p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
    
<span class="token comment"># 定义一个变量，变量名为var，变量的值为数值10</span>
<span class="token assign-left variable">var1</span><span class="token operator">=</span><span class="token number">10</span>
    
<span class="token comment"># 定义一个变量，变量名为var，变量的值为字符串"Hello World"</span>
<span class="token assign-left variable">var2</span><span class="token operator">=</span><span class="token string">"Hello World"</span>
    
<span class="token comment"># 使用echo命令向标准输出打印变量var1和var2的值</span>
<span class="token comment"># 使用美元符号$可以在脚本中引用已经定义过的变量</span>
<span class="token builtin class-name">echo</span> <span class="token string">"var1 = <span class="token variable">$var1</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"var2 = <span class="token variable">$var2</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  使用<code>bash test.sh</code>命令运行脚本：  </p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
var1 <span class="token operator">=</span> <span class="token number">10</span>
var2 <span class="token operator">=</span> Hello World<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="Shell环境变量"><a href="#Shell环境变量" class="headerlink" title="Shell环境变量"></a>Shell环境变量</h2><h3 id="环境变量定义"><a href="#环境变量定义" class="headerlink" title="环境变量定义"></a>环境变量定义</h3><p>Bash Shell用环境变量（environment variable）来存储有关Shell会话和工作环境的信息（这也是它们被称作环境变量的原因）。这项特性允许你在内存中存储数据，以便程序或Shell中运行的脚本能够轻松访问到它们。这也是存储持久数据的一种简便方法。  </p>
<h3 id="环境变量分类"><a href="#环境变量分类" class="headerlink" title="环境变量分类"></a>环境变量分类</h3><ol>
<li><p>局部环境变量  </p>
<p> 局部环境变量只能在定义它们的进程中可见。查看局部环境变量的列表有点复杂。在Linux系统并没有一个只显示局部环境变量的命令。set命令会显示为某个特定进程设置的所有环境变量，包括局部变量、全局变量以及用户定义变量。</p>
<ul>
<li><p>定义和使用局部变量  </p>
<p>  区别于系统环境变量使用小写字符，当字符串内有空格时需要用双引号修饰。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 局部变量赋值时如果字符串内有空格不能直接赋值</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token assign-left variable">my_var</span><span class="token operator">=</span>Hello World
bash: World: <span class="token builtin class-name">command</span> not found
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>

<span class="token comment"># 使用引号修饰字符串</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token assign-left variable">my_var</span><span class="token operator">=</span><span class="token string">"Hello World"</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
Hello World<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p> 局部变量在子Shell中不可用，同样子Shell中定义的局部变量在父Shell中不可用。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在父shell中创建局部环境变量，并查看变量的值</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token assign-left variable">my_var</span><span class="token operator">=</span><span class="token string">"Hello World"</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
Hello World
<span class="token comment"># 使用bash创建子shell，在子shell中查看变量为空</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">bash</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>全局环境变量  </p>
<p> 全局环境变量对于Shell会话和所有生成的子Shell都是可见的。局部变量则只对创建它们的Shell可见。这让全局环境变量对那些所创建的子Shell需要获取父Shell信息的程序来说非常有用。<br> Linux系统在你开始bash会话时就设置了一些全局环境变量。系统环境变量基本上都是使用全大写字母，以区别于普通用户的环境变量。</p>
<ul>
<li><p>查看和使用全局环境变量</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">printenv</span> <span class="token environment constant">HOME</span>
/home/centos
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$HOME</span>
/home/centos
<span class="token comment"># 使用'$'在shell中引用环境变量</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">ls</span> <span class="token environment constant">$HOME</span>
<span class="token builtin class-name">test</span>  test.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>全局环境变量可以用于所有子Shell</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在父shell中查看环境变量HOME</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">printenv</span> <span class="token environment constant">HOME</span>
/home/centos
<span class="token comment"># 使用bash命令创建子shell</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">bash</span>
<span class="token comment"># 在子shell中查看HOME变量</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">printenv</span> <span class="token environment constant">HOME</span>
/home/centos
<span class="token comment"># 查看当前系统的父子shell关系</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">ps</span> <span class="token parameter variable">-f</span>
<span class="token environment constant">UID</span>          PID    <span class="token environment constant">PPID</span>  C STIME TTY          TIME CMD
centos       <span class="token number">126</span>     <span class="token number">125</span>  <span class="token number">0</span> 03:08 pts/3    00:00:00 <span class="token function">bash</span>
centos       <span class="token number">150</span>     <span class="token number">126</span>  <span class="token number">0</span> 05:12 pts/3    00:00:00 <span class="token function">bash</span>
centos       <span class="token number">166</span>     <span class="token number">150</span>  <span class="token number">0</span> 05:12 pts/3    00:00:00 <span class="token function">ps</span> <span class="token parameter variable">-f</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>设置全局环境变量</p>
<p>  在设定全局环境变量的进程所创建的子进程中，该变量都是可见的。创建全局环境变量的方法是先创建一个局部环境变量，然后再使用 <code>export</code>把它导出到全局环境中。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在父shell中创建局部变量</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token assign-left variable">my_var</span><span class="token operator">=</span><span class="token string">"Hello World"</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
Hello World
<span class="token comment"># 将局部变量导出为全局变量</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> my_var
<span class="token comment"># 创建子shell</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token function">bash</span>
<span class="token comment"># 查看子shell继承的全局变量</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
Hello World
<span class="token comment"># 修改子shell的全局变量</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token assign-left variable">my_var</span><span class="token operator">=</span><span class="token string">"NULL"</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
NULL
<span class="token comment"># 退回父shell</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">exit</span>
<span class="token builtin class-name">exit</span>
<span class="token comment"># 父shell内的全局变量值没有变</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$my_var</span>
Hello World<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>bash默认的环境变量</p>
<ol>
<li>HOME：当前用户的家目录</li>
<li>PATH：系统执行命令的路径</li>
<li>USER：当前登录的用户名</li>
<li>Shell：当前用户使用的默认Shell程序</li>
<li>PWD：当前工作目录</li>
<li>LANG：当前语言环境</li>
<li>TERM：当前终端的类型</li>
<li>PS1：命令提示符的格式</li>
<li>HISTSIZE：命令历史记录的长度限制</li>
<li>HISTFILESIZE：命令历史记录文件的大小限制</li>
</ol>
</li>
<li><p>设置PATH环境变量</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看PATH变量的值</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
<span class="token comment"># 修改PATH变量，追加目录/home/centos</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/home/centos
<span class="token comment"># 确认PATH变量的值</span>
<span class="token punctuation">[</span>centos@host1 test<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<h2 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h2><p>Shell脚本会自动决定变量值的数据类型。在脚本的整个生命周期里，Shell脚本中定义的变量会一直保持着它们的值，但在Shell脚本结束时会被删除掉。</p>
<ul>
<li><p>引用用户变量和环境变量</p>
<ul>
<li>使用等号将值赋给用户变量。在变量、等号和值之间不能出现空格。</li>
<li>在脚本的整个生命周期里，Shell脚本中定义的变量会一直保持着它们的值，但在Shell脚本结束时会被删除掉。</li>
<li>变量每次被引用时，都会输出当前赋给它的值。引用一个变量值时需要使用美元符，而引用变量来对其进行赋值时则不要使用美元符。没有美元符，Shell会将变量名解释成普通的文本字符串。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 通过引用环境变量进行赋值</span>
<span class="token assign-left variable">var1</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>

<span class="token comment"># 通过echo命令打印var1的值</span>
<span class="token builtin class-name">echo</span> <span class="token string">"var1 = <span class="token variable">$var1</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
var1 <span class="token operator">=</span> /home/centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>命令替换</p>
<p>  Shell脚本中最有用的特性之一就是可以从命令输出中提取信息，并将其赋给变量。把输出赋给变量之后，就可以随意在脚本中使用了。这个特性在处理脚本数据时尤为方便。有两种方法可以将命令输出赋给变量：</p>
<ul>
<li>反引号字符（&#96;）(与~同键位)</li>
<li>$()格式</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 通过引用环境变量进行赋值</span>
<span class="token assign-left variable">today</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%y%m%d<span class="token variable">`</span></span>

<span class="token function">touch</span> log.<span class="token variable">$today</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
<span class="token comment"># 创建了一个后缀为当前系统时间的日志文件</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span>
log.230616  test.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>从键盘读入赋值</p>
<p>  在Shell脚本中，Shell变量可以通过从键盘读入输入的内容并来赋值。命令格式为：<code>read –p [提示信息]：[变量名]</code></p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 使用read命令打印出提示信息，等待用户输入字符并回车后将字符保存在变量ip内</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"input ip:"</span> <span class="token function">ip</span>

<span class="token comment"># 使用ping检查用户所输入的ip地址的连通性</span>
<span class="token function">ping</span> <span class="token parameter variable">-c2</span> <span class="token variable">$ip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="变量的数值计算"><a href="#变量的数值计算" class="headerlink" title="变量的数值计算"></a>变量的数值计算</h2><ol>
<li><p>使用 <code>expr</code>命令</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token function">expr</span> <span class="token number">5</span> + <span class="token number">2</span>
<span class="token function">expr</span> <span class="token number">5</span>+2
<span class="token function">expr</span> <span class="token number">5</span> * <span class="token number">2</span>
<span class="token function">expr</span> <span class="token number">5</span> <span class="token punctuation">\</span>* <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
<span class="token comment"># expr的用法里运算符两侧需要添加空格</span>
<span class="token number">7</span>
<span class="token number">5</span>+2
<span class="token comment"># 星号*不能直接作为乘法运算符使用，需要用反斜杠进行转义</span>
expr: syntax error
<span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用方括号</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">var1</span><span class="token operator">=</span><span class="token number">100</span>
<span class="token assign-left variable">var2</span><span class="token operator">=</span><span class="token number">50</span>
<span class="token assign-left variable">var3</span><span class="token operator">=</span><span class="token number">45</span>

<span class="token assign-left variable">var4</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$var1</span> / <span class="token variable">$var2</span><span class="token punctuation">]</span>
<span class="token assign-left variable">var5</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$var1</span> / <span class="token variable">$var3</span><span class="token punctuation">]</span>

<span class="token builtin class-name">echo</span> var4 <span class="token operator">=</span> <span class="token variable">$var4</span>
<span class="token builtin class-name">echo</span> var5 <span class="token operator">=</span> <span class="token variable">$var5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
var4 <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment"># 使用方括号进行的数值计算在整数范围内</span>
var5 <span class="token operator">=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>在脚本内使用 <code>bc</code> 进行浮点数计算</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">var1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"scale=4; 3.44 / 5"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">`</span></span>

<span class="token builtin class-name">echo</span> the answer is <span class="token variable">$var1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
the answer is .6880<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>let数值运算命令</p>
<p> let数值符号可以直接进行计算，且不带回显功能，也就是说当使用let的时候，不再使用$引用变量。let运算命令的语法格式为：let 赋值表达式，其功能等同于<code>((赋值表达式))</code> 。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">let</span> <span class="token assign-left variable">sum</span><span class="token operator">=</span>sum+8
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$sum</span>
<span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>变量的自增</p>
<p> Shell变量的自增运算符是<code>i++</code>和<code>++i</code>。<code>i++</code>表示<strong>先赋值再自加</strong>，<code>++i</code>表示<strong>先自加再赋值</strong>。</p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">var1</span><span class="token operator">=</span><span class="token number">10</span>

<span class="token builtin class-name">let</span> var1++
<span class="token builtin class-name">echo</span> <span class="token variable">$var1</span>

<span class="token builtin class-name">let</span> ++var1
<span class="token builtin class-name">echo</span> <span class="token variable">$var1</span>

<span class="token builtin class-name">let</span> <span class="token assign-left variable">var2</span><span class="token operator">=</span>var1++
<span class="token builtin class-name">echo</span> <span class="token variable">$var2</span> <span class="token variable">$var1</span>

<span class="token builtin class-name">let</span> <span class="token assign-left variable">var2</span><span class="token operator">=</span>++var1
<span class="token builtin class-name">echo</span> <span class="token variable">$var2</span> <span class="token variable">$var1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
<span class="token number">11</span>
<span class="token number">12</span>
<span class="token number">12</span> <span class="token number">13</span>
<span class="token number">14</span> <span class="token number">14</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="特殊参数"><a href="#特殊参数" class="headerlink" title="特殊参数"></a>特殊参数</h2><ul>
<li><p>位置参数</p>
<p>  $0表示脚本名，$1表示脚本传递的第一个参数，$2 表示传递的第二个参数。</p>
<p>  创建脚本test.sh、编辑以下内容：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> name is <span class="token variable">$0</span>, var1 <span class="token operator">=</span> <span class="token variable">$1</span>, var2 <span class="token operator">=</span> <span class="token variable">$2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>  运行脚本：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
name is test.sh, var1 <span class="token operator">=</span> , var2 <span class="token operator">=</span>
<span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh <span class="token number">123</span> abc
name is test.sh, var1 <span class="token operator">=</span> <span class="token number">123</span>, var2 <span class="token operator">=</span> abc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>预定义参数</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>$0</td>
<td>脚本名</td>
</tr>
<tr>
<td>$*</td>
<td>所有的参数（以整体的形式）</td>
</tr>
<tr>
<td>$@</td>
<td>所以的参数（以数组的形式）</td>
</tr>
<tr>
<td>$#</td>
<td>参数的个数</td>
</tr>
<tr>
<td>$$</td>
<td>当前进程的PID</td>
</tr>
<tr>
<td>$!</td>
<td>上一个后台进程的PID</td>
</tr>
<tr>
<td>$?</td>
<td>上一个命令的返回值 0表示成功</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="Shell中的特殊符号"><a href="#Shell中的特殊符号" class="headerlink" title="Shell中的特殊符号"></a>Shell中的特殊符号</h2><ul>
<li><p>“#”用在行首表示程序的注释。</p>
</li>
<li><p>“;” 作为命令的分隔符，分隔同一行上两个或者两个以上的命令。</p>
</li>
<li><p>“.”等价于source命令。它是bash中的一个内建命令。</p>
<p>  “.”也可以作为文件名的一部分，如果”.”放在文件名的开头，那么这个文件将会成为”隐藏文件”，ls命令将不会正常显示出这个文件。</p>
</li>
<li><p>单引号’’，双引号””的区别是单引号’’剥夺了所有字符的特殊含义，单引号’’内就变成了单纯的字符。双引号””则对于双引号””内的参数替换($)和命令替换(&#96;&#96;)是个例外。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">Shell条件测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="结构化命令概念"><a href="#结构化命令概念" class="headerlink" title="结构化命令概念"></a>结构化命令概念</h2><p>Shell按照命令在脚本中出现的顺序依次进行处理。对顺序操作来说，这已经足够了，因为在这种操作环境下，你想要的就是所有的命令按照正确的顺序执行。  </p>
<p>许多程序要求对shell脚本中的命令施加一些逻辑流程控制。有一类命令会根据条件使脚本跳过某些命令。这样的命令通常称为结构化命令（structured command）  </p>
<p>常见的条件测试命令： <code>if-then语句</code> 、 <code>case语句</code> 、 <code>for语句</code> 、 <code>while语句</code></p>
<h2 id="if条件语句"><a href="#if条件语句" class="headerlink" title="if条件语句"></a>if条件语句</h2><ul>
<li><p>if条件语句通常由以下三个关键字组成：</p>
<ol>
<li>if：用于指定要测试的条件</li>
<li>then：用于指定如果条件为true时要执行的指令</li>
<li>else：用于指定如果条件为false时要执行的指令</li>
</ol>
  <pre class="line-numbers language-bash" data-language="bash"><div class="caption"><span>if条件语句格式</span></div><code class="language-bash"><span class="token keyword">if</span> condition
<span class="token keyword">then</span>
    command1 
    command2
    <span class="token punctuation">..</span>.
    commandN 
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>在其他编程语言中，if语句之后的对象是一个等式，这个等式的求值结果为TRUE或FALSE。但bash shell的if语句并不是这么做的。bash shell的if语句会运行if后面的那个命令。如果该命令的退出状态码是0（该命令成功运行），位于then部分的命令就会被执行。如果该命令的退出状态码是其他值，then部分的命令就不会被执行，bash shell会继续执行脚本中的下一个命令。fi语句用来表示if-then语句到此结束。</p>
<p>创建脚本test.sh、编辑以下内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 测试的条件为`pwd`命令，根据命令的返回值进行跳转</span>
<span class="token keyword">if</span> <span class="token builtin class-name">pwd</span>
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"it worked"</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行脚本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
/home/centos
it worked<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>if-then</code> 语句的另一种形式</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token builtin class-name">command</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
commands
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><strong>练习</strong></p>
<p>  创建脚本test.sh、编辑以下内容：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 待测试的用户名为centos</span>
<span class="token assign-left variable">testuser</span><span class="token operator">=</span>centos

<span class="token comment"># 根据grep语句的运行结果进行跳转，即文件/etc/passwd内是否有centos这个字符</span>
<span class="token keyword">if</span> <span class="token function">grep</span> <span class="token variable">$testuser</span> /etc/passwd
<span class="token keyword">then</span>
        <span class="token comment"># 如果找到centos字符，打印以下信息</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"it worked"</span>
        <span class="token comment"># 同时显示centos家目录下以.b开头的隐藏文件</span>
        <span class="token function">ls</span> <span class="token parameter variable">-a</span> /home/<span class="token variable">$testuser</span>/.b*
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  运行脚本：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
centos:x:1000:1000::/home/centos:/bin/bash
it worked
/home/centos/.bash_history  /home/centos/.bash_profile
/home/centos/.bash_logout   /home/centos/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>if-then-else</code> 双分支语句</p>
<p>  当if语句中的命令返回退出状态码0时，then部分中的命令会被执行，这跟普通的if-then<br>  语句一样。当if语句中的命令返回非零退出状态码时，bash shell会执行else部分中的命令。</p>
<p>  在test.sh文件的基础上添加else语句</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 待测试的用户名为ubuntu</span>
<span class="token assign-left variable">testuser</span><span class="token operator">=</span>ubuntu

<span class="token comment"># 此时grep命令没有找到ubuntu字符，if语句跳转到else分支</span>
<span class="token keyword">if</span> <span class="token function">grep</span> <span class="token variable">$testuser</span> /etc/passwd
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"it worked"</span>
        <span class="token comment"># 同时显示家目录下以.b开头的隐藏文件</span>
        <span class="token function">ls</span> <span class="token parameter variable">-a</span> /home/<span class="token variable">$testuser</span>/.b*
<span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"user <span class="token variable">$testuser</span> does not exist."</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  运行脚本：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
user ubuntu does not exist.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>if-then-elif-else</code> 多分支语句</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">testuser</span><span class="token operator">=</span>ubuntu

<span class="token keyword">if</span> <span class="token function">grep</span> <span class="token variable">$testuser</span> /etc/passwd
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"user: exist"</span>
        <span class="token function">ls</span> <span class="token parameter variable">-a</span> /home/<span class="token variable">$testuser</span>/.b*
<span class="token keyword">else</span> <span class="token function">ls</span> <span class="token parameter variable">-d</span> /home/<span class="token variable">$testuser</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"user <span class="token variable">$testuser</span> does not exist, but has a directory"</span>
<span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"user <span class="token variable">$testuser</span> does not exist"</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"user <span class="token variable">$testuser</span> does not have a directory"</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>test</code> 命令</p>
<p>  如果test命令中列出的条件成立，test命令就会退出并返回退出状态码0。这样if-then语句就与其他编程语言中的if-then语句以类似的方式工作了。如果条件不成立，test命令就会退出并返回非零的退出状态码，这使得if-then语句不会再被执行。</p>
<ul>
<li><p>test命令格式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token builtin class-name">test</span> condition
<span class="token keyword">then</span>
 commands
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>bash shell提供了另一种条件测试方法，无需在if-then语句中声明test命令。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> condition <span class="token punctuation">]</span>
<span class="token keyword">then</span>
 commands
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建脚本test.sh、编辑以下内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">testuser</span><span class="token operator">=</span>ubuntu

<span class="token comment"># 当变量testuser不为空时执行then语句的内容</span>
<span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token variable">$testuser</span>
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"the variable exists"</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行脚本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
the variable exists<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>方括号定义了测试条件。注意，第一个方括号之后和第二个方括号之前必须加上一个空格，否则就会报错。<br>test命令可以判断三类条件：</p>
<ol>
<li><p>文件比较</p>
<p> 这些测试条件使你能够在shell脚本中检查文件系统中的文件。它们经常出现在需要进行文件访问的脚本中，文件比较的操作符如下：</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-43-25.png" alt="3.Shell条件测试-2023-06-16-20-43-25"></p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">dir</span><span class="token operator">=</span>/home/centos

<span class="token comment"># 根据-d判断dir是否存在并且是一个目录文件</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token variable">$dir</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"directory <span class="token variable">$dir</span> exists"</span>
        <span class="token builtin class-name">cd</span> <span class="token variable">$dir</span>
        <span class="token function">ls</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
directory /home/centos exists
log.230616  test.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>字符串比较</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-46-41.png" alt="3.Shell条件测试-2023-06-16-20-46-41"></p>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">testuser</span><span class="token operator">=</span>centos

<span class="token comment"># 通过比较运算符等号=比较两个字符串，等式成立则表达式结果为真</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token environment constant">$USER</span> <span class="token operator">=</span> <span class="token variable">$testuser</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"welcome <span class="token variable">$testuser</span>"</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
welcome centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>大于号和小于号必须转义，否则shell会把它们当作重定向符号，把字符串值当作文件名</li>
</ul>
<p> 创建脚本test.sh、编辑以下内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">var1</span><span class="token operator">=</span>temp
<span class="token assign-left variable">var2</span><span class="token operator">=</span>tmp

<span class="token comment"># 在条件比较时直接使用大于号>不能表示大于的含义，需要使用\>在表示大于</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$var1</span> <span class="token operator">></span> <span class="token variable">$var2</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$var1</span> greater than <span class="token variable">$var2</span>"</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
temp greater than tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>数值比较</p>
<p> 数值条件测试可以用在数字和变量上。</p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-21-06-44.png" alt="3.Shell条件测试-2023-06-16-21-06-44"></p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="复合条件测试"><a href="#复合条件测试" class="headerlink" title="复合条件测试"></a>复合条件测试</h2><ul>
<li><p><code>&amp;&amp;和||</code> 用法</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span> condition1 <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> condition2 <span class="token punctuation">]</span>
<span class="token punctuation">[</span> condition1 <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> condition2 <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>第一种布尔运算使用AND布尔运算符来组合两个条件。要让then部分的命令执行，两个条件都必须满足。</li>
<li>第二种布尔运算使用OR布尔运算符来组合两个条件。如果任意条件为TRUE，then部分的命令就会执行。</li>
</ul>
</li>
</ul>
<h2 id="case命令"><a href="#case命令" class="headerlink" title="case命令"></a>case命令</h2><p>在shell编程中，case语句是一种多分支条件语句，用于测试变量或表达式是否与某些模式匹配，并执行相应的命令。</p>
<p>case语句通常用于替代if-then-else语句，特别是在需要测试一个变量或表达式是否匹配多个模式的情况下。case语句的语法结构如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">case</span> expression <span class="token keyword">in</span>
  pattern1<span class="token punctuation">)</span>
    command1
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  pattern2<span class="token punctuation">)</span>
    command2
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  pattern3<span class="token punctuation">)</span>
    command3
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  *<span class="token punctuation">)</span>
    default_command
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中，expression是要测试的变量或表达式，pattern1、pattern2、pattern3等是匹配模式，command1、command2、command3等是匹配模式成立时要执行的命令，**<code>;;</code><strong>表示命令结束，</strong><code>*)</code>**表示如果所有模式都不匹配时要执行的默认命令。</p>
<p>创建脚本test.sh、编辑以下内容：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">fruit</span><span class="token operator">=</span><span class="token string">"apple"</span>

<span class="token keyword">case</span> <span class="token variable">$fruit</span> <span class="token keyword">in</span>
        apple<span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"It's an apple."</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        banana<span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"It's a banana."</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token comment"># *用来匹配之前所有匹配模式都匹配不到的情况</span>
        *<span class="token punctuation">)</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"It's not an apple or a banana."</span>
                <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行脚本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>centos@host1 ~<span class="token punctuation">]</span>$ <span class="token function">bash</span> test.sh
It's an apple.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><ol>
<li>使用 <code>read</code>要求用户输入一个数字。</li>
<li>使用 <code>if</code>判断该数字是否在<code>0-9</code>之间，如果不满足则停止脚本。</li>
<li>然后使用 <strong><code>case</code></strong> 语句输出对应数字<code>0-3</code>的英文，对于其他数字输出一个提示“该数字在4-9之间”。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/4.Shell%E5%BE%AA%E7%8E%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/4.Shell%E5%BE%AA%E7%8E%AF/" class="post-title-link" itemprop="url">Shell循环</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h2><p>上一章学习的结构化命令中的 <code>if-then</code> 和 <code>case</code> 语句，其中 <code>if-then</code> 语句是通过检查命令的执行结果或者表达式（文件比较、字符串比较、数值比较）的结果来控制脚本的执行流程。</p>
<p>在Shell脚本中，循环语句是一种重要的控制结构，用于多次执行同一段代码。Shell脚本中提供了多种循环语句，包括<code>for</code>、<code>while</code>、<code>until</code>三种。</p>
<h2 id="for-循环结构"><a href="#for-循环结构" class="headerlink" title="for 循环结构"></a>for 循环结构</h2><p><code>for</code> 循环是一种针对列表中每个元素执行相同操作的循环结构。该语句会将列表中的每个元素依次赋值给变量，并执行循环体中的语句。其基本语法格式如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> 变量名 <span class="token keyword">in</span> 列表
<span class="token keyword">do</span>
    循环体
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中，<code>变量名</code>是一个新的变量，用于存储列表中的每个元素；<code>列表</code>是一个由空格分隔的参数列表。</p>
<p>例如，下面的代码中，<code>for</code> 循环遍历了一个包含 5 个元素的列表，依次输出了每个元素：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"列表中的元素：<span class="token variable">$i</span>"</span>
done,rk

<span class="token builtin class-name">echo</span> <span class="token string">"i = <span class="token variable">$i</span>"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以上代码会输出以下结果：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">列表中的元素：1
列表中的元素：2
列表中的元素：3
列表中的元素：4
列表中的元素：5
i = 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>读取列表中的复杂值</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> I don<span class="token string">'t know if this'</span>ll work
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"word:<span class="token variable">$i</span>"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  以上代码输出以下结果：</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">word:I
word:dont know if thisll
word:work<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>两种方法解决列表中单引号引用的问题</p>
<ol>
<li><p>使用转义字符（反斜杠）将单引号转义</p>
</li>
<li><p>使用双引号定义用到单引号的值</p>
</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> I don<span class="token punctuation">\</span>'t know <span class="token keyword">if</span> this<span class="token punctuation">\</span>'ll work
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"word:<span class="token variable">$i</span>"</span>
<span class="token keyword">done</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> I <span class="token string">"don't"</span> know <span class="token keyword">if</span> <span class="token string">"this'll"</span> work
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"word:<span class="token variable">$i</span>"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用双引号引用输出多个单词</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">"1 2"</span> <span class="token string">"3 4"</span> <span class="token number">5</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"列表中的元素：<span class="token variable">$i</span>"</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">"i = <span class="token variable">$i</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以上代码输出以下结果：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">列表中的元素：1 2
列表中的元素：3 4
列表中的元素：5
i = 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>从变量读取列表</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">list</span><span class="token operator">=</span><span class="token string">"1 2 3 4 5"</span>
<span class="token assign-left variable">list</span><span class="token operator">=</span><span class="token variable">$list</span><span class="token string">" 6"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">$list</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"列表中的元素：<span class="token variable">$i</span>"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  以上代码输出以下结果：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">列表中的元素：1
列表中的元素：2
列表中的元素：3
列表中的元素：4
列表中的元素：5
列表中的元素：6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过命令读取</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">$'<span class="token entity" title="\n">\n</span>'</span>

<span class="token function">cat</span> <span class="token operator">></span> test.sh <span class="token operator">&lt;&lt;</span><span class="token string">EOF
1 2 3
2
3
4
5
EOF</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> test.sh<span class="token variable">`</span></span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"列表中的元素：<span class="token variable">$i</span>"</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>用通配符读取目录</p>
<p>  在 Shell 编程中，通配符是一种用于匹配文件名或目录名的特殊字符。通配符可以帮助你快速地匹配一组文件或目录，从而方便地对它们进行操作。</p>
<p>  常见的通配符包括：</p>
<ul>
<li><p><code>*</code>：匹配任意长度的任意字符，包括空字符串。</p>
</li>
<li><p><code>?</code>：匹配任意一个字符。</p>
</li>
<li><p><code>[...]</code>：匹配括号内列举的任意一个字符。</p>
</li>
<li><p><code>[^...]</code>：匹配除了括号内列举的任意一个字符以外的所有字符。</p>
<p>以下是一些通配符匹配的示例：</p>
</li>
<li><p><code>*.txt</code>：匹配所有以 <code>.txt</code> 结尾的文件，如 <code>file1.txt</code>、<code>file2.txt</code> 等。</p>
</li>
<li><p><code>file?.txt</code>：匹配所有文件名为 <code>file</code> 开头，后面跟着任意一个字符，最后以 <code>.txt</code> 结尾的文件，如 <code>file1.txt</code>、<code>fileA.txt</code> 等。</p>
</li>
<li><p><code>[abc].txt</code>：匹配所有文件名为 <code>a.txt</code>、<code>b.txt</code>、<code>c.txt</code> 的文件。</p>
</li>
<li><p><code>[^abc].txt</code>：匹配除了文件名为 <code>a.txt</code>、<code>b.txt</code>、<code>c.txt</code> 以外的所有以 <code>.txt</code> 结尾的文件。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token function">touch</span> ~/file<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">&#125;</span>
<span class="token function">mkdir</span> ~/dir<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">&#125;</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> ~/*
<span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
     <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> is a directory"</span>
    <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> is a file"</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>练习：</p>
<p>通过shell脚本实现批量主机检测</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token operator">></span>ip.txt

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">..</span><span class="token number">254</span><span class="token punctuation">&#125;</span>
<span class="token keyword">do</span>
    <span class="token punctuation">&#123;</span>
    <span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token number">192.168</span>.13.<span class="token variable">$i</span>
    <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-W1</span> <span class="token variable">$ip</span> <span class="token operator">&amp;></span>/dev/null
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span>"</span> <span class="token operator">|</span><span class="token function">tee</span> <span class="token parameter variable">-a</span> ip.txt
  <span class="token keyword">fi</span>
  <span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>
<span class="token keyword">done</span>
<span class="token function">wait</span>
<span class="token builtin class-name">echo</span> <span class="token string">"finish..."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<h2 id="while-循环结构"><a href="#while-循环结构" class="headerlink" title="while 循环结构"></a>while 循环结构</h2><p><code>while</code> 循环是一种基于条件判断的循环结构，当条件满足时就会一直执行循环体中的语句。其基本语法格式如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">while</span> <span class="token punctuation">[</span> 条件 <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    循环体
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中，<code>条件</code>是一个可以执行的测试命令或表达式，如果返回值为0，则为真，循环继续执行；否则为假，循环结束。</p>
<p>例如，下面的代码中，<code>while</code> 循环会一直执行，直到变量 <code>i</code> 的值达到 5：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-le</span> <span class="token number">5</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"当前变量的值是 <span class="token variable">$i</span>"</span>
    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $i <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以上代码会输出以下结果：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">当前变量的值是 1
当前变量的值是 2
当前变量的值是 3
当前变量的值是 4
当前变量的值是 5
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="until-循环结构"><a href="#until-循环结构" class="headerlink" title="until 循环结构"></a>until 循环结构</h2><p><code>until</code> 循环与 <code>while</code> 循环类似，但是只有当条件为假时才会执行循环体中的语句。其基本语法格式如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">until</span> <span class="token punctuation">[</span> 条件 <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    循环体
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中，<code>条件</code>是一个可以执行的测试命令或表达式，如果返回值为0，则为假，循环继续执行；否则为真，循环结束。</p>
<p>例如，下面的代码中，<code>until</code> 循环会一直执行，直到变量 <code>i</code> 的值达到 5：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">until</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-gt</span> <span class="token number">5</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"当前变量的值是 <span class="token variable">$i</span>"</span>
    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $i <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以上代码会输出以下结果：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">当前变量的值是 1
当前变量的值是 2
当前变量的值是 3
当前变量的值是 4
当前变量的值是 5
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="循环控制语句结构"><a href="#循环控制语句结构" class="headerlink" title="循环控制语句结构"></a>循环控制语句结构</h2><p>在循环中，有时需要跳过某些循环或终止循环的执行，Shell脚本提供了以下三种循环控制语句：</p>
<ul>
<li><code>break</code>语句：用于强制退出循环，跳出循环体，执行循环后面的语句。</li>
<li><code>continue</code>语句：用于跳过循环体中的一个迭代，直接进入下一个迭代。</li>
<li><code>return</code>语句：用于退出函数，返回到函数调用处。</li>
</ul>
<p>例如，下面的代码演示了如何在循环中使用 <code>break</code> 和 <code>continue</code> 语句：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-le</span> <span class="token number">100</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-eq</span> <span class="token number">3</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"跳过第 <span class="token variable">$i</span> 次迭代"</span>
        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $i <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>
        <span class="token builtin class-name">continue</span>
    <span class="token keyword">fi</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-eq</span> <span class="token number">5</span> <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"退出循环"</span>
        <span class="token builtin class-name">break</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"第 <span class="token variable">$i</span> 次迭代"</span>
    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $i <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以上代码会输出以下结果：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">第 1 次迭代
第 2 次迭代
跳过第 3 次迭代
第 4 次迭代
退出循环
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/5.%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/5.%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5/" class="post-title-link" itemprop="url">处理用户输入</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>bash shell提供了一些不同的方法从用户处获得数据，包括命令行参数、命令行选项、直接从键盘读取。</li>
</ul>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><h3 id="读取参数"><a href="#读取参数" class="headerlink" title="读取参数"></a>读取参数</h3><p>在Shell脚本中，命令行参数可以通过特殊变量 <strong><code>$1</code><strong>、</strong><code>$2</code><strong>、</strong><code>$3</code></strong> … **<code>$n</code>**来获取，其中 **<code>$1</code><strong>表示第一个参数，</strong><code>$2</code><strong>表示第二个参数，以此类推，</strong><code>$n</code>**表示第 n 个参数。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> <span class="token string">"第一个参数为：<span class="token variable">$1</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"第二个参数为：<span class="token variable">$2</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"第三个参数为：<span class="token variable">$3</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li><p>利用<code>for</code>循环和命令行参数计算阶乘：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>$n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span>
<span class="token keyword">do</span>
   <span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>fact <span class="token operator">*</span> i<span class="token variable">))</span></span>  
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Factorial of <span class="token variable">$n</span> is <span class="token variable">$fact</span>"</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>将带有空格的文本字符串传递给脚本时需要注意用引号，引号在进行传递时只表明数据的起止位置，不作为数据的一部分：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> Hello <span class="token variable">$1</span>, glad to meet you.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>当参数超过9个时需要修改变量名，变量名两侧加上花括号。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># handling lots of parameters</span>
<span class="token comment">#</span>
<span class="token assign-left variable">total</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$&#123;10&#125;</span> * <span class="token variable">$&#123;11&#125;</span> <span class="token punctuation">]</span>
<span class="token builtin class-name">echo</span> The tenth parameter is <span class="token variable">$&#123;10&#125;</span>
<span class="token builtin class-name">echo</span> The eleventh parameter is <span class="token variable">$&#123;11&#125;</span>
<span class="token builtin class-name">echo</span> The total is <span class="token variable">$total</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 运行脚本：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">The tenth parameter is 10
The eleventh parameter is 11
The total is 110<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="读取脚本名"><a href="#读取脚本名" class="headerlink" title="读取脚本名"></a>读取脚本名</h3><p>可以用<code>$0</code>参数获取shell在命令行启动的脚本名：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Testing the $0 parameter</span>
<span class="token comment">#</span>
<span class="token builtin class-name">echo</span> The zero parameter is <span class="token builtin class-name">set</span> to: <span class="token variable">$0</span>
<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当传给<code>$0</code>变量的实际字符串不仅仅是脚本名，而是完整的脚本路径时，变量<code>$0</code>就会使用整个路径：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">bash</span> ~/temp.sh
The zero parameter is <span class="token builtin class-name">set</span> to: /home/ubuntu/temp.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>basename命令会返回不包含路径的脚本名：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Testing the $0 parameter</span>
<span class="token comment">#</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $0<span class="token variable">)</span></span>

<span class="token builtin class-name">echo</span> The zero parameter is <span class="token builtin class-name">set</span> to: <span class="token variable">$name</span>
<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>基于脚本名实现不同功能的脚本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># Testing a Multi-function script</span>
<span class="token comment">#</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $0<span class="token variable">)</span></span>
<span class="token comment">#</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">"addem"</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
<span class="token assign-left variable">total</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$1</span> + <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token comment">#</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">"multem"</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
<span class="token assign-left variable">total</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$1</span> * <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token keyword">fi</span>
<span class="token comment">#</span>
<span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> The calculated value is <span class="token variable">$total</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cp</span> temp.sh addem
$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> temp.sh multem

$ <span class="token function">bash</span> addem <span class="token number">2</span> <span class="token number">5</span>
The calculated value is <span class="token number">7</span>

$ <span class="token function">bash</span> multem <span class="token number">2</span> <span class="token number">5</span>
The calculated value is <span class="token number">10</span>
$
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="测试参数"><a href="#测试参数" class="headerlink" title="测试参数"></a>测试参数</h3><p>在脚本内使用参数时需要考虑到当用户输入错误参数时的情况：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Factorial of 0 is 1"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-lt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Invalid input. Number must be a positive integer"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>$n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>fact <span class="token operator">*</span> i<span class="token variable">))</span></span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Factorial of <span class="token variable">$n</span> is <span class="token variable">$fact</span>"</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="特殊参数变量"><a href="#特殊参数变量" class="headerlink" title="特殊参数变量"></a>特殊参数变量</h2><h3 id="参数统计"><a href="#参数统计" class="headerlink" title="参数统计"></a>参数统计</h3><p>使用特殊变量可以帮助我们更方便的检查用户传递给脚本的参数。特殊变量<code>$#</code>含有脚本运行时携带的命令行参数的个数。可以在脚本中任何地方使用这个特殊变量，就跟普通变量一样。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># getting the number of parameters</span>
<span class="token comment">#</span>
<span class="token builtin class-name">echo</span> There were <span class="token variable">$#</span> parameters supplied.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">bash</span> temp.sh
There were <span class="token number">0</span> parameters supplied.

ubuntu@sh:~$ <span class="token function">bash</span> temp.sh <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span>
There were <span class="token number">5</span> parameters supplied.

ubuntu@sh:~$ <span class="token function">bash</span> temp.sh <span class="token string">"Hello world"</span>
There were <span class="token number">1</span> parameters supplied.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在使用参数前测试参数总数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-ne</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$0</span> number"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Factorial of 0 is 1"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$n</span> <span class="token parameter variable">-lt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Invalid input. Number must be a positive integer"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>$n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>fact <span class="token operator">*</span> i<span class="token variable">))</span></span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Factorial of <span class="token variable">$n</span> is <span class="token variable">$fact</span>"</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="抓取所有的数据"><a href="#抓取所有的数据" class="headerlink" title="抓取所有的数据"></a>抓取所有的数据</h3><p><code>$*</code>变量会将命令行上提供的所有参数当作一个单词保存。这个单词包含了命令行中出现的每<br>一个参数值。基本上<code>$*</code>变量会将这些参数视为一个整体，而不是多个个体。<br>另一方面，<code>$@</code>变量会将命令行上提供的所有参数当作同一字符串中的多个独立的单词。这样<br>你就能够遍历所有的参数值，得到每个参数。这通常通过<code>for</code>命令完成。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># testing $* and $@</span>
<span class="token comment">#j,r:</span>
<span class="token builtin class-name">echo</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">param</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">$*</span>"</span>
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"\<span class="token variable">$*</span> Parameter #<span class="token variable">$count</span> = <span class="token variable">$param</span>"</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$count</span> + <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">done</span>
<span class="token comment">#</span>
<span class="token builtin class-name">echo</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment">#</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">param</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">$@</span>"</span>
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"\<span class="token variable">$@</span> Parameter #<span class="token variable">$count</span> = <span class="token variable">$param</span>"</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$count</span> + <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="移动变量"><a href="#移动变量" class="headerlink" title="移动变量"></a>移动变量</h2><p>bash shell的<code>shift</code>命令能够用来操作命令行参数。在使用<code>shift</code>命令时，默认情况下它会将每个参数变量向左移动一个位置。所以，变量<code>$3</code>的值会移到$2中，变量<code>$2</code>的值会移到<code>$1</code>中，而变量<code>$1</code>的值则会被删除（注意，变量<code>$0</code>的值，也就是程序名，不会改变）。</p>
<p>这是遍历命令行参数的另一个好方法，尤其是在你不知道到底有多少参数时。你可以只操作第一个参数，移动参数，然后继续操作第一个参数。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
                <span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$sum<span class="token operator">+</span>$<span class="token number">1</span><span class="token variable">))</span></span>
                <span class="token builtin class-name">shift</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token variable">$sum</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">bash</span> temp.sh <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">6</span>

ubuntu@sh:~$ <span class="token function">bash</span> temp.sh <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">6</span>
<span class="token assign-left variable">sum</span><span class="token operator">=</span><span class="token number">21</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="处理选项"><a href="#处理选项" class="headerlink" title="处理选项"></a>处理选项</h2><p>选项是跟在单破折线后面的单个字母，它能改变命令的行为。</p>
<h3 id="处理简单选项"><a href="#处理简单选项" class="headerlink" title="处理简单选项"></a>处理简单选项</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">echo</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
         <span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
                                -a<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Found the -a option"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
                                -b<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Found the -b option"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
                                -c<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Found the -c option"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
                                *<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$1</span> is not an option"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
         <span class="token keyword">esac</span>
         <span class="token builtin class-name">shift</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分离参数和选项、处理带值选项"><a href="#分离参数和选项、处理带值选项" class="headerlink" title="分离参数和选项、处理带值选项"></a>分离参数和选项、处理带值选项</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># extracting options and parameters</span>
<span class="token builtin class-name">echo</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
                <span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
                                -a<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Found the -a option"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
                                -b<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Found the -b option"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
                                -c<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Found the -c option"</span> 
                   <span class="token assign-left variable">coption</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$2 * $3<span class="token variable">)</span></span>
                   <span class="token builtin class-name">echo</span> <span class="token variable">$coption</span>
                   <span class="token builtin class-name">shift</span>
                   <span class="token builtin class-name">shift</span>
                   <span class="token punctuation">;</span><span class="token punctuation">;</span>
                                --<span class="token punctuation">)</span> <span class="token builtin class-name">shift</span>
                                                <span class="token builtin class-name">break</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
                                *<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$1</span> is not an option"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token keyword">esac</span>
                <span class="token builtin class-name">shift</span>
<span class="token keyword">done</span>
<span class="token comment">#</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">param</span> <span class="token keyword">in</span> <span class="token variable">$@</span>
<span class="token keyword">do</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Parameter #<span class="token variable">$count</span>: <span class="token variable">$param</span>"</span>
                <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $count <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="利用选项和参数实现阶乘和求和的计算工具"><a href="#利用选项和参数实现阶乘和求和的计算工具" class="headerlink" title="利用选项和参数实现阶乘和求和的计算工具"></a>利用选项和参数实现阶乘和求和的计算工具</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"sum and factorial tool"</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Usage:"</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"          -a number ..."</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"          -f number"</span>
                <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
                -a<span class="token punctuation">)</span>
                                <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token punctuation">]</span>
                                <span class="token keyword">do</span>
                                                <span class="token assign-left variable">sum</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$sum</span> + <span class="token variable">$2</span><span class="token punctuation">]</span>
                                                <span class="token builtin class-name">shift</span>
                                <span class="token keyword">done</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"sum=<span class="token variable">$sum</span>"</span>
                                <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token comment"># shift</span>
<span class="token comment"># for i in $@</span>
<span class="token comment"># do</span>
 <span class="token comment"># sum=$((sum + i))</span>
<span class="token comment"># done</span>
<span class="token comment"># exit 0</span>
                                <span class="token punctuation">;</span><span class="token punctuation">;</span>
                -f<span class="token punctuation">)</span>
                                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$2</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span>
                                <span class="token keyword">then</span>
                                                <span class="token builtin class-name">echo</span> <span class="token string">"fact=1"</span>
                                                <span class="token builtin class-name">exit</span> <span class="token number">0</span>
                                <span class="token keyword">fi</span>
                                <span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token number">1</span>
                                <span class="token keyword">for</span><span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>$<span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span>
                                <span class="token keyword">do</span>
                                                <span class="token assign-left variable">fact</span><span class="token operator">=</span>$<span class="token punctuation">[</span><span class="token variable">$fact</span> * <span class="token variable">$i</span><span class="token punctuation">]</span>
                                <span class="token keyword">done</span>
                                <span class="token builtin class-name">echo</span> <span class="token assign-left variable">fact</span><span class="token operator">=</span><span class="token variable">$fact</span>
                                <span class="token builtin class-name">exit</span> <span class="token number">0</span>
                                <span class="token punctuation">;</span><span class="token punctuation">;</span>
                -h<span class="token punctuation">)</span>
                                <span class="token punctuation">;</span><span class="token punctuation">;</span>
                *<span class="token punctuation">)</span>
                                <span class="token builtin class-name">echo</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"sum and factorial tool"</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"Usage:"</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"          -a number ..."</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"          -f number"</span>
                                <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="标准化选项"><a href="#标准化选项" class="headerlink" title="标准化选项"></a>标准化选项</h2><p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note5.%E5%A4%84%E7%90%86%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5-2023-06-16-21-20-42.png" alt="5.处理用户输入-2023-06-16-21-20-42"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/7.Shell%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/7.Shell%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">Shell函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>编写shell脚本时，经常需要在多个地方使用了同一段代码。如果只是一小段代码，一般也无关紧要。但要在shell脚本中多次重写大块代码段就太累人了。bash shell提供的用户自定义函数功能可以解决这个问题。可以将shell脚本代码放进函数中封装起来，这样就能在脚本中的任何地方多次使用。</p>
<p>函数是一个脚本代码块，你可以为其命名并在代码中任何位置重用。要在脚本中使用该代码块时，只要使用所起的函数名就行了（这个过程称为调用函数）。</p>
<h2 id="基本脚本函数"><a href="#基本脚本函数" class="headerlink" title="基本脚本函数"></a>基本脚本函数</h2><h3 id="创建函数、调用函数"><a href="#创建函数、调用函数" class="headerlink" title="创建函数、调用函数"></a>创建函数、调用函数</h3><ol>
<li><p>第一种方式采用function关键字，后面跟函数名以及代码块</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">function</span> 函数名 <span class="token punctuation">&#123;</span>
    函数体
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p> name属性定义了赋予函数的唯一名称。脚本中定义的每个函数都必须有一个唯一的名称。commands是构成函数的一条或多条bash shell命令。在调用该函数时，bash shell会按命令在函数中出现的顺序依次执行，就像在普通脚本中一样。</p>
</li>
<li><p>第二种方式更接近其他编程语言的定义方式</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">函数名<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    函数体
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

greet
<span class="token keyword">function</span> <span class="token function-name function">greet</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Hello, World!"</span>
<span class="token punctuation">&#125;</span>
greet
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>当函数在被定义之前使用的话会产生错误信息</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># using a function located in the middle of a script</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token builtin class-name">echo</span> <span class="token string">"This line comes before the function definition"</span>
<span class="token keyword">function</span> <span class="token function-name function">func1</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"This is an exam,rple of a function"</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-le</span> <span class="token number">5</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
func1
<span class="token assign-left variable">count</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$count</span> + <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"This is the end of the loop"</span>
func2
<span class="token builtin class-name">echo</span> <span class="token string">"Now this is the end of the script"</span>
<span class="token keyword">function</span> <span class="token function-name function">func2</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"This is an example of a function"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p><code>bash shell</code>会把函数当作一个小型脚本，运行结束时会返回一个退出状态码。有3种不同的方法来为函数生成<code>退出状态码</code>。</p>
<h3 id="默认退出状态码"><a href="#默认退出状态码" class="headerlink" title="默认退出状态码"></a>默认退出状态码</h3><p>默认情况下，函数的退出状态码是函数中最后一条命令返回的退出状态码。在函数执行结束后，可以用标准变量<code>$?</code>来确定函数的退出状态码。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">function</span> <span class="token function-name function">greet</span> <span class="token punctuation">&#123;</span>
  <span class="token comment"># ls -l badfile</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Hello, World!"</span>
  <span class="token function">ls</span> <span class="token parameter variable">-l</span> badfile
<span class="token punctuation">&#125;</span>

greet
<span class="token builtin class-name">echo</span> <span class="token string">"the exit status is: <span class="token variable">$?</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果注释掉第一个<code>ls</code>命令，由于函数的最后一条语句<code>echo</code>运行成功，该函数的退出状态是<code>0</code>，尽管前一个命令没有运行成功。</p>
<h3 id="使用return命令"><a href="#使用return命令" class="headerlink" title="使用return命令"></a>使用return命令</h3><p><code>bash shell</code>使用<code>return</code>命令来退出函数并返回特定的退出状态码。<code>return</code>命令允许指定一个整数值来定义函数的<code>退出状态码</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># using the return command in a function</span>
<span class="token keyword">function</span> <span class="token function-name function">dbl</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter a value: "</span> value
<span class="token builtin class-name">echo</span> <span class="token string">"doubling the value"</span>
<span class="token builtin class-name">return</span> $<span class="token punctuation">[</span> <span class="token variable">$value</span> * <span class="token number">2</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
dbl
<span class="token builtin class-name">echo</span> <span class="token string">"The new value is <span class="token variable">$?</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>dbl</code>函数会将<code>$value</code>变量中用户输入的值翻倍，然后用<code>return</code>命令返回结果。脚本用<code>$?</code>变量显示了该值。当使用该方法从函数中获取返回值时有两个要点：</p>
<ol>
<li>函数一结束就取返回值</li>
<li>退出状态码必须是0~255</li>
</ol>
<p>如果在用<code>$?</code>变量提取函数返回值之前执行了其他命令，函数的返回值就会丢失。记住，<code>$?</code>变量会返回执行的最后一条命令的退出状态码。<br>第二个问题界定了返回值的取值范围。由于退出状态码必须<code>小于256</code>，函数的结果必须生成一个小于256的整数值。任何大于256的值都会产生一个错误值。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">bash</span> test.sh
Enter a value: <span class="token number">200</span>
doubling the value
The new value is <span class="token number">144</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="使用函数输出"><a href="#使用函数输出" class="headerlink" title="使用函数输出"></a>使用函数输出</h3><p>正如可以将命令的输出保存到shell变量中一样，也可以对函数的输出采用同样的处理办法。可以用这种技术来获得任何类型的函数输出，并将其保存到变量中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>dbl<span class="token variable">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个命令会将<code>dbl</code>函数的输出赋给<code>$result</code>变量。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># using the echo to return a value</span>
<span class="token keyword">function</span> <span class="token function-name function">dbl</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Enter a value: "</span> value
<span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$value</span> * <span class="token number">2</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>dbl<span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"The new value is <span class="token variable">$result</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">bash</span> test.sh
Enter a value: <span class="token number">200</span>
value <span class="token operator">=</span> <span class="token number">400</span>
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="函数中使用变量"><a href="#函数中使用变量" class="headerlink" title="函数中使用变量"></a>函数中使用变量</h2><h3 id="向函数传递参数"><a href="#向函数传递参数" class="headerlink" title="向函数传递参数"></a>向函数传递参数</h3><p>bash shell会将函数当作小型脚本来对待。这意味着可以像普通脚本那样向函数传递参数。</p>
<p>函数可以使用标准的参数环境变量来表示命令行上传给函数的参数。例如，函数名会在<code>$0</code>变量中定义，函数命令行上的任何参数都会通过<code>$1</code>、<code>$2</code>等定义。也可以用特殊变量<code>$#</code>来判断传给函数的参数数目。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 定义一个函数，接收两个参数并输出它们</span>
<span class="token keyword">function</span> <span class="token function-name function">print_two_args</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"第一个参数是：<span class="token variable">$1</span>"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"第二个参数是：<span class="token variable">$2</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># 调用函数，并传递两个参数</span>
print_two_args <span class="token string">"hello"</span> <span class="token string">"world"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">第一个参数是：hello
第二个参数是：world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="在函数中处理变量"><a href="#在函数中处理变量" class="headerlink" title="在函数中处理变量"></a>在函数中处理变量</h3><p>作用域是变量可见的区域。函数中定义的变量与普通变量的作用域不同。也就是说，对脚本的其他部分而言，它们是隐藏的。</p>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>对于全局变量，可以直接在函数中使用或修改。例如：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 定义全局变量</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Tom"</span>

<span class="token comment"># 定义函数</span>
<span class="token function-name function">my_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Hello, <span class="token variable">$name</span>"</span>
  <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Jerry"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># 调用函数</span>
my_func
<span class="token builtin class-name">echo</span> <span class="token string">"Name is <span class="token variable">$name</span>"</span> <span class="token comment"># 输出 "Name is Jerry"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 定义函数</span>
<span class="token function-name function">my_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment"># 定义局部变量</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">0</span>

  <span class="token comment"># 修改局部变量</span>
  <span class="token assign-left variable">count</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$count</span> + <span class="token number">1</span> <span class="token punctuation">]</span>

  <span class="token comment"># 输出局部变量</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Count is <span class="token variable">$count</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># 调用函数</span>
my_func <span class="token comment"># 输出 "Count is 1"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要注意的是，在函数中使用局部变量时，变量名前必须加上 **<code>local</code>**关键字，否则会被认为是全局变量。如果函数中定义了一个与全局变量同名的局部变量，则在函数中访问该变量时，会优先使用局部变量。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 在函数中使用局部变量不会影响到脚本主体中的全局变量的值</span>
<span class="token keyword">function</span> <span class="token function-name function">func1</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">local</span> <span class="token assign-left variable">temp</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$value</span> + <span class="token number">5</span> <span class="token punctuation">]</span>
<span class="token assign-left variable">result</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$temp</span> * <span class="token number">2</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token assign-left variable">temp</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token number">6</span>
func1
<span class="token builtin class-name">echo</span> <span class="token string">"The result is <span class="token variable">$result</span>"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$temp</span> <span class="token parameter variable">-gt</span> <span class="token variable">$value</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> <span class="token string">"temp is larger"</span>
<span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token string">"temp is smaller"</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="在命令行上使用函数"><a href="#在命令行上使用函数" class="headerlink" title="在命令行上使用函数"></a>在命令行上使用函数</h2><p>可以用脚本函数来执行一些十分复杂的操作。有时也很有必要在命令行界面的提示符下直接使用这些函数。一旦在shell中定义了函数，你就可以在整个系统中使用它了，无需担心脚本是不是在<code>PATH</code>环境变量里。重点在于让shell能够识别这些函数。</p>
<h3 id="在命令行上创建函数"><a href="#在命令行上创建函数" class="headerlink" title="在命令行上创建函数"></a>在命令行上创建函数</h3><ul>
<li>单行方式定义函数</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token keyword">function</span> <span class="token function-name function">addem</span> <span class="token punctuation">&#123;</span> <span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$1</span> + <span class="token variable">$2</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
ubuntu@sh:~$ addem <span class="token number">1</span> <span class="token number">2</span>
<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>多行方式定义函数</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token keyword">function</span> <span class="token function-name function">multem</span> <span class="token punctuation">&#123;</span>
<span class="token operator">></span> <span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$1</span> * <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token operator">></span> <span class="token punctuation">&#125;</span>
ubuntu@sh:~$ multem <span class="token number">2</span> <span class="token number">4</span>
<span class="token number">8</span>
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在函数的尾部使用花括号，shell就会知道你已经完成了函数的定义。</p>
<h3 id="在-bashrc文件中定义函数"><a href="#在-bashrc文件中定义函数" class="headerlink" title="在.bashrc文件中定义函数"></a>在.bashrc文件中定义函数</h3><p>在命令行上直接定义<code>shell</code>函数的明显缺点是退出<code>shell</code>时，函数就消失了，这对于一些复杂函数并不适用。此时可以将函数写入一个特定位置并且在<code>shell</code>启动时由<code>shell</code>重新载入。<code>.bashrc</code>文件会在每次<code>shell</code>启动时在主目录下被查找并调用，因此可以在主目录下的.<code>bashrc</code>文件中定义函数。</p>
<p>将以下内容写入到<code>.bashrc</code>文件的末尾：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">function</span> <span class="token function-name function">addem</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$1</span> + <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="创建库"><a href="#创建库" class="headerlink" title="创建库"></a>创建库</h2><p>通过创建函数库文件可以方便在多个脚本中使用同一段代码。以下代码保存在myfuncs文件中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">function</span> <span class="token function-name function">addem</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$1</span> + <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-name function">multem</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$1</span> * <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-name function">divem</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$2</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
<span class="token builtin class-name">echo</span> $<span class="token punctuation">[</span> <span class="token variable">$1</span> / <span class="token variable">$2</span> <span class="token punctuation">]</span>
<span class="token keyword">else</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-1</span>
<span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在另一个脚本中执行<code>myfuncs</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># using a library file the wrong way</span>
./myfuncs
<span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>adem <span class="token number">10</span> <span class="token number">15</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"The result is <span class="token variable">$result</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出信息</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">addem: <span class="token builtin class-name">command</span> not found
The result is<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>使用函数库的关键在于source命令。source命令会在当前shell上下文中执行命令，而不是创建一个新shell。可以用source命令来在shell脚本中运行库文件脚本。这样脚本就可以使用库中的函数了。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># using functions defined in a library file</span>
<span class="token builtin class-name">.</span> ./myfuncs
<span class="token assign-left variable">value1</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token assign-left variable">value2</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">result1</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>addem $value1 $value2<span class="token variable">)</span></span>
<span class="token assign-left variable">result2</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>multem $value1 $value2<span class="token variable">)</span></span>
<span class="token assign-left variable">result3</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>divem $value1 $value2<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"The result of adding them is: <span class="token variable">$result1</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"The result of multiplying them is: <span class="token variable">$result2</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"The result of dividing them is: <span class="token variable">$result3</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="通过函数体实现加减运算"><a href="#通过函数体实现加减运算" class="headerlink" title="通过函数体实现加减运算"></a>通过函数体实现加减运算</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">function</span> <span class="token function-name function">calculate</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">case</span> <span class="token variable">$op</span> <span class="token keyword">in</span>
        <span class="token string">"+"</span><span class="token punctuation">)</span>
            <span class="token assign-left variable">result</span><span class="token operator">=</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"-"</span><span class="token punctuation">)</span>
            <span class="token assign-left variable">result</span><span class="token operator">=</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        *<span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"Error: unsupported operator."</span>
            <span class="token builtin class-name">return</span> <span class="token number">1</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Result: <span class="token variable">$result</span>"</span>
    <span class="token builtin class-name">return</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/8.%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/8.%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>正则表达式定义：由一系列特定字符组成的字符串，用来匹配目标文本中符合指定条件的字符或者字符串。</p>
<p>在编写处理字符串的程序或网页时，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具。换句话说，<strong>正则表达式就是记录文本规则的代码</strong>。</p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note8.%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-2023-06-16-21-24-50.png" alt="8.正则表达式-2023-06-16-21-24-50"></p>
<p>如果你想查找某个目录下的所有的Word文档的话，你会搜索<code>*.doc</code>。在这里，<code>*</code>会被解释成任意的字符串。和通配符类似，正则表达式也是用来进行文本匹配的工具，只不过比起通配符，它能更精确地描述你的需求——当然，代价就是更复杂——比如你可以编写一个正则表达式，用来查找所有以0开头，后面跟着2-3个数字，然后是一个连字号”-“，最后是7或8位数字的字符串(像<em>010-12345678</em>或<em>0376-7654321</em>)。</p>
<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p>正则表达式练习平台：<a target="_blank" rel="noopener" href="https://tool.oschina.net/regex/">https://tool.oschina.net/regex/</a></p>
<p>最简单的正则表达式举例： <code>hi</code> ，它可以精确匹配这样的字符串：由两个字符组成，前一个字符是<code>h</code>,后一个是<code>i</code>。通常，处理正则表达式的工具会提供一个忽略大小写的选项，如果选中了这个选项，它可以匹配<code>hi,HI,Hi,hI</code>这四种情况中的任意一种。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token builtin class-name">echo</span> <span class="token string">"hi,Hi"</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-i</span> <span class="token string">"hi"</span>
hi,Hi
ubuntu@sh:~$
ubuntu@sh:~$ <span class="token builtin class-name">echo</span> <span class="token string">"hi,Hi,HI,hI"</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-i</span> <span class="token string">"hi"</span>
hi,Hi,HI,hI<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p>当目标文本中包含很多字符，比如<code>him,history,high</code>等等。用hi来查找的话，这里边的<code>hi</code>也会被找出来。如果要精确地查找hi这个单词的话，我们应该使用<code>\bhi\b</code>。\b是正则表达式规定的一个特殊代码（元字符，metacharacter），代表着单词的开头或结尾，也就是单词的分界处。</p>
<p>假如要找的是<code>hi</code>后面不远处跟着一个<code>Lucy</code>，应该用<code>\bhi\b.*\bLucy\b</code>。</p>
<p>这里，<code>.</code>是另一个元字符，匹配除了换行符以外的任意字符。<em>同样是元字符，不过它代表的不是字符，也不是位置，而是数量——它指定</em>前边的内容可以连续重复使用任意次以使整个表达式得到匹配。因此，<code>.</code>连在一起就意味着任意数量的不包含换行的字符。现在<code>\bhi\b.*\bLucy\b</code>的意思就很明显：先是一个单词<code>hi</code>,然后是任意个任意字符(但不能是换行)，最后是<code>Lucy</code>这个单词。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token builtin class-name">echo</span> <span class="token string">"hi,Hi,HI,hI,Lucy"</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token entity" title="\b">\b</span>hi<span class="token entity" title="\b">\b</span>.*<span class="token entity" title="\b">\b</span>Lucy<span class="token entity" title="\b">\b</span>"</span>
hi,Hi,HI,hI,Lucy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>0\d\d-\d\d\d\d\d\d\d\d</code>匹配这样的字符串：以0开头，然后是两个数字，然后是一个连字号“-”，最后是8个数字(也就是中国的电话号码)。这里的<code>\d</code>是个新的元字符，匹配一位数字(0，或1，或2，或……)。-不是元字符，只匹配它本身——连字符。</p>
<p>也可以这样写这个表达式：<code>0\d&#123;2&#125;-\d&#123;8&#125;</code>。这里<code>\d</code>后面的<code>&#123;2&#125;(&#123;8&#125;)</code>的意思是前面<code>\d</code>必须连续重复匹配<code>2次(8次)</code>。</p>
<p>练习1：匹配国际格式的电话号码<code>+086-185-553-24528</code></p>
<p>练习2：匹配国内电话号码<code>0511-4405222、021-87888822</code></p>
<ul>
<li>常用的元字符</li>
</ul>
<table>
<thead>
<tr>
<th>代码</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td>\w</td>
<td>匹配字母或数字或下划线或汉字</td>
</tr>
<tr>
<td>\s</td>
<td>匹配任意的空白符</td>
</tr>
<tr>
<td>\d</td>
<td>匹配数字</td>
</tr>
<tr>
<td>\b</td>
<td>匹配单词的开始或结束</td>
</tr>
<tr>
<td>^</td>
<td>匹配字符串的开始</td>
</tr>
<tr>
<td>$</td>
<td>匹配字符串的结束</td>
</tr>
</tbody></table>
<p>元字符<code>^</code>（和数字6在同一个键位上的符号）和<code>$</code>都匹配一个位置，这和<code>\b</code>有点类似。^匹配你要用来查找的字符串的开头，$匹配结尾。这两个代码在验证输入的内容时非常有用，比如一个网站如果要求你填写的QQ号必须为5位到12位数字时，可以使用：<code>^\d&#123;5,12&#125;$</code>。</p>
<ul>
<li>常用的限定符</li>
</ul>
<table>
<thead>
<tr>
<th>代码&#x2F;语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>重复零次或更多次</td>
</tr>
<tr>
<td>+</td>
<td>重复一次或更多次</td>
</tr>
<tr>
<td>?</td>
<td>重复零次或一次</td>
</tr>
<tr>
<td>{n}</td>
<td>重复n次</td>
</tr>
<tr>
<td>{n,}</td>
<td>重复n次或更多次</td>
</tr>
<tr>
<td>{n,m}</td>
<td>重复n到m次</td>
</tr>
</tbody></table>
<ol>
<li><code>\ba\w*\b</code>匹配以字母<code>a</code>开头的单词——先是某个单词开始处<code>(\b)</code>，然后是字母<code>a</code>,然后是任意数量的字母或数字<code>(\w*)</code>，最后是单词结束处<code>(\b)</code>。</li>
<li><code>\d+</code>匹配1个或更多连续的数字。这里的<code>+</code>是和<em>类似的元字符，不同的是</em>匹配重复任意次(可能是0次)，而<code>+</code>则匹配重复1次或更多次。</li>
<li><code>\b\w&#123;6&#125;\b</code> 匹配刚好6个字符的单词。</li>
</ol>
<h2 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h2><p>如果想查找元字符本身的话，比如查找<code>.</code>,或者<code>*</code>,就出现了问题：你没办法指定它们，因为它们会被解释成别的意思。这时就得使用<code>\</code>来取消这些字符的特殊意义。因此，应该使用<code>\.</code>和<code>\*</code>。当然，要查找<code>\</code>本身，也得用<code>\\</code>.</p>
<p>例如：<code>deerchao\.cn</code>匹配<code>deerchao.cn</code>，<code>C:\\Windows</code>匹配<code>C:\Windows</code>。</p>
<h2 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h2><p>要想查找数字，字母或数字，空白是很简单的，因为已经有了对应这些字符集合的元字符，但是如果想匹配没有预定义元字符的字符集合，需要在方括号中列出他们：<code>[aeiou]</code>就匹配任何一个英文元音字母，<code>[.?!]</code>匹配标点符号(.或?或!)。</p>
<p>练习3：匹配(010)88886666，或022-22334455，或02912345678。</p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>想要重复多个字符又该怎么办？可以用小括号来指定<strong>子表达式</strong>(也叫做<strong>分组</strong>)，然后就可以指定这个子表达式的重复次数了。<code>(\d&#123;1,3&#125;\.)&#123;3&#125;\d&#123;1,3&#125;</code>是一个简单的IP地址匹配表达式。要理解这个表达式，按下列顺序分析它：</p>
<ol>
<li><code>\d&#123;1,3&#125;</code>匹配1到3位的数字</li>
<li><code>(\d&#123;1,3&#125;\.)&#123;3&#125;</code>匹配三位数字加上一个英文句号(这个整体也就是这个<strong>分组</strong>)重复3次</li>
<li>最后再加上一个一到三位的数字<code>(\d&#123;1,3&#125;)</code>。</li>
</ol>
<p>它也将匹配*<code>256.300.888.999</code>*这种不可能存在的IP地址。如果能使用算术比较的话，或许能简单地解决这个问题，但是正则表达式中并不提供关于数学的任何功能，所以只能使用冗长的分组，选择，字符类来描述一个正确的IP地址：<code>((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)</code>。</p>
<p>理解这个表达式的关键是理解<code>2[0-4]\d|25[0-5]|[01]?\d\d?</code>。</p>
<h2 id="反义"><a href="#反义" class="headerlink" title="反义"></a>反义</h2><p>有时需要查找不属于某个能简单定义的字符类的字符。比如想查找除了数字以外，其它任意字符都行的情况，这时需要用到<strong>反义</strong>。</p>
<table>
<thead>
<tr>
<th>代码&#x2F;语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>\W</td>
<td>匹配任意不是字母，数字，下划线，汉字的字符</td>
</tr>
<tr>
<td>\S</td>
<td>匹配任意不是空白符的字符</td>
</tr>
<tr>
<td>\D</td>
<td>匹配任意非数字的字符</td>
</tr>
<tr>
<td>\B</td>
<td>匹配不是单词开头或结束的位置</td>
</tr>
<tr>
<td>[^x]</td>
<td>匹配除了x以外的任意字符</td>
</tr>
<tr>
<td>[^aeiou]</td>
<td>匹配除了aeiou这几个字母以外的任意字符</td>
</tr>
</tbody></table>
<p>例子：<code>\S+</code>匹配不包含空白符的字符串。</p>
<p><code>&lt;a[^&gt;]+&gt;</code>匹配用尖括号括起来的以a开头的字符串。</p>
<h2 id="贪婪与懒惰"><a href="#贪婪与懒惰" class="headerlink" title="贪婪与懒惰"></a>贪婪与懒惰</h2><p>当正则表达式中包含能接受重复的限定符时，通常的行为是（在使整个表达式能得到匹配的前提下）匹配<strong>尽可能多</strong>的字符。以这个表达式为例：<code>a.*b</code>，它将会匹配最长的以<code>a</code>开始，以<code>b</code>结束的字符串。如果用它来搜索*<code>aabab</code>*的话，它会匹配整个字符串<code>aabab</code>。这被称为<strong>贪婪</strong>匹配。</p>
<p>有时，我们更需要<strong>懒惰</strong>匹配，也就是匹配<strong>尽可能少</strong>的字符。前面给出的限定符都可以被转化为懒惰匹配模式，只要在它后面加上一个问号<code>?</code>。这样<code>.*?</code>就意味着匹配任意数量的重复，但是在能使整个匹配成功的前提下使用最少的重复。</p>
<p>举例：<code>a.*?b</code>匹配最短的，以<code>a</code>开始，以<code>b</code>结束的字符串。如果把它应用于*<code>aabab</code>*的话，它会匹配<code>aab</code>（第一到第三个字符）和<code>ab</code>（第四到第五个字符）。</p>
<table>
<thead>
<tr>
<th>代码&#x2F;语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>*?</td>
<td>重复任意次，但尽可能少重复</td>
</tr>
<tr>
<td>+?</td>
<td>重复1次或更多次，但尽可能少重复</td>
</tr>
<tr>
<td>??</td>
<td>重复0次或1次，但尽可能少重复</td>
</tr>
<tr>
<td>{n,m}?</td>
<td>重复n到m次，但尽可能少重复</td>
</tr>
<tr>
<td>{n,}?</td>
<td>重复n次以上，但尽可能少重复</td>
</tr>
</tbody></table>
<h2 id="grep命令"><a href="#grep命令" class="headerlink" title="grep命令"></a>grep命令</h2><h3 id="grep基本用法"><a href="#grep基本用法" class="headerlink" title="grep基本用法"></a>grep基本用法</h3><p><code>Linux grep (global regular expression)</code> 命令用于查找文件里符合条件的字符串或正则表达式。</p>
<p>grep 指令用于查找内容包含指定的范本样式的文件，如果发现某文件的内容符合所指定的范本样式，预设 grep 指令会把含有范本样式的那一列显示出来。若不指定任何文件名称，或是所给予的文件名为 <code>-</code>，则 grep 指令会从标准输入设备读取数据。</p>
<ul>
<li><p>基于目标文件进行查找</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">grep</span> <span class="token string">"ubuntu"</span> /etc/passwd
ubuntu:x:1000:1000:ubuntu,,,:/home/ubuntu:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>基于标准输入进行查找</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token function">ssh</span>
root        <span class="token number">864</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>  <span class="token number">65508</span>  <span class="token number">5424</span> ?        Ss   Mar26   <span class="token number">0</span>:00 /usr/sbin/sshd <span class="token parameter variable">-D</span>
root      <span class="token number">18851</span>  <span class="token number">0.0</span>  <span class="token number">0.1</span>  <span class="token number">92796</span>  <span class="token number">6836</span> ?        Ss   Apr06   <span class="token number">0</span>:00 sshd: ubuntu <span class="token punctuation">[</span>priv<span class="token punctuation">]</span>
ubuntu    <span class="token number">18878</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">92796</span>  <span class="token number">3988</span> ?        S    Apr06   <span class="token number">0</span>:02 sshd: ubuntu@pts/0
ubuntu    <span class="token number">23726</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">14220</span>  <span class="token number">1028</span> pts/0    S+   <span class="token number">21</span>:08   <span class="token number">0</span>:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto <span class="token function">ssh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>常用选项</p>
<ul>
<li><code>i</code>：忽略大小写进行匹配。</li>
<li><code>v</code>：反向查找，只打印不匹配的行。</li>
<li><code>n</code>：显示匹配行的行号。</li>
<li><code>r</code>：递归查找子目录中的文件。</li>
<li><code>l</code>：只打印匹配的文件名。</li>
<li><code>c</code>：只打印匹配的行数。</li>
</ul>
</li>
</ul>
<h3 id="grep结合正则表达式用法"><a href="#grep结合正则表达式用法" class="headerlink" title="grep结合正则表达式用法"></a>grep结合正则表达式用法</h3><ul>
<li><p>已有文本文件<code>example.txt</code>，其中存储了一些人的信息，包括姓名、年龄和职业，每行一个人的信息：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">John Smith, <span class="token number">25</span>, Engineer
Alice Brown, <span class="token number">30</span>, Teacher
Bob Johnson, <span class="token number">40</span>, Lawyer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>  查找年龄在 30 岁及以上的人的信息，可以使用以下命令：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token string">'[3-9][0-9],.*'</span> example.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>找出<code>~</code>目录下以<code>.sh</code>结尾的文件名</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> ~ <span class="token parameter variable">-name</span> <span class="token string">"*.sh"</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-Eo</span> <span class="token string">"[^/]+\.sh"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>练习4：显示&#x2F;etc&#x2F;passwd中不以<code>/bin/bash</code>结尾的行</p>
<p>练习1答案：<code>\+\d&#123;3&#125;-\d&#123;3&#125;-\d&#123;3&#125;-\d&#123;5&#125;</code></p>
<p>练习2答案：<code>0\d&#123;3&#125;-\d&#123;7&#125;|0\d&#123;2&#125;-\d&#123;8&#125;</code></p>
<p>练习3答案：<code>\(?0\d&#123;2&#125;[)-]?\d&#123;8&#125;</code></p>
<p>练习4答案：<code>cat /etc/passwd |grep -Ev &quot;(/bin/bash)$”</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/9.%E6%B5%81%E7%BC%96%E8%BE%91%E5%99%A8sed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/9.%E6%B5%81%E7%BC%96%E8%BE%91%E5%99%A8sed/" class="post-title-link" itemprop="url">流编辑器sed</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="sed编辑器定义"><a href="#sed编辑器定义" class="headerlink" title="sed编辑器定义"></a>sed编辑器定义</h2><p>用于处理文本文件中的数据流。它是一种非交互式的编辑器，可以从标准输入（stdin）或文件中读取输入，然后将文本进行转换、替换、删除、添加等操作，最后将处理后的文本输出到标准输出（stdout）或文件中。它的名字来源于“流编辑器（stream editor）”。</p>
<h2 id="sed编辑器特点"><a href="#sed编辑器特点" class="headerlink" title="sed编辑器特点"></a>sed编辑器特点</h2><p>与传统的文本编辑器（如vi和emacs）不同，sed对文件进行的修改是非常快速和高效的，因为它不需要打开文件并读取整个文件内容，而是按行处理文件，只处理必要的部分。此外，sed支持正则表达式，可以在文本文件中进行高级搜索和替换操作。</p>
<h2 id="sed编辑器的工作流程"><a href="#sed编辑器的工作流程" class="headerlink" title="sed编辑器的工作流程"></a>sed编辑器的工作流程</h2><ol>
<li>一次从输入中读取一行数据</li>
<li>根据所提供的编辑器命令匹配数据</li>
<li>按照命令修改流中的数据</li>
<li>将新的数据输出到STDOUT</li>
</ol>
<p>在执行过程中，sed编辑器使用的是基于行的处理方式，即每次处理一行数据。而指令则是根据正则表达式来匹配和处理数据的。通过指令的组合使用，可以实现很多文本处理和编辑的功能，比如替换、删除、插入等操作。</p>
<h2 id="sed编辑器基础"><a href="#sed编辑器基础" class="headerlink" title="sed编辑器基础"></a>sed编辑器基础</h2><h3 id="sed命令格式"><a href="#sed命令格式" class="headerlink" title="sed命令格式"></a>sed命令格式</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> options <span class="token string">'command'</span> inputfile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中，<code>options</code>是可选项，<code>command</code>是sed命令，<code>inputfile</code>是要处理的文件名。如果不指定<code>inputfile</code>，sed将从标准输入读取数据。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'s/oldstring/newstring/'</span> inputfile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中，<code>s</code>表示替换操作，<code>oldstring</code>表示要被替换的字符串，<code>newstring</code>表示替换后的字符串，<code>inputfile</code>表示要处理的文件名。此命令将替换文件中的第一个匹配项。如果要替换所有匹配项，则需要使用<code>g</code>选项，如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'s/oldstring/newstring/g'</span> inputfile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>除了<code>s</code>命令，sed还有其他命令，如<code>p</code>命令（打印指定的行）、<code>d</code>命令（删除指定的行）、<code>a</code>命令（在指定行后添加一行文本）等。这些命令可以组合使用，构成一个完整的sed脚本，用于对文本进行复杂的处理。</p>
<ul>
<li><p>双引号和单引号的区别</p>
<p>  在使用 <code>sed</code> 命令时，单引号和双引号的使用是有区别的。在单引号中，所有的特殊字符都会被视为普通字符，而在双引号中，除了 <code>$</code> 和&#96;&#96;&#96;之外，其他的特殊字符都会被视为普通字符。</p>
<p>  具体来说，在单引号中，变量和命令替换不会被执行，而在双引号中，会先进行变量和命令替换，然后再执行 <code>sed</code> 命令。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"universe"</span>
<span class="token function">sed</span> <span class="token string">"s/world/<span class="token variable">$name</span>/"</span> test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>常见选项</p>
<ul>
<li><p><code>n</code>：取消默认输出，使用print命令完成输出。</p>
</li>
<li><p><code>e</code>：允许多个 sed 命令被执行。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">'s/apple/orange/g'</span> <span class="token parameter variable">-e</span> <span class="token string">'s/\s*$//'</span> file.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>f</code>：指定 sed 命令文件。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-f</span> commands.sed file.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>commands.sed文件内容：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">s/Hello/Hi/
s/World/There/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><code>i</code>：直接修改文件，而不是输出到终端。</p>
</li>
<li><p><code>r</code> 或 <code>E</code>：使用扩展正则表达式。</p>
</li>
</ul>
</li>
<li><p>常见命令</p>
<ul>
<li><p><code>s</code>：替换字符</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将文件中的 apple 替换为 banana</span>
<span class="token function">sed</span> <span class="token string">'s/apple/banana/g'</span> file.txt

<span class="token comment"># 将每行的第一个 apple 替换为 banana</span>
<span class="token function">sed</span> <span class="token string">'s/apple/banana/'</span> file.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>d</code>：删除命令，用于删除文件中的指定行或指定模式。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 删除匹配模式的行</span>
<span class="token function">sed</span> <span class="token string">'/pattern/d'</span> file.txt

<span class="token comment"># 删除 :10 到 20 行</span>
<span class="token function">sed</span> <span class="token string">'10,20d'</span> file.txt

<span class="token comment"># 删除空行</span>
<span class="token function">sed</span> <span class="token string">'/^$/d'</span> file.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>a</code>：添加命令，用于在文件中的指定行后面添加新的内容。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在匹配模式所在行的下一行添加新的内容</span>
<span class="token function">sed</span> <span class="token string">'/pattern/a new line'</span> file.txt

<span class="token comment"># 在指定行号的下一行添加新的内容</span>
<span class="token function">sed</span> <span class="token string">'3a new line'</span> file.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>i</code>：插入命令，用于在文件中的指定行前面插入新的内容。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在匹配模式所在行的上一行插入新的内容</span>
<span class="token function">sed</span> <span class="token string">'/pattern/i new line'</span> file.txt

<span class="token comment"># 在指定行号的上一行插入新的内容</span>
<span class="token function">sed</span> <span class="token string">'3i new line'</span> file.txt

<span class="token comment"># 在文件中插入新的文本行：</span>
<span class="token function">sed</span> <span class="token string">'1i\New Text'</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p><code>c</code>：替换命令，用于将指定行替换为新的内容。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将匹配模式所在行替换为新的内容</span>
<span class="token function">sed</span> <span class="token string">'/pattern/c new line'</span> file.txt

<span class="token comment"># 将指定行号替换为新的内容</span>
<span class="token function">sed</span> <span class="token string">'3c new line'</span> file.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
<h2 id="sed正则表达式用法"><a href="#sed正则表达式用法" class="headerlink" title="sed正则表达式用法"></a>sed正则表达式用法</h2><ol>
<li><p>删除文件中的空行：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'/^$/d'</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 使用正则表达式匹配空行（以行首和行尾之间没有任何字符的行），然后使用 <code>d</code> 命令删除这些行。</p>
</li>
<li><p>删除文件中的注释行：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'/^#/d'</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 使用正则表达式匹配以 <code>#</code>开头的行，然后使用 <code>d</code>命令删除这些行。</p>
</li>
<li><p>按照指定格式输出文件内容：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'s/\(.*\)/&lt;p>\1&lt;\/p>/'</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>指定行前添加#号：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-r</span> <span class="token string">'1,5s/(.*)/#\1/'</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>将文本文件中的每一行都替换为该行的第一个单词：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'s/\([a-zA-Z]*\).*/\1/'</span> test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>提取文本文件中的URL：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-nE</span> <span class="token string">'s#.*(https?://[^ ]*).*#\1#p'</span> test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="vim中的sed用法"><a href="#vim中的sed用法" class="headerlink" title="vim中的sed用法"></a>vim中的sed用法</h2><ol>
<li><p>替换文件中的指定字符串</p>
<p> 在Vim中，可以使用“:%s&#x2F;old&#x2F;new&#x2F;g”命令来替换文件中的指定字符串，其中“%”表示对整个文件进行操作，“s”表示替换，“&#x2F;”用于分隔替换前、替换后的内容，“g”表示全局替换。</p>
</li>
<li><p>删除文件中的指定行</p>
<p> 在Vim中，可以使用“:g&#x2F;pattern&#x2F;d”命令来删除文件中包含指定字符串的行，其中“g”表示全局匹配，“pattern”表示要匹配的字符串，“d”表示删除操作。</p>
</li>
<li><p>在文件中插入指定字符串</p>
<p> 在Vim中，可以使用“:1,$s&#x2F;^&#x2F;string&#x2F;”命令在文件的每一行前插入指定字符串，其中“1,$”表示对整个文件进行操作，“^”表示行首，“string”表示要插入的字符串。</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/18/linux_shell/6.%E4%BD%BF%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%91%88%E7%8E%B0%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/18/linux_shell/6.%E4%BD%BF%E7%94%A8%E9%87%8D%E5%AE%9A%E5%90%91%E5%91%88%E7%8E%B0%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">使用重定向呈现数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-18 11:31:23" itemprop="dateCreated datePublished" datetime="2023-04-18T11:31:23+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>有些时候想要保存某个命令的输出而不仅仅只是让它显示在显示器上。 <code>bash shell</code>提供了几个操作符，可以将命令的输出重定向到另一个位置（比如文件）。重定向可以用于输入，也可以用于输出，可以将文件重定向到命令输入。</p>
<h2 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">date</span> <span class="token operator">></span> test6
ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> test6
-rw-rw-r-- <span class="token number">1</span> ubuntu ubuntu <span class="token number">29</span> Mar <span class="token number">26</span> <span class="token number">19</span>:23 test6
ubuntu@sh:~$ <span class="token function">cat</span> test6
Sun Mar <span class="token number">26</span> <span class="token number">19</span>:23:54 PDT <span class="token number">2023</span>
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重定向操作符创建了一个文件 <code>test6</code>（通过默认的 <code>umask</code>设置），并将 <code>date</code>命令的输出重定向到该文件中。如果输出文件已经存在了，重定向操作符会用新的文件数据覆盖已有文件。</p>
<p>有时，可能并不想覆盖文件原有内容，而是想要将命令的输出追加到已有文件中，比如正在创建一个记录系统上某个操作的日志文件。在这种情况下，可以用双大于号 <code>（&gt;&gt;）</code>来追加数据。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">who</span> <span class="token operator">>></span> test6
ubuntu@sh:~$ <span class="token function">cat</span> test6
Sun Mar <span class="token number">26</span> <span class="token number">19</span>:23:54 PDT <span class="token number">2023</span>
ubuntu   tty1         <span class="token number">2023</span>-03-26 <span class="token number">19</span>:01
ubuntu   pts/0        <span class="token number">2023</span>-03-26 <span class="token number">19</span>:01 <span class="token punctuation">(</span><span class="token number">192.168</span>.13.1<span class="token punctuation">)</span>
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>test6</code>文件在原来<code>who</code>命令输出的基础上又加上了<code>date</code>命令的输出</p>
<h2 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h2><p>输入重定向和输出重定向正好相反。输入重定向将文件的内容重定向到命令，而非将命令的输出重定向到文件。输入重定向符号是小于号<code>（&lt;）</code></p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">ubuntu@sh:~$ <span class="token function">cat</span> test6
Sun Mar 26 19:23:54 PDT 2023
ubuntu   tty1         2023-03-26 19:01
ubuntu   pts/0        2023-03-26 19:01 <span class="token punctuation">(</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>13<span class="token punctuation">.</span>1<span class="token punctuation">)</span>
ubuntu@sh:~$ wc &lt; test6
  3  15 122
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>wc</code>命令可以对对数据中的文本进行计数。默认情况下，它会输出3个值：文本的行数，文本的词数，文本的字节数。</p>
<h2 id="呈现数据"><a href="#呈现数据" class="headerlink" title="呈现数据"></a>呈现数据</h2><h3 id="标准文件描述符"><a href="#标准文件描述符" class="headerlink" title="标准文件描述符"></a>标准文件描述符</h3><p>Linux的标准文件描述符：</p>
<table>
<thead>
<tr>
<th>文件描述符</th>
<th>缩写</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>STDIN</td>
<td>标准输入</td>
</tr>
<tr>
<td>1</td>
<td>STDOUT</td>
<td>标准输出</td>
</tr>
<tr>
<td>2</td>
<td>STDERR</td>
<td>标准错误</td>
</tr>
</tbody></table>
<ul>
<li>这三个特殊文件描述符会处理脚本的输入和输出。shell用它们将shell默认的输入和输出导向到相应的位置。</li>
</ul>
<ol>
<li><p>STDIN(标准输入)</p>
<p> STDIN文件描述符代表<code>shell</code>的标准输入。对终端界面来说，标准输入是键盘。shell从STDIN文件描述符对应的键盘获得输入，在用户输入时处理每个字符。</p>
<p> 在使用输入重定向符号<code>（&lt;）</code>时，Linux会用重定向指定的文件来替换标准输入文件描述符。它会读取文件并提取数据，就如同它是键盘上键入的。</p>
<p> 当在命令行上只输入<code>cat</code>命令时，它会从<code>STDIN</code>接受输入。输入一行，<code>cat</code>命令就会显示出一行。<br> 但你也可以通过<code>STDIN</code>重定向符号强制<code>cat</code>命令接受来自另一个<code>非STDIN</code>文件的输入。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">cat</span> <span class="token operator">&lt;</span> test6
Sun Mar <span class="token number">26</span> <span class="token number">19</span>:23:54 PDT <span class="token number">2023</span>
ubuntu   tty1         <span class="token number">2023</span>-03-26 <span class="token number">19</span>:01
ubuntu   pts/0        <span class="token number">2023</span>-03-26 <span class="token number">19</span>:01 <span class="token punctuation">(</span><span class="token number">192.168</span>.13.1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>STDOUT(标准输出)</p>
<p> <code>STDOUT</code>文件描述符代表<code>shell</code>的标准输出。在终端界面上，标准输出就是终端显示器。<code>shell</code>的所有输出（包括<code>shell</code>中运行的程序和脚本）会被定向到标准输出中，也就是显示器。</p>
<p> 默认情况下，大多数bash命令会将输出导向STDOUT文件描述符。我们也可以使用<code>&gt;</code>将输出重定向到文件。</p>
<p> 当命令生成错误消息时，shell并未将错误消息重定向到输出重定向文件。shell创建了输出重定向文件，但错误消息却显示在了显示器屏幕上。注意，在显示test3文件的内容时并没有任何错误。test3文件创建成功了，只是里面是空的。shell对于错误消息的处理是跟普通输出分开的。如果创建了在后台模式下运行的shell脚本，通常必须依赖发送到日志文件的输出消息。用这种方法的话，如果出现了错误信息，这些信息是不会出现在日志文件中的。需要换种方法来处理。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> badfile <span class="token operator">></span> test3
ls: cannot access <span class="token string">'badfile'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory
ubuntu@sh:~$ <span class="token function">cat</span> test3
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>STDERR(标准错误)</p>
<p> shell通过特殊的STDERR文件描述符来处理错误消息。STDERR文件描述符代表shell的标准错误输出。shell或shell中运行的程序和脚本出错时生成的错误消息都会发送到这个位置。默认情况下，STDERR文件描述符会和STDOUT文件描述符指向同样的地方（尽管分配给它们的文件描述符值不同）。也就是说，默认情况下，错误消息也会输出到显示器输出中。但从上面的例子可以看出，STDERR并不会随着STDOUT的重定向而发生改变。使用脚本时，常常会想改变这种行为，尤其是当希望将错误消息保存到日志文件中的时候。</p>
</li>
</ol>
<h3 id="重定向错误"><a href="#重定向错误" class="headerlink" title="重定向错误"></a>重定向错误</h3><ul>
<li><p>只重定向错误</p>
<p>  STDERR文件描述符被设成2。可以选择只重定向错误消息，将该文件描述符值放在重定向符号前。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> badfile <span class="token operator"><span class="token file-descriptor important">2</span>></span> test3
ubuntu@sh:~$ <span class="token function">cat</span> test3
ls: cannot access <span class="token string">'badfile'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>重定向错误和数据</p>
<p>  如果想重定向错误和正常输出，必须用两个重定向符号。需要在符号前面放上待重定向数据所对应的文件描述符，然后指向用于保存数据的输出文件。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> test3 test6 badtest <span class="token operator"><span class="token file-descriptor important">2</span>></span>test7 <span class="token operator"><span class="token file-descriptor important">1</span>></span>test8
ubuntu@sh:~$ <span class="token function">cat</span> test7
ls: cannot access <span class="token string">'badtest'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory
ubuntu@sh:~$ <span class="token function">cat</span> test8
-rw-rw-r-- <span class="token number">1</span> ubuntu ubuntu  <span class="token number">55</span> Mar <span class="token number">26</span> <span class="token number">20</span>:24 test3
-rw-rw-r-- <span class="token number">1</span> ubuntu ubuntu <span class="token number">122</span> Mar <span class="token number">26</span> <span class="token number">19</span>:27 test6
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  shell利用<code>1&gt;</code>符号将ls命令的正常输出重定向到了test8文件，而这些输出本该是进入<code>STDOUT</code>的。所有本该输出到<code>STDERR</code>的错误消息通过<code>2&gt;</code>符号被重定向到了test7文件。</p>
<p>  可以用这种方法将脚本的正常输出和脚本生成的错误消息分离开来。这样就可以轻松地识别出错误信息。另外也可以将<code>STDERR</code>和<code>STDOUT</code>的输出重定向到同一个输出文件。为此<code>bash shell</code>提供了特殊的重定向符号<code>&amp;&gt;</code>。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> badtest test3 test6 badtest <span class="token operator">&amp;></span> test7
ubuntu@sh:~$ <span class="token function">cat</span> test7
ls: cannot access <span class="token string">'badtest'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory
ls: cannot access <span class="token string">'badtest'</span><span class="token builtin class-name">:</span> No such <span class="token function">file</span> or directory
-rw-rw-r-- <span class="token number">1</span> ubuntu ubuntu  <span class="token number">55</span> Mar <span class="token number">26</span> <span class="token number">20</span>:24 test3
-rw-rw-r-- <span class="token number">1</span> ubuntu ubuntu <span class="token number">122</span> Mar <span class="token number">26</span> <span class="token number">19</span>:27 test6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="在脚本中重定向输出"><a href="#在脚本中重定向输出" class="headerlink" title="在脚本中重定向输出"></a>在脚本中重定向输出</h2><p>可以在脚本中用STDOUT和STDERR文件描述符以在多个位置生成输出，只要简单地重定向相应的文件描述符就行了。有两种方法来在脚本中重定向输出：</p>
<ol>
<li>临时重定向行输出</li>
<li>永久重定向脚本中的所有命令</li>
</ol>
<h3 id="临时重定向"><a href="#临时重定向" class="headerlink" title="临时重定向"></a>临时重定向</h3><p>如果有意在脚本中生成错误消息，可以将单独的一行输出重定向到STDERR。所需要做的是使用输出重定向符来将输出信息重定向到STDERR文件描述符。在重定向到文件描述符时，必须在文件描述符数字之前加一个&amp;：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">cat</span> test.sh
<span class="token comment">#!/bin/bash</span>

<span class="token builtin class-name">echo</span> <span class="token string">"This is an error"</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span>
<span class="token builtin class-name">echo</span> <span class="token string">"This is normal output"</span>

ubuntu@sh:~$ <span class="token function">bash</span> test.sh <span class="token operator"><span class="token file-descriptor important">2</span>></span> test9
This is normal output
ubuntu@sh:~$ <span class="token function">cat</span> test9
This is an error<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="永久重定向"><a href="#永久重定向" class="headerlink" title="永久重定向"></a>永久重定向</h3><p>如果脚本中有大量数据需要重定向，那重定向每个echo语句就会很烦琐，用exec命令告诉shell在脚本执行期间重定向某个特定文件描述符，exec命令会启动一个新shell并将STDOUT文件描述符重定向到文件。脚本中发给STDOUT的所有输出会被重定向到文件。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># redirecting all output to a file</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">1</span>></span>testout
<span class="token builtin class-name">echo</span> <span class="token string">"This is a test of redirecting all output"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"from a script to another file."</span>
<span class="token builtin class-name">echo</span> <span class="token string">"without having to redirect every individual line"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">bash</span> test.sh
ubuntu@sh:~$ <span class="token function">cat</span> testout
This is a <span class="token builtin class-name">test</span> of redirecting all output
from a script to another file.
without having to redirect every individual line<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>脚本执行过程中重定向</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># redirecting output to different locations</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>testerror
<span class="token builtin class-name">echo</span> <span class="token string">"This is the start of the script"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"now redirecting all output to another location"</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">1</span>></span>testout
<span class="token builtin class-name">echo</span> <span class="token string">"This output should go to the testout file"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"but this should go to the testerror file"</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="在脚本中重定向输入"><a href="#在脚本中重定向输入" class="headerlink" title="在脚本中重定向输入"></a>在脚本中重定向输入</h2><p>可以使用与脚本中重定向STDOUT和STDERR相同的方法来将STDIN从键盘重定向到其他位置。exec命令允许将STDIN重定向到Linux系统上的文件中。这个重定向只要在脚本需要输入时就会作用</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># redirecting file input</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span> testfile
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> line
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Line #<span class="token variable">$count</span>: <span class="token variable">$line</span>"</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$count</span> + <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="创建自己的重定向"><a href="#创建自己的重定向" class="headerlink" title="创建自己的重定向"></a>创建自己的重定向</h2><h3 id="创建输出文件描述符"><a href="#创建输出文件描述符" class="headerlink" title="创建输出文件描述符"></a>创建输出文件描述符</h3><p>在脚本中重定向输入和输出时，并不局限于这3个默认的文件描述符。在shell中最多可以有9个打开的文件描述符。其他6个从3~8的文件描述符均可用作输入或输出重定向。可以将这些文件描述符中的任意一个分配给文件，然后在脚本中使用它们。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># using an alternative file descriptor</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">3</span>></span>test3out
<span class="token builtin class-name">echo</span> <span class="token string">"This should display on the monitor"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"and this should be stored in the file"</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;3</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Then this should be back on the monitor"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="创建输入文件描述符"><a href="#创建输入文件描述符" class="headerlink" title="创建输入文件描述符"></a>创建输入文件描述符</h3><p>可以用和重定向输出文件描述符同样的办法重定向输入文件描述符。在重定向到文件之前，先将STDIN文件描述符保存到另外一个文件描述符，然后在读取完文件之后再将STDIN恢复到它原来的位置。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># redirecting input file descriptors</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">6</span>&lt;</span><span class="token file-descriptor important">&amp;0</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span> testfile
<span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> line
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Line #<span class="token variable">$count</span>: <span class="token variable">$line</span>"</span>
<span class="token assign-left variable">count</span><span class="token operator">=</span>$<span class="token punctuation">[</span> <span class="token variable">$count</span> + <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token file-descriptor important">&amp;6</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Are you done now? "</span> answer
<span class="token keyword">case</span> <span class="token variable">$answer</span> <span class="token keyword">in</span>
Y<span class="token operator">|</span>y<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Goodbye"</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
N<span class="token operator">|</span>n<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Sorry, this is the end."</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="组织命令输出"><a href="#组织命令输出" class="headerlink" title="组织命令输出"></a>组织命令输出</h2><p>有时候，可能不想显示脚本的输出。这在将脚本作为后台进程运行时很常见。可以将STDERR重定向到一个叫作null文件的特殊&#x2F;文件。shell输出到null文件的任何数据都不会保存，全部都被丢掉了。在Linux系统上null文件的标准位置是&#x2F;dev&#x2F;null。你重定向到该位置的任何数据都会被丢掉，不会显示。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> <span class="token operator">></span> /dev/null
ubuntu@sh:~$
ubuntu@sh:~$ <span class="token function">ls</span> <span class="token parameter variable">-al</span> badfile <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null
ubuntu@sh:~$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/source/index.md/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/source/index.md/">1</a><span class="page-number current">2</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
