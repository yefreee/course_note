<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title">
<meta property="og:url" content="http://example.com/source/index.md/index.html">
<meta property="og:site_name">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/source/index.md/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"source/index.md/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title></title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title"></h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/14/private_clouds/6.OpenStack%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/10/14/private_clouds/6.OpenStack%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">OpenStack实例管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-14 19:18:37" itemprop="dateCreated datePublished" datetime="2023-10-14T19:18:37+08:00">2023-10-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-16 13:13:27" itemprop="dateModified" datetime="2023-10-16T13:13:27+08:00">2023-10-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="理解Nova计算服务"><a href="#理解Nova计算服务" class="headerlink" title="理解Nova计算服务"></a>理解Nova计算服务</h2><h3 id="Nova计算服务简介"><a href="#Nova计算服务简介" class="headerlink" title="Nova计算服务简介"></a>Nova计算服务简介</h3><p>Nova 管理虚拟机实例的整个生命周期，包括创建、启动、停止、暂停、恢复和销毁等操作。它提供了丰富的API接口和命令行工具，方便用户进行实例管理和监控。</p>
<p>Nova 根据用户的请求和资源的可用性，通过Nova Scheduler进行资源调度和分配。它会选择合适的物理主机来部署虚拟机实例，以实现资源的优化利用和负载均衡。</p>
<p>Nova需要下列OpenStack服务的支持：</p>
<ul>
<li><p>Keystone：为所有的OpenStack服务提供身份管理和认证。</p>
</li>
<li><p>Glance：提供计算用的镜像库。</p>
</li>
<li><p>Neutron：负责配置管理计算实例启动时的虚拟或物理网络连接。</p>
</li>
<li><p>Placement：负责跟踪云中可用的资源库存。</p>
</li>
</ul>
<h3 id="Nova计算服务架构"><a href="#Nova计算服务架构" class="headerlink" title="Nova计算服务架构"></a>Nova计算服务架构</h3><img src="https://vault.taojie.fun:28089/i/2023/10/15/2023-10-15-1697380021.png" alt="1697380021376.png" title="1697380021376.png" />

<ul>
<li><p>DB：用于数据存储的SQL数据库。</p>
</li>
<li><p>API：接收 HTTP 请求、转换命令并通过 oslo.messaging 队列或 HTTP 与其他组件通信的组件。</p>
</li>
<li><p>Scheduler：决定哪个主机获取每个实例。</p>
</li>
<li><p>Compute：管理虚拟机和虚拟机的通信。</p>
</li>
<li><p>Conductor：处理需要协调（构建&#x2F;调整大小）的请求，充当数据库代理，或处理对象转换。</p>
</li>
</ul>
<h3 id="实例创建流程"><a href="#实例创建流程" class="headerlink" title="实例创建流程"></a>实例创建流程</h3><ol>
<li><p>用户发起创建请求：用户通过 Nova API 或控制台发起创建实例的请求，提供所需的实例配置信息，如镜像、规格（flavor）、网络等。</p>
</li>
<li><p>Nova Scheduler 进行资源调度：Nova Scheduler 根据实例的需求和当前资源的可用性，在可用的计算节点中选择最合适的物理主机来部署实例。它考虑诸如资源利用率、负载均衡和亲和性等因素进行决策。</p>
</li>
<li><p>Nova Compute 创建实例：一旦 Nova Scheduler 选择了目标计算节点，它会将创建实例的请求发送给相应的 Nova Compute 节点。Nova Compute 负责与底层的 Hypervisor 进行通信，通过创建虚拟机实例的 API 或命令来执行实际的创建操作。</p>
</li>
<li><p>实例启动和初始化：Nova Compute 在目标计算节点上启动虚拟机实例，并进行初始化配置。这包括分配计算资源、设置网络连接、加载所需的镜像和用户数据等。</p>
</li>
<li><p>实例状态更新：Nova Compute 在实例创建过程中会定期向 Nova Conductor 汇报实例的状态更新。这包括实例的创建进度、IP 地址分配和可用性等信息，以便 Nova Conductor 进行监控和管理。</p>
</li>
</ol>
<h2 id="Nova服务安装"><a href="#Nova服务安装" class="headerlink" title="Nova服务安装"></a>Nova服务安装</h2><h3 id="作业与实验环境"><a href="#作业与实验环境" class="headerlink" title="作业与实验环境"></a>作业与实验环境</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://wxstc.fanya.chaoxing.com/portal">超星网址</a><br><code>快照管理</code>：控制节点选择<code>项目8</code>，计算节点选择<code>5.3.9</code></p>
</blockquote>
<h3 id="安装配置控制节点上的Nova服务"><a href="#安装配置控制节点上的Nova服务" class="headerlink" title="安装配置控制节点上的Nova服务"></a>安装配置<code>控制节点</code>上的Nova服务</h3><ol>
<li><p>安装Nova软件包</p>
<ol>
<li><p>使用<code>yum -y install</code>在控制节点上安装四个软件包：openstack-nova-api openstack-nova-conductor openstack-nova-scheduler openstack-nova-novncproxy</p>
</li>
<li><p>安装<code>openstack-nova-api</code>时会创建名为“nova”的同名用户和用户组，使用以下命令检查：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd |grep nova</span>
nova:x:162:162:OpenStack Nova Daemons:/var/lib/nova:/sbin/nologin
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/group |grep nova</span>
nobody:x:99:nova
nova:x:162:nova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>创建Nova数据库并授权</p>
<ol>
<li><p>进入数据库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p000000</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">9</span>
Server version: <span class="token number">10.3</span>.20-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用<code>CREATE DATABASE</code>命令新建“nova-api”，“nova_cell0”，“nova”三个数据库</p>
</li>
<li><p>使用以下命令进行数据库授权</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_api.* TO <span class="token string">'nova'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_api.* TO <span class="token string">'nova'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="token string">'nova'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="token string">'nova'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova.* TO <span class="token string">'nova'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON nova.* TO <span class="token string">'nova'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>修改Nova配置文件</p>
<ol>
<li><p>去掉配置文件中的空行</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 备份配置文件</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/nova/nova.conf /etc/nova/nova.bak</span>
<span class="token comment"># 2. 去掉空行</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev '^$|#' /etc/nova/nova.bak > /etc/nova/nova.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置连接“nova”和“nova_api”数据库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>api_database<span class="token punctuation">]</span>
<span class="token assign-left variable">connection</span><span class="token operator">=</span>mysql+pymysql://nova:000000@controller/nova_api
<span class="token punctuation">[</span>database<span class="token punctuation">]</span>
<span class="token assign-left variable">connection</span><span class="token operator">=</span>mysql+pymysql://nova:000000@controller/nova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Keystone组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>api<span class="token punctuation">]</span>
auth_strategy <span class="token operator">=</span> keystone
<span class="token punctuation">[</span>keystone_authtoken<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
memcached_servers <span class="token operator">=</span> controller:11211
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> nova
password <span class="token operator">=</span> 000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Placement组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>placement<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> placement
password <span class="token operator">=</span> 000000
region_name <span class="token operator">=</span> RegionOne<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Glance组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>glance<span class="token punctuation">]</span>
api_servers <span class="token operator">=</span> http://controller:9292<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置锁路径</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oslo_concurrency<span class="token punctuation">]</span>
lock_path <span class="token operator">=</span> /var/lib/nova/tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置消息队列和防火墙</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>DEFAULT<span class="token punctuation">]</span>
enabled_apis <span class="token operator">=</span> osapi_compute,metadata
transport_url <span class="token operator">=</span> rabbit://rabbitmq:000000@controller:5672
my_ip <span class="token operator">=</span> <span class="token number">192.168</span>.10.10
use_neutron <span class="token operator">=</span> <span class="token boolean">true</span>
firewall_driver <span class="token operator">=</span> nova.virt.firewall.NoopFirewallDriver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置VNC连接</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>vnc<span class="token punctuation">]</span>
enabled <span class="token operator">=</span> <span class="token boolean">true</span>
server_listen <span class="token operator">=</span> <span class="token variable">$my_ip</span>
server_proxyclient_address <span class="token operator">=</span> <span class="token variable">$my_ip</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>初始化数据库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 同步nova_api数据库</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage api_db sync"</span>
<span class="token comment"># 创建cell1</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1"</span>
<span class="token comment"># 数据库映射</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage cell_v2 map_cell0"</span>
<span class="token comment"># 同步nova数据库</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage db sync"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>验证单元注册</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nova-manage cell_v2 list_cells</span>
+-------+--------------------------------------+----------------------------------------+-------------------------------------------------+----------+
<span class="token operator">|</span>  Name <span class="token operator">|</span>                 UUID                 <span class="token operator">|</span>             Transport URL              <span class="token operator">|</span>               Database Connection               <span class="token operator">|</span> Disabled <span class="token operator">|</span>
+-------+--------------------------------------+----------------------------------------+-------------------------------------------------+----------+
<span class="token operator">|</span> cell0 <span class="token operator">|</span> 00000000-0000-0000-0000-000000000000 <span class="token operator">|</span>                 none:/                 <span class="token operator">|</span> mysql+pymysql://nova:****@controller/nova_cell0 <span class="token operator">|</span>  False   <span class="token operator">|</span>
<span class="token operator">|</span> cell1 <span class="token operator">|</span> 0a7038d1-6f69-46ad-8b3f-bf8cadc831c5 <span class="token operator">|</span> rabbit://rabbitmq:****@controller:5672 <span class="token operator">|</span>    mysql+pymysql://nova:****@controller/nova    <span class="token operator">|</span>  False   <span class="token operator">|</span>
+-------+--------------------------------------+----------------------------------------+-------------------------------------------------+----------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业1：单元注册结果截图</p>
</blockquote>
</li>
</ol>
<h3 id="Nova组件初始化"><a href="#Nova组件初始化" class="headerlink" title="Nova组件初始化"></a>Nova组件初始化</h3><ol>
<li><p>创建Nova用户</p>
<ol>
<li><p>执行<code>source admin-login</code>导入环境变量进行登录</p>
</li>
<li><p>在“default”域中创建用户“nova”，密码为“000000”：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack user create --domain default --password 000000 nova</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> Field               <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> domain_id           <span class="token operator">|</span> default                          <span class="token operator">|</span>
<span class="token operator">|</span> enabled             <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                  <span class="token operator">|</span> 5e2fbfe049194a748f6d040686bef9f5 <span class="token operator">|</span>
<span class="token operator">|</span> name                <span class="token operator">|</span> nova                             <span class="token operator">|</span>
<span class="token operator">|</span> options             <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> password_expires_at <span class="token operator">|</span> None                             <span class="token operator">|</span>
+---------------------+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这里所创建的用户和<code>nova.conf</code>配置文件中的[keystone_authtoken]配置的用户名密码一致</p>
</blockquote>
</li>
<li><p>分配“nova”用户在“project”项目中的“admin”角色</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role add --project project --user nova admin</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
</li>
<li><p>创建Nova服务和端点</p>
<ol>
<li><p>创建名为“nova”，类型为“compute”的服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack service create --name nova compute</span>
+---------+----------------------------------+
<span class="token operator">|</span> Field   <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------+----------------------------------+
<span class="token operator">|</span> enabled <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>      <span class="token operator">|</span> b6028ad5a1e545a992dcdeaff3e0f7a6 <span class="token operator">|</span>
<span class="token operator">|</span> name    <span class="token operator">|</span> nova                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">type</span>    <span class="token operator">|</span> compute                          <span class="token operator">|</span>
+---------+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建服务端点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 公众用户端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne nova public http://controller:8774/v2.1</span>
<span class="token comment"># 2. 内部组件端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne nova internal http://controller:8774/v2.1</span>
<span class="token comment"># 3. admin用户端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne compute admin http://controller:8774/v2.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>启动控制节点的Nova服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 设置开机启动</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable openstack-nova-api openstack-nova-conductor openstack-nova-scheduler openstack-nova-novncproxy</span>
<span class="token comment"># 2. 设置立即启动</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl start openstack-nova-api openstack-nova-conductor openstack-nova-scheduler openstack-nova-novncproxy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>检查Nova组件的运行</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># netstat -nutpl|grep 877</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8774            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">6531</span>/python2
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:8775            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">6531</span>/python2
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::8778                 :::*                    LISTEN      <span class="token number">1035</span>/httpd
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack compute service list</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span> ID <span class="token operator">|</span> Binary         <span class="token operator">|</span> Host       <span class="token operator">|</span> Zone     <span class="token operator">|</span> Status  <span class="token operator">|</span> State <span class="token operator">|</span> Updated At                 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> nova-conductor <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T00:33:33.000000 <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> nova-scheduler <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T00:33:26.000000 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业2：Nova组件运行截图</p>
</blockquote>
</li>
</ol>
<h3 id="安装配置计算节点上的Nova服务"><a href="#安装配置计算节点上的Nova服务" class="headerlink" title="安装配置计算节点上的Nova服务"></a>安装配置<code>计算节点</code>上的Nova服务</h3><ol>
<li><p>安装Nova软件包</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum -y install openstack-nova-compute</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>验证系统内是否有名为“nova”的用户和用户组</p>
</blockquote>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd |grep nova</span>
nova:x:162:162:OpenStack Nova Daemons:/var/lib/nova:/sbin/nologin
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/group |grep nova</span>
nobody:x:99:nova
qemu:x:107:nova
libvirt:x:991:nova
nova:x:162:nova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改Nova配置文件<code>/etc/nova/nova.conf</code></p>
<ol>
<li><p>去掉配置文件中的空行</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 备份配置文件</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/nova/nova.conf /etc/nova/nova.bak</span>
<span class="token comment"># 2. 去掉空行</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev '^$|#' /etc/nova/nova.bak > /etc/nova/nova.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Keystone组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>api<span class="token punctuation">]</span>
auth_strategy <span class="token operator">=</span> keystone
<span class="token punctuation">[</span>keystone_authtoken<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
memcached_servers <span class="token operator">=</span> controller:11211
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> nova
password <span class="token operator">=</span> 000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Placement组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>placement<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
auth_type <span class="token operator">=</span> password
project_domain_name <span class="token operator">=</span> Default
user_domain_name <span class="token operator">=</span> Default
project_name <span class="token operator">=</span> project
username <span class="token operator">=</span> placement
password <span class="token operator">=</span> 000000
region_name <span class="token operator">=</span> RegionOne<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Glance组件交互</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>glance<span class="token punctuation">]</span>
api_servers <span class="token operator">=</span> http://controller:9292<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置锁路径</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oslo_concurrency<span class="token punctuation">]</span>
lock_path <span class="token operator">=</span> /var/lib/nova/tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>配置消息队列和防火墙</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>DEFAULT<span class="token punctuation">]</span>
enabled_apis <span class="token operator">=</span> osapi_compute,metadata
transport_url <span class="token operator">=</span> rabbit://rabbitmq:000000@controller:5672
my_ip <span class="token operator">=</span> <span class="token number">192.168</span>.10.20
use_neutron <span class="token operator">=</span> <span class="token boolean">true</span>
firewall_driver <span class="token operator">=</span> nova.virt.firewall.NoopFirewallDriver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置VNC连接</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>vnc<span class="token punctuation">]</span>
enabled <span class="token operator">=</span> <span class="token boolean">true</span>
server_listen <span class="token operator">=</span> <span class="token number">0.0</span>.0.0
server_proxyclient_address <span class="token operator">=</span> <span class="token variable">$my_ip</span>
novncproxy_base_url <span class="token operator">=</span> http://192.168.10.10:6080/vnc_auto.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置<code>[libvirt]</code>部分，设置虚拟化类型<code>qemu</code></p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>libvirt<span class="token punctuation">]</span>
virt_type <span class="token operator">=</span> qemu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>启动计算节点的Nova服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable libvirtd openstack-nova-compute</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-nova-compute.service to /usr/lib/systemd/system/openstack-nova-compute.service.
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl start libvirtd openstack-nova-compute</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
</ol>
<h3 id="发现计算节点并检验"><a href="#发现计算节点并检验" class="headerlink" title="发现计算节点并检验"></a>发现计算节点并检验</h3><blockquote>
<p>下面的命令在控制节点执行</p>
</blockquote>
<ol>
<li><p>执行<code>source admin-login</code>导入环境变量登录</p>
</li>
<li><p>发现新的计算节点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su nova -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>设置<code>/etc/nova/nova.conf</code>配置自动发现计算节点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>scheduler<span class="token punctuation">]</span>
discover_hosts_in_cells_internal <span class="token operator">=</span> <span class="token number">60</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 重启nova-api服务使配置生效</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart openstack-nova-api</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>验证nova模块的状态</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看模块的运行状态</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack compute service list</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span> ID <span class="token operator">|</span> Binary         <span class="token operator">|</span> Host       <span class="token operator">|</span> Zone     <span class="token operator">|</span> Status  <span class="token operator">|</span> State <span class="token operator">|</span> Updated At                 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> nova-conductor <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T01:22:53.000000 <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> nova-scheduler <span class="token operator">|</span> controller <span class="token operator">|</span> internal <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T01:22:57.000000 <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> nova-compute   <span class="token operator">|</span> compute    <span class="token operator">|</span> nova     <span class="token operator">|</span> enabled <span class="token operator">|</span> up    <span class="token operator">|</span> <span class="token number">2023</span>-10-16T01:22:57.000000 <span class="token operator">|</span>
+----+----------------+------------+----------+---------+-------+----------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用状态检测工具验证，应该显示4个success</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># nova-status upgrade check</span>
+--------------------------------+
<span class="token operator">|</span> Upgrade Check Results          <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Cells v2                <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Placement API           <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Ironic Flavor Migration <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+
<span class="token operator">|</span> Check: Cinder API              <span class="token operator">|</span>
<span class="token operator">|</span> Result: Success                <span class="token operator">|</span>
<span class="token operator">|</span> Details: None                  <span class="token operator">|</span>
+--------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业3：Nova模块检测结果截图</p>
</blockquote>
</li>
</ol>
<h2 id="Nova实例管理"><a href="#Nova实例管理" class="headerlink" title="Nova实例管理"></a>Nova实例管理</h2><h3 id="实例创建前提"><a href="#实例创建前提" class="headerlink" title="实例创建前提"></a>实例创建前提</h3><p>执行以下命令查看所需的前提条件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openstack flavor list       <span class="token comment"># 列出可用的实例类型</span>
openstack image list        <span class="token comment"># 列出可用的镜像</span>
openstack network list      <span class="token comment"># 列出可用的网络</span>
openstack keypair list      <span class="token comment"># 列出可用的密钥对</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后执行实例创建命令<code>openstack server create</code>，具体格式如下：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">openstack server create --flavor &lt;flavor> --image &lt;image> --key-name &lt;key_pair> --network &lt;network> [--security-group &lt;security_group>] [--user-data &lt;user_data>] &lt;instance_name>
命令中的参数说明如下：

--flavor &lt;flavor>：指定虚拟机实例的规格（flavor），例如 m1.small。
--image &lt;image>：指定虚拟机实例的镜像，可以是映像名称、ID或URL。
--key-name &lt;key_pair>：指定用于 SSH 访问虚拟机实例的密钥对的名称。
--network &lt;network>：指定虚拟机实例连接到的网络，可以是网络名称或ID。
--security-group &lt;security_group>（可选）：指定用于虚拟机实例的安全组，可以是安全组名称或ID。
--user-data &lt;user_data>（可选）：指定启动虚拟机实例时要传递给实例的自定义用户数据（通常是启动脚本）。
&lt;instance_name>：指定要创建的虚拟机实例的名称。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命令行实例管理常用命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 列出虚拟机实例</span>
openstack server list
<span class="token comment"># 查看实例的详细信息</span>
openstack server show <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 启动虚拟机实例</span>
openstack server start <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 停止虚拟机实例</span>
openstack server stop <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 重启虚拟机实例</span>
openstack server <span class="token function">reboot</span> <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 调整虚拟机实例的实例类型</span>
openstack server resize <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span> <span class="token parameter variable">--flavor</span> <span class="token operator">&lt;</span>new_flavor<span class="token operator">></span>
<span class="token comment"># 删除虚拟机实例</span>
openstack server delete <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span>
<span class="token comment"># 迁移虚拟机实例到其他计算节点</span>
openstack server migrate <span class="token operator">&lt;</span>instance_id_or_name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="虚拟机实例创建流程"><a href="#虚拟机实例创建流程" class="headerlink" title="虚拟机实例创建流程"></a>虚拟机实例创建流程</h3><ol>
<li><p>创建密钥对</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack keypair create test-key</span>
-----BEGIN RSA PRIVATE KEY-----
MIIEpgIBAAKCAQEA4ezhYShGObIS2GsCMyepBz+beVnJbs5ngIkNor2okw2pNcwW
kFVf4XUYgAPk8UgzJWVjlbFzPYfYzmrGO/4DthjpnV9udkahIIn+IsfPajvbWn/n
aOjrncva99YvqpsLOaasaO5fS0k+YLQaWeVzhLW43pndT+e3BRa120msvItqIuK5
Fs4eCtjtAYeYBOlN/AReymXf6m2Et3TIk8tATk4De0q3u7p2TIfGYdbh22HiOWI4
2J1Q9y2sC2Jj/idV9+407iLbMN/CfdVDu6Wm2Z0Ec3z5a3nGqHsRHJwK2eAS8eQD
2AUksTMCBGBQDdgFTXnvXha8pjGz981kAjlYhQIDAQABAoIBAQDU56Z9KLcFKAsa
Z71q97USX57kfPiWs2xWdNGky5ZQ/k63o9yfp9TzYqXz/beCqceJNkLijpdLJPnr
jDPD1V0p/dApvgUa8PRm9aPIowOT2VSdtGsfMmDYE4QGipHg9LtfWPKg8AJdsGhY
OWGb1d9G8PmGzPkClBqlcQFv5b4i7nlkgNlqKMAxTTpYuw8VQ1bcekae1AMX4LJh
hObxjF2jrAwzKnX7oZtWpkKMNohbPoe4FnvPIbmwEWl6P9ewBqCUukGEYIu8C3u0
42nkCEzdjjsD4PQ7sQRABeFM045RVUVbWjWo+JhvnIrJYmpi1vMaqiaKnD+DF2nb
DKvTLNABAoGBAPc/lscQCW95kHvhhxVB3kwwTeUUz5fvMX6kyGfZp0C1oFc1Zp40
tHSdroZW7t0USJNAdPQXeBGmd3feM/8VsR09VOuaJCTTl0vvIq41JtU7jY6lk4a7
dkeomB8Dn8yswccvZ22id7CAsd378VKf3KklZQJiTRNaQwxHTsBVUBjRAoGBAOns
Ey7dHAzmpiv+Ws7UvaBN5Yz4l/9gbMsrpXICnbOGmVAW+WrP4Qloip8SGQLY2Csy
oj47UcdVLPISe0ChgUtzZCMh+u58fY3mpKlkEMnEahX2HommCzCJhwTa9G/lm/Js
I2Fnf+siwVzpeR8ZWbXh7NzZBhq1a67oglMpfjF1AoGBAL2shprHbrWZ6IFgjiR8
l3CTTe6DfI3t7WZeO2+PxYMa0pqUWNjdTeJ4ZL6iSjRHrzVnqVDoADBqKBRI3lK9
7VWlC1SCt1+ZAuQ5270RAW1rdjkMRJSDk0V9zNVeDmUR0sZfU1UD4hYBZHILKSJd
iQYprceaac6C3BS7T2q1B/FBAoGBALY8I/Wua9vhFDPRxAy9z7zC8sIQKNna1Oay
6gEX6KOjiGzMeSKtMDOULeoevz1okX+Vwq+Ypu0TfiBYJY0ERSXyj2CPaF3Cvk1+
EWmley60xbC2PLQflzgI7BbsPOGvjv4dILMRXqZgPSOU/7cqmKkJiO3EZO0JyQpK
OL1w5c7BAoGBALZI9+hh82MuOLLl9cd7EhgiNPos+HI4TZJLAlypd55v9cOIkjr+
olyRV9KLnHZiV086FRihPWbGxXMVg167efPciztS7Qlc+likocWztyIVll++A71M
547dAnIA4iw30MFMzQxs917RbRv++dJkuyvBLULGzMFOjCb48CzvR9q+
-----END RSA PRIVATE KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>其他密钥管理命令</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 列出密钥</span>
openstack keypair list
<span class="token comment"># 查看密钥详细信息</span>
openstack keypair show <span class="token operator">&lt;</span>密钥对名称<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建实例类型</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack flavor create --public test_flavor --id auto --ram 256 --disk 0 --vcpus 1</span>
+----------------------------+--------------------------------------+
<span class="token operator">|</span> Field                      <span class="token operator">|</span> Value                                <span class="token operator">|</span>
+----------------------------+--------------------------------------+
<span class="token operator">|</span> OS-FLV-DISABLED:disabled   <span class="token operator">|</span> False                                <span class="token operator">|</span>
<span class="token operator">|</span> OS-FLV-EXT-DATA:ephemeral  <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> disk                       <span class="token operator">|</span> <span class="token number">0</span>                                    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                         <span class="token operator">|</span> 205ecf42-35b2-4f79-b928-c56c063cdbc2 <span class="token operator">|</span>
<span class="token operator">|</span> name                       <span class="token operator">|</span> test_flavor                          <span class="token operator">|</span>
<span class="token operator">|</span> os-flavor-access:is_public <span class="token operator">|</span> True                                 <span class="token operator">|</span>
<span class="token operator">|</span> properties                 <span class="token operator">|</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">ram</span>                        <span class="token operator">|</span> <span class="token number">256</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> rxtx_factor                <span class="token operator">|</span> <span class="token number">1.0</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> swap                       <span class="token operator">|</span>                                      <span class="token operator">|</span>
<span class="token operator">|</span> vcpus                      <span class="token operator">|</span> <span class="token number">1</span>                                    <span class="token operator">|</span>
+----------------------------+--------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>其他实例类型管理命令</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openstack flavor list
openstack flavor show <span class="token operator">&lt;</span>实例类型ID<span class="token operator">></span>
openstack flavor delete <span class="token operator">&lt;</span>实例类型ID<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建网络</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack network create --share --external --provider-network-type flat --provider-physical-network provider --project admin test_net</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack subnet create --network test_net --subnet-range 192.168.20.0/24 --gateway 192.168.20.2 --allocation-pool start=192.168.20.128,end=192.168.20.140 --dns-nameserver 114.114.114.114 test_subnet</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>创建实例</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack server create --flavor test_flavor --network test_net --key-name demo-pub --image cirros cirros-VM1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>计算节点</code>免密登录</p>
<ul>
<li>在<code>控制节点</code>使用实例管理命令获取实例的ip地址</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack server show cirror-VM1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>将之前的私钥复制并粘贴到<code>计算节点</code>的<code>/root/.ssh/demo-key.pem</code>，使用ssh命令免密登录</li>
</ul>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># chmod 600 ~/.ssh/demo-key.pem</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># ssh -i ~/.ssh/demo-key.pem cirros@192.168.20.130</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>作业4：计算节点免密登录实例截图</p>
</blockquote>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/06/private_clouds/5.OpenStack%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/10/06/private_clouds/5.OpenStack%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/" class="post-title-link" itemprop="url">OpenStack镜像管理与制作（二）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-10-06 11:00:09" itemprop="dateCreated datePublished" datetime="2023-10-06T11:00:09+08:00">2023-10-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-13 12:36:31" itemprop="dateModified" datetime="2023-10-13T12:36:31+08:00">2023-10-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="虚拟机镜像制作方法"><a href="#虚拟机镜像制作方法" class="headerlink" title="虚拟机镜像制作方法"></a>虚拟机镜像制作方法</h2><p>OpenStack平台所使用的镜像文件是一种虚拟机镜像，我们简称为镜像。而虚拟机镜像本质上是一个包含虚拟磁盘的单个文件，该虚拟磁盘上安装了可引导的操作系统。</p>
<p>上一节课已经介绍了通过下载官方预制的虚拟机镜像，这种途径获取到的镜像文件大都默认禁用SSH密码身份验证，同时包含<code>cloud-init</code>来支持SSH密钥对和用户数据的注入。通过密钥实现登录之后可以做进一步的定制，最后通过创建快照重新生成新的虚拟机镜像。</p>
<p>以上这种获取、修改、生成新的镜像的方法容易理解、实现过程简单，适用于需要进行轻度定制的场景。如果需要进行深度的定制或者需要定制特定平台的镜像文件时可以通过更多的途径制作镜像。</p>
<p>其他制作虚拟机镜像的方法：</p>
<ul>
<li>通过工具（Guestfish,guestmount）修改虚拟机镜像</li>
<li>通过工具（Diskimage-builder）创建虚拟机镜像</li>
<li>手动创建虚拟机镜像</li>
</ul>
<h2 id="获取实验资源"><a href="#获取实验资源" class="headerlink" title="获取实验资源"></a>获取实验资源</h2><blockquote>
<p>这一步从教师机获取实验所用的镜像。</p>
</blockquote>
<ol>
<li><p>学生机使用的是空白密码的账户，需要修改策略才能使用文件共享功能。</p>
<ul>
<li>按Windows + R键调出运行框，输入“gpedit.msc”命令以打开本地组策略编辑器，依次导航到：计算机配置 &gt; Windows 设置 &gt; 安全设置 &gt; 本地策略 &gt; 安全选项。</li>
</ul>
 <img src="https://vault.taojie.fun:28089/i/2023/10/09/2023-10-09-1696814955.png" alt="1696814955556.png" title="1696814955556.png" />

<ul>
<li>在右侧窗格中找到“账户：使用空密码的本地账户只允许进行控制台登录”，然后双击打开，将其设置为“已禁用”，再单击“应用”和“确定”。</li>
</ul>
 <img src="https://vault.taojie.fun:28089/i/2023/10/09/2023-10-09-1696815014.png" alt="1696815014064.png" title="1696815014064.png" />
</li>
<li><p>Windows + E打开文件资源管理器在搜索栏输入<code>\\192.168.3.47</code>打开后将文件<code>CentOS-7-x86_64-GenericCloud-2003.qcow2</code>拉取到Windows本地目录<code>D:\\镜像\</code>覆盖目录下的同名文件。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/10/11/2023-10-11-1696954122.png" alt="1696954122919.png" title="1696954122919.png" /></li>
</ol>
<h2 id="实验环境准备"><a href="#实验环境准备" class="headerlink" title="实验环境准备"></a>实验环境准备</h2><blockquote>
<p>设置<code>控制节点</code>快照版本<code>5.3.8</code></p>
</blockquote>
<ul>
<li><p>右键虚拟机<code>控制节点</code> -&gt; 设置 -&gt; 处理器，将<code>虚拟化引擎</code>里的勾全部取消，启动<code>控制节点</code>。</p>
  <img src="https://vault.taojie.fun:28089/i/2023/10/11/2023-10-11-1696954933.png" alt="1696954933617.png" title="1696954933617.png" />
</li>
<li><p>使用WinSCP工具将需要定制的镜像上传到<code>控制节点</code>，将文件从左侧的windows本地拖动到右侧的虚拟机内部。</p>
  <img src="https://vault.taojie.fun:28089/i/2023/10/11/2023-10-11-1696956085.png" alt="1696956085852.png" title="1696956085852.png" /></li>
</ul>
<h2 id="Guestfish使用"><a href="#Guestfish使用" class="headerlink" title="Guestfish使用"></a>Guestfish使用</h2><p>Guestfish是一个用于访问和修改虚拟机磁盘镜像的工具，它提供了一种交互式方式来浏览、修改虚拟机的文件系统。</p>
<h3 id="Guestfish安装配置"><a href="#Guestfish安装配置" class="headerlink" title="Guestfish安装配置"></a>Guestfish安装配置</h3><ul>
<li><p>Guestfish软件包安装</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install libguestfs-tools</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>执行命令安装<code>libvirt</code>服务。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install libvirt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>修改libvirt配置<code>vi /etc/libvirt/qemu.conf</code>。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/libvirt/qemu.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

  <img src="https://vault.taojie.fun:28089/i/2023/10/10/2023-10-10-1696912516.png" alt="1696912515114.png" title="1696912515114.png" />
</li>
<li><p>启动libvirt服务。</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl start libvirtd</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h3 id="镜像定制"><a href="#镜像定制" class="headerlink" title="镜像定制"></a>镜像定制</h3><blockquote>
<p>定制内容是设置centos镜像的root和centos账户的直接登录、开启bash后利用字符打印一个图案。</p>
</blockquote>
<ol>
<li><p>安装openssl，生成加密的字符串并<code>复制</code>用于设置root密码。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install openssl</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openssl passwd -1 123123</span>
<span class="token variable">$1</span><span class="token variable">$vNor7zoi</span><span class="token variable">$MrzvyJiIETqxfoO</span>.zxgIL0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>需要修改的虚拟机镜像文件名为<code>CentOS-7-x86_64-GenericCloud-2003.qcow2</code>，通过以下命令以root身份挂载为读写模式：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># guestfish --rw -a CentOS-7-x86_64-GenericCloud-2003.qcow2</span>

Welcome to Guestfish, the libguestfs filesystem interactive shell <span class="token keyword">for</span>
editing virtual machine filesystems.

Type: <span class="token string">'help'</span> <span class="token keyword">for</span> <span class="token builtin class-name">help</span> on commands
<span class="token string">'man'</span> to <span class="token builtin class-name">read</span> the manual
<span class="token string">'quit'</span> to quit the shell

<span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>此时进入Guestfish的会话，提示符为<code>&gt;&lt;fs&gt;</code></p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/10/11/2023-10-11-1696954607.png" alt="1696954607319.png" title="1696954607319.png" />
</li>
<li><p>首先在Guestfish提示符下使用<code>run</code>命令启动一个虚拟机才能执行其他操作，该虚拟机将用于执行所有文件操作。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span> run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>通过list-filesystems命令查看文件系统。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span> list-filesystems<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>作业1：上传显示的镜像分区信息。</p>
</blockquote>
</li>
<li><p>挂载包含根目录的分区并修改文件<code>/etc/shadow</code>用来给root账户设置密码。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span> <span class="token function">mount</span> /dev/sda1 /<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span> <span class="token function">vi</span> /etc/shadow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>在文件的第一行的第一、二个冒号中间插入之前复制的所生成的root密码。</p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/10/11/2023-10-11-1696956445.png" alt="1696956445209.png" title="1696956445209.png" />
</li>
<li><p>修改<code>/etc/cloud/cloud.cfg</code>文件。</p>
<p> 在第58行下添加<code>plain_text_passwd: &#39;000000&#39;</code>字段用来给centos用户设置初始密码<code>000000</code>。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/10/09/2023-10-09-1696817530.png" alt="1696817529748.png" title="1696817529748.png" />
</li>
<li><p>使用<code>vi</code>修改<code>/root/.bashrc</code>文件，设置bash自启动命令，添加以下命令到最后。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'....................................................................................................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'....................................................................................................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'....................................................................................................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'..........................:*@@@@@@#=...........:-=====--:...........................................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'........................:#@@@@@@@@@@@-.:+*#%%+-:.........:-+#*=......:+#%%#*:.......................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.......................:@@@@@@@@@@@@@@%-.......................:*%:+@@@@@@@@@@*.....................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.......................#@@@@@@@@@@@@@-..........  .................#@@@@@@@@@@@@=...................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'......................=@@@@@@@@@@@-...................................%@@@@@@@@@@...................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'......................=@@@@@@@@@%:.....................................%@@@@@@@@@:..................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'........................%@@@@@@#.......................................-@@@@@@@@@...................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'...............#@#.......*@@@@%.........................................-@@@@@@@+...................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'........+@@+..#@@%........:*@@-..........................................=@@@@%-........+*:.........'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'........*@@%..%@@#..........:*............................................%#=:.........+@@%.........'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'........-@@@..@@@=..........*.............................................-+......#@@=.=@@%.........'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.....=%%@@@@#*@@@..........*-..............................................#:.....#@@@%@@@%.........'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'....-@@@@@@@@@@@#.........=*...............................................++......=%@@@@@@@@@@=....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'....-@@@@@@@@@@@@-........%:...............................................=*.......:@@@@@@@@@@@#...'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.....@@@@@@@@@@@@........-*................................................:#........@@@@@@@@@@@@*..'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.....#@@@@@@@@@@#......:%@=.................................................@*......:@@@@@@@@@@@@+..'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'......@@@@@@@@@@*.....#@@@:.................................................@@#......#@@@@@@@@@@-...'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'......@@@@@@@@@@%-...:@@@@+.................................................@@@%:......+@@@@@@@@-...'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'......*@@@@@@@@@@@*=.:@@@@%:................................................@@@@@......+@@@@@@@%:...'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'......-@@@@@@@@@@@@@@@@@@@@%:..............................................+@@@@@%.....=@@@@@@@%....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.......%@@@@@@@@@@@@@@@@@@@@@*............................................=@@@@@@@@@@@@@@@@@@@@#....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.......:@@@@@@@@@@@@@@@@@@@@@@@=........................................:#@@@@@@@@@@@@@@@@@@@@@#....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'........+@@@@@@@@@@@@@@@@@@@@@@@@%-...................................:#@@@@@@@@@@@@@@@@@@@@@@@%....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'.........%@@@@@@@@@@@@@@@@@@@@@@@@@@+.............................:=#@@@@@@@@@@@@@@@@@@@@@@@@@@=....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'..........=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*-:..................-+%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=.....'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'............=@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@####%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*.......'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'................:-=+##%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@%*=:.........'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'....................................................................................................'</span>
<span class="token builtin class-name">echo</span> <span class="token string">'....................................................................................................'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>卸载挂载点、退出guestfish视图</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span> <span class="token function">umount</span> /
<span class="token operator">></span><span class="token operator">&lt;</span>fs<span class="token operator">></span> <span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="验证定制结果"><a href="#验证定制结果" class="headerlink" title="验证定制结果"></a>验证定制结果</h3><ol>
<li><p>通过WinSCP将修改好的<code>CentOS-7-x86_64-GenericCloud-2003.qcow2</code>传输回本地的Windows桌面。</p>
</li>
<li><p>关闭<code>控制节点</code>虚拟机、将<code>控制节点</code>设置为快照<code>项目12</code>、启动<code>控制节点</code>和<code>计算节点</code>，登录<code>192.168.10.20</code>控制台。</p>
</li>
<li><p>在镜像菜单上传上文修改好的镜像<code>CentOS-7-x86_64-GenericCloud-2003.qcow2</code>到OpenStack。</p>
</li>
<li><p>创建<code>网络</code>，<code>实例类型</code>，不会的参考前面的笔记。</p>
</li>
<li><p>创建Centos实例并使用root账户登录（密码是上文配置的123123）验证结果，应该会显示下图所示的屏保动画。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/10/13/2023-10-13-1697171723.png" alt="1697171722897.png" title="1697171722897.png" /></li>
</ol>
<blockquote>
<p>作业2:上传登录后的截图</p>
</blockquote>
<h2 id="Guestmount使用"><a href="#Guestmount使用" class="headerlink" title="Guestmount使用"></a>Guestmount使用</h2><p><code>Guestmount</code>是一个用于挂载虚拟机磁盘镜像的工具，它允许在宿主机上将虚拟机磁盘镜像挂载为宿主机文件系统的一部分，从而可以直接访问和修改虚拟机镜像中的文件。Guestmount可以在不启动虚拟机的情况下进行操作，提供了对镜像中文件的读写访问权限。通过Guestmount，可以像操作本地文件系统一样，使用标准的文件操作命令（例如cp、mv、rm 等）</p>
<ul>
<li><p>Guestmount用法示例</p>
<ol>
<li><p>假设需要修改的虚拟机镜像文件名为<code>centos63_desktop.img</code>，从该文件中挂载根分区到<code>/mnt</code>目录。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># guestmount -a centos63_desktop.qcow2 -m /dev/vg_centosbase/lv_root --rw /mnt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>当预先不知道具体的挂载点时可以通过选项<code>-i</code>自动决定所用的挂载点。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># guestmount -a centos63_desktop.qcow2 -i --rw /mnt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>修改完成后卸载挂载点。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># umount /mnt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
</li>
</ul>
<h2 id="Diskimage-builder使用"><a href="#Diskimage-builder使用" class="headerlink" title="Diskimage-builder使用"></a>Diskimage-builder使用</h2><p>Diskimage-builder（DIB）是一个用于创建定制化操作系统磁盘镜像的工具。它是一个开源项目，旨在帮助开发者和系统管理员构建适合特定用途的操作系统镜像，例如用于虚拟机、容器、云平台等环境。</p>
<ol>
<li><p>Diskimage-builder安装。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># dnf install diskimage-builder</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>创建一个通用的Ubuntu虚拟磁盘镜像。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># disk-image-create ubuntu vm</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>还可以通过设置命令行选项或者环境变量实现其他镜像的构造。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># disk-image-create -a armhf ubuntu vm</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>除此之外还可以通过YAML文件描述需要构造的镜像。</p>
 <pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 元素列表，表示构建镜像时要包含的元素</span>
<span class="token key atrule">elements</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> centos7<span class="token punctuation">-</span>minimal
<span class="token punctuation">-</span> install<span class="token punctuation">-</span>packages

<span class="token comment"># 镜像类型，指定生成的镜像格式</span>
<span class="token key atrule">image_types</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> qcow2
<span class="token punctuation">-</span> raw

<span class="token comment"># 操作系统发行版和版本</span>
<span class="token key atrule">release</span><span class="token punctuation">:</span> centos7

<span class="token comment"># 构建参数和配置</span>
<span class="token key atrule">properties</span><span class="token punctuation">:</span>
<span class="token comment"># 用户名和密码</span>
<span class="token key atrule">user</span><span class="token punctuation">:</span> myuser
<span class="token key atrule">password</span><span class="token punctuation">:</span> mypassword<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="手动定制虚拟磁盘镜像"><a href="#手动定制虚拟磁盘镜像" class="headerlink" title="手动定制虚拟磁盘镜像"></a>手动定制虚拟磁盘镜像</h2><p>除了可以通过上述的工具在已有的虚拟磁盘文件的基础上进行修改以外还可以手动定制虚拟磁盘镜像，这个过程需要通过ISO CD文件安装操作系统后通过图形控制台远程配置虚拟机完成定制。主要分为以下几步：</p>
<ol>
<li><p>通过<code>kvm+qemu</code>方案安装操作系统虚拟机。</p>
</li>
<li><p>通过<code>virt-viewer</code>连接虚拟机后实现进一步配置、定制。</p>
</li>
<li><p>上传定制好的系统镜像到OpenStack平台完成验证。</p>
</li>
</ol>
<h3 id="操作系统虚拟机安装"><a href="#操作系统虚拟机安装" class="headerlink" title="操作系统虚拟机安装"></a>操作系统虚拟机安装</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol>
<li><p>在安装系统之前需要获取系统安装包、VirtIO驱动，从samba服务器上拉取文件<code>cn_windows_server_2012_r2_with_update_x64_dvd_6052725.iso</code>和<code>virtio-win-0.1.185.iso</code>。</p>
</li>
<li><p>创建大小为20G的qcow2格式的虚拟磁盘文件。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>fedora@fedora ~<span class="token punctuation">]</span>$ qemu-img create <span class="token parameter variable">-f</span> qcow2 ws2012.qcow2 20G
Formatting <span class="token string">'ws2012.qcow2'</span>, <span class="token assign-left variable">fmt</span><span class="token operator">=</span>qcow2 <span class="token assign-left variable">cluster_size</span><span class="token operator">=</span><span class="token number">65536</span> <span class="token assign-left variable">extended_l2</span><span class="token operator">=</span>off <span class="token assign-left variable">compression_type</span><span class="token operator">=</span>zlib <span class="token assign-left variable">size</span><span class="token operator">=</span><span class="token number">21474836480</span> <span class="token assign-left variable">lazy_refcounts</span><span class="token operator">=</span>off <span class="token assign-left variable">refcount_bits</span><span class="token operator">=</span><span class="token number">16</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>安装虚拟化相关的软件包。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># virt-install 是一个命令行工具，用于在虚拟化环境中创建和安装虚拟机</span>
<span class="token comment"># virt-manager是一个虚拟机管理工具</span>
<span class="token comment"># virt_viewer是一个用于查看虚拟机图形界面的工具</span>
<span class="token punctuation">[</span>fedora@fedora ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> dnf <span class="token function">install</span> <span class="token parameter variable">-y</span> qemu-kvm libvirt virt-install virt-manager virt-viewer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="windows-server系统安装"><a href="#windows-server系统安装" class="headerlink" title="windows-server系统安装"></a>windows-server系统安装</h3><ol>
<li><p>执行virt-install命令启动Win-server操作系统。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">virt-install <span class="token parameter variable">--connect</span> qemu:///system <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> ws2012 <span class="token parameter variable">--ram</span> <span class="token number">2048</span> <span class="token parameter variable">--vcpus</span> <span class="token number">2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--network</span> <span class="token assign-left variable">network</span><span class="token operator">=</span>default,model<span class="token operator">=</span>virtio <span class="token punctuation">\</span>
<span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>ws2012.qcow2,format<span class="token operator">=</span>qcow2,device<span class="token operator">=</span>disk,bus<span class="token operator">=</span>virtio <span class="token punctuation">\</span>
<span class="token parameter variable">--cdrom</span> cn_windows_server_2012_r2_with_update_x64_dvd_6052725.iso <span class="token punctuation">\</span>
<span class="token parameter variable">--disk</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>virtio-win.iso,device<span class="token operator">=</span>cdrom <span class="token punctuation">\</span>
<span class="token parameter variable">--vnc</span> --os-type windows --os-variant win2k12 <span class="token punctuation">\</span>
<span class="token parameter variable">--boot</span> cdrom,menu<span class="token operator">=</span>on<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>在图形终端中执行<code>virt-manager</code>打开虚拟机控制同。通过控制台登录启动的windows server虚拟机完成安装。</p>
<blockquote>
<p>系统密钥：NB4WH-BBBYV-3MPPC-9RCMV-46XCB</p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696731826.png" alt="1696731825728.png" title="1696731825728.png" />

<blockquote>
<p>安装系统时选择第二个带GUI桌面的标准版，安装方式选择第二个。</p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/10/09/2023-10-09-1696826963.png" alt="1696826962933.png" title="1696826962933.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/10/09/2023-10-09-1696827045.png" alt="1696827044800.png" title="1696827044800.png" />
</li>
<li><p>选择<code>加载驱动程序</code>-&gt;<code>浏览</code>从以下路径加载scsi和网络驱动。</p>
<blockquote>
<p>E:\virtio-win-0.1XX\viostor\2k12\amd64<br> E:\NETKVM\2k12\amd64</p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696737650.png" alt="1696737648562.png" title="1696737648562.png" />
</li>
<li><p>选择<code>驱动器0</code>、点下一步安装系统。</p>
</li>
<li><p>系统安装完成后在虚拟机管理器中点击查看 -&gt; 详情 -&gt; 引导选项，选中VirtIO磁盘。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/10/09/2023-10-09-1696821264.png" alt="1696821263632.png" title="1696821263632.png" />
</li>
<li><p>重启虚拟机，在以下启动界面按ESC后选择第二个分区启动系统。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696738960.png" alt="1696738959698.png" title="1696738959698.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696738975.png" alt="1696738974281.png" title="1696738974281.png" />
</li>
<li><p>进入系统后按下图配置允许远程登录、配置防火墙规则。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696739234.png" alt="1696739233738.png" title="1696739233738.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696739246.png" alt="1696739245196.png" title="1696739245196.png" />
</li>
<li><p>启动命令行执行以下命令安装VirtIO驱动。</p>
 <pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">CD \
C:\pnputil <span class="token operator">-</span>i <span class="token operator">-</span>a D:\viostor\2k12r2\amd64\<span class="token operator">*</span><span class="token punctuation">.</span>INF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>设置PowerShell的执行策略为不受限制。</p>
 <pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">C:\powershell
C:\<span class="token function">Set-ExecutionPolicy</span> Unrestricted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>下载Cloudbase-Init并安装。</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">C:\<span class="token function">Invoke-WebRequest</span> <span class="token operator">-</span>UseBasicParsing https:<span class="token operator">/</span><span class="token operator">/</span>cloudbase<span class="token punctuation">.</span>it/downloads/CloudbaseInitSetup_Stable_ x64<span class="token punctuation">.</span>msi <span class="token operator">-</span>OutFile cloudbaseinit<span class="token punctuation">.</span>msi
C:\<span class="token punctuation">.</span>\cloudbaseinit<span class="token punctuation">.</span>msi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>启动安装向导后设置初始化选项、完成安装。</p>
<img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696739848.png" alt="1696739847088.png" title="1696739847088.png" />

<img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696739861.png" alt="1696739859425.png" title="1696739859425.png" />

<img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696739904.png" alt="1696739903072.png" title="1696739903072.png" />

<img src="https://vault.taojie.fun:28089/i/2023/10/08/2023-10-08-1696739923.png" alt="1696739922332.png" title="1696739922332.png" /></li>
</ol>
<h3 id="验证定制结果-1"><a href="#验证定制结果-1" class="headerlink" title="验证定制结果"></a>验证定制结果</h3><p>将生成的<code>ws2012.qcow2</code>传到<code>控制节点</code>上、上传到OpenStack后启动实例。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> ws2012.qcow2 root@192.168.10.10:/root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>作业三：windows实例启动后截图上传。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/20/private_clouds/4.OpenStack%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/20/private_clouds/4.OpenStack%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">OpenStack镜像管理与制作（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-20 20:00:51" itemprop="dateCreated datePublished" datetime="2023-09-20T20:00:51+08:00">2023-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-06 15:52:23" itemprop="dateModified" datetime="2023-10-06T15:52:23+08:00">2023-10-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Glance服务介绍"><a href="#Glance服务介绍" class="headerlink" title="Glance服务介绍"></a>Glance服务介绍</h2><p>Glance服务是OpenStack平台的镜像服务，它提供了管理虚拟机镜像的功能。</p>
<p>在OpenStack Glance组件中，镜像（Image）是指虚拟机的模板，包含了预先配置的操作系统和应用程序。镜像是创建和部署虚拟机实例的基础。</p>
<ul>
<li><p>Glance主要特点和功能：</p>
<ol>
<li><p>镜像存储和管理：Glance提供了一个可靠的存储系统，用于持久化保存虚拟机镜像。它支持多种后端存储选项，如本地文件系统、分布式文件系统和对象存储。用户可以通过Glance API上传、删除、更新和查询镜像。</p>
</li>
<li><p>镜像加速和缓存：Glance支持镜像的加速和缓存，以提高虚拟机实例的启动速度和性能。通过将常用的镜像缓存在计算节点上，可以减少下载和传输时间。</p>
</li>
<li><p>镜像格式支持：Glance支持多种虚拟机镜像格式，包括常见的格式如QCOW2、VHD、VMDK和RAW等。这使得用户可以使用不同的镜像格式来满足其特定的需求。</p>
</li>
<li><p>元数据管理：Glance允许用户为每个镜像添加自定义元数据，包括镜像名称、描述、操作系统类型、版本等信息。这些元数据可以帮助用户更好地组织和搜索镜像库。</p>
</li>
<li><p>镜像共享：Glance支持镜像的共享功能，允许用户将自己的镜像分享给其他项目或用户。这样可以避免重复创建相同的镜像，提高资源的共享和重用。</p>
</li>
</ol>
</li>
</ul>
<img src="https://vault.taojie.fun:28089/i/2023/09/20/2023-09-20-1695216464.png" alt="1695216462264.png" title="1695216462264.png" />

<h3 id="Glance架构"><a href="#Glance架构" class="headerlink" title="Glance架构"></a>Glance架构</h3><img src="https://vault.taojie.fun:28089/i/2023/09/20/2023-09-20-1695214714.png" alt="1695214713001.png" title="1695214713001.png" />

<ul>
<li><p>Glance API：用户与 Glance 服务交互的接口，通过 RESTful API 提供了镜像管理的各种功能。用户可以通过 API 执行镜像的上传、下载、删除等操作。</p>
</li>
<li><p>Glance Registry：用于存储和管理镜像的元数据，如名称、格式、大小等。</p>
</li>
<li><p>Glance Store：Glance 的后端存储组件，负责实际的镜像文件的存储。它可以支持多种后端存储类型，如本地文件系统、Swift、Ceph、S3 等。根据配置，镜像可以存储在不同的后端存储中。</p>
</li>
<li><p>Database：数据库用于存储 Glance 服务的持久化数据，包括镜像的元数据、权限信息等。</p>
</li>
</ul>
<h2 id="Glance服务安装"><a href="#Glance服务安装" class="headerlink" title="Glance服务安装"></a>Glance服务安装</h2><h3 id="作业与实验环境"><a href="#作业与实验环境" class="headerlink" title="作业与实验环境"></a>作业与实验环境</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://wxstc.fanya.chaoxing.com/portal">超星网址</a><br><code>快照管理</code>：控制节点选择<code>快照项目6</code>，计算节点不需要设置</p>
</blockquote>
<h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><ol>
<li><p>执行命令安装Glance软件包：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install openstack-glance</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 安装结束后能够通过以下命令查看系统中的同名用户和用户组表示Glance组件安装完成：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd |grep glance       # 1. 查看glance用户</span>
glance:x:161:161:OpenStack Glance Daemons:/var/lib/glance:/sbin/nologin
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/group |grep glance        # 2. 查看glance用户组</span>
glance:x:161:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建数据库并授权：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 进入数据库</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p000000</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">64</span>
Server version: <span class="token number">10.3</span>.20-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

<span class="token comment"># 2. 创建glance数据库</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> CREATE DATABASE glance<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 3. 为glance数据库授予本地登录用户的权限</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON glance.* TO <span class="token string">'glance'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>

<span class="token comment"># 4. 为glance数据库授予远程登录用户的权限</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> GRANT ALL PRIVILEGES ON glance.* TO <span class="token string">'glance'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
<span class="token comment"># 5. 退出</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改配置文件：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 备份配置文件</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/glance/glance-api.conf /etc/glance/glance-api.bak</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 删除配置文件中的空行和注释行</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># grep -Ev '^$|#' /etc/glance/glance-api.bak > /etc/glance/glance-api.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 打开配置文件依次编辑以下字段：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 数据库地址</span>
<span class="token punctuation">[</span>database<span class="token punctuation">]</span>
connection <span class="token operator">=</span> mysql+pymysql://glance:000000@controller/glance<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 身份凭证配置</span>
<span class="token punctuation">[</span>keystone_authtoken<span class="token punctuation">]</span>
auth_url <span class="token operator">=</span> http://controller:5000
memcached_servers <span class="token operator">=</span> controller:11211
auth_type <span class="token operator">=</span> password
username <span class="token operator">=</span> glance
password <span class="token operator">=</span> 000000
project_name <span class="token operator">=</span> project
user_domain_name <span class="token operator">=</span> Default
project_domain_name <span class="token operator">=</span> Default<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 身份凭证配置</span>
<span class="token punctuation">[</span>paste_deploy<span class="token punctuation">]</span>
flavor <span class="token operator">=</span> keystone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 后端存储配置</span>
<span class="token punctuation">[</span>glance_store<span class="token punctuation">]</span>
stores <span class="token operator">=</span> <span class="token function">file</span>
default_store <span class="token operator">=</span> <span class="token function">file</span>
filesystem_store_datadir <span class="token operator">=</span> /var/lib/glance/images/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>初始化Glance数据库</p>
<ul>
<li><p>数据库同步</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su glance -s /bin/sh -c "glance-manage db_sync"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>查看同步后的数据表</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p000000      # 1. 数据库登录</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">270</span>
Server version: <span class="token number">10.3</span>.20-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> use glance<span class="token punctuation">;</span>                   <span class="token comment"># 2. 进入glance数据库</span>
Reading table information <span class="token keyword">for</span> completion of table and <span class="token function">column</span> names
You can turn off this feature to get a quicker startup with <span class="token parameter variable">-A</span>

Database changed
MariaDB <span class="token punctuation">[</span>glance<span class="token punctuation">]</span><span class="token operator">></span> show tables<span class="token punctuation">;</span>                  <span class="token comment"># 3. 显示数据表</span>
+----------------------------------+
<span class="token operator">|</span> Tables_in_glance                 <span class="token operator">|</span>
+----------------------------------+
<span class="token operator">|</span> alembic_version                  <span class="token operator">|</span>
<span class="token operator">|</span> image_locations                  <span class="token operator">|</span>
<span class="token operator">|</span> image_members                    <span class="token operator">|</span>
<span class="token operator">|</span> image_properties                 <span class="token operator">|</span>
<span class="token operator">|</span> image_tags                       <span class="token operator">|</span>
<span class="token operator">|</span> images                           <span class="token operator">|</span>
<span class="token operator">|</span> metadef_namespace_resource_types <span class="token operator">|</span>
<span class="token operator">|</span> metadef_namespaces               <span class="token operator">|</span>
<span class="token operator">|</span> metadef_objects                  <span class="token operator">|</span>
<span class="token operator">|</span> metadef_properties               <span class="token operator">|</span>
<span class="token operator">|</span> metadef_resource_types           <span class="token operator">|</span>
<span class="token operator">|</span> metadef_tags                     <span class="token operator">|</span>
<span class="token operator">|</span> migrate_version                  <span class="token operator">|</span>
<span class="token operator">|</span> task_info                        <span class="token operator">|</span>
<span class="token operator">|</span> tasks                            <span class="token operator">|</span>
+----------------------------------+
<span class="token number">15</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
MariaDB <span class="token punctuation">[</span>glance<span class="token punctuation">]</span><span class="token operator">></span> quit                          <span class="token comment"># 4. 退出</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<blockquote>
<p>作业1：显示数据表后后截图上传</p>
</blockquote>
</li>
</ol>
<h3 id="Glance初始化"><a href="#Glance初始化" class="headerlink" title="Glance初始化"></a>Glance初始化</h3><ol>
<li><p>创建Glance用户、分配角色</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 利用环境变量登录</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source admin-login</span>
<span class="token comment"># 2. 创建用户</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack user create --domain default --password 000000 glance</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> Field               <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------------------+----------------------------------+
<span class="token operator">|</span> domain_id           <span class="token operator">|</span> default                          <span class="token operator">|</span>
<span class="token operator">|</span> enabled             <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>                  <span class="token operator">|</span> 504c914efe01478a9da5968a88dad987 <span class="token operator">|</span>

<span class="token operator">|</span> options             <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> password_expires_at <span class="token operator">|</span> None                             <span class="token operator">|</span>
+---------------------+----------------------------------+
<span class="token comment"># 3. 添加角色</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack role add --project project --user glance admin</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建服务和端点</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 创建服务</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack service create --name glance image</span>
+---------+----------------------------------+
<span class="token operator">|</span> Field   <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+---------+----------------------------------+
<span class="token operator">|</span> enabled <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>      <span class="token operator">|</span> da84735108944b6690cbcf9fab56f5fd <span class="token operator">|</span>
<span class="token operator">|</span> name    <span class="token operator">|</span> glance                           <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token builtin class-name">type</span>    <span class="token operator">|</span> image                            <span class="token operator">|</span>
+---------+----------------------------------+
<span class="token comment"># 2. 创建公共用户使用的端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne glance public http://controller:9292</span>
+--------------+----------------------------------+
<span class="token operator">|</span> Field        <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token operator">|</span> enabled      <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>           <span class="token operator">|</span> a344eb651ebc41f7ae2b1b74b3e8fda3 <span class="token operator">|</span>
<span class="token operator">|</span> interface    <span class="token operator">|</span> public                           <span class="token operator">|</span>
<span class="token operator">|</span> region       <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> region_id    <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> service_id   <span class="token operator">|</span> da84735108944b6690cbcf9fab56f5fd <span class="token operator">|</span>
<span class="token operator">|</span> service_name <span class="token operator">|</span> glance                           <span class="token operator">|</span>
<span class="token operator">|</span> service_type <span class="token operator">|</span> image                            <span class="token operator">|</span>
<span class="token operator">|</span> url          <span class="token operator">|</span> http://controller:9292           <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token comment"># 3. 创建内部组件用户使用的端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne glance internal http://controller:9292</span>
+--------------+----------------------------------+
<span class="token operator">|</span> Field        <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token operator">|</span> enabled      <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>           <span class="token operator">|</span> f1b7a33ab36047209e0130debf4dc500 <span class="token operator">|</span>
<span class="token operator">|</span> interface    <span class="token operator">|</span> internal                         <span class="token operator">|</span>
<span class="token operator">|</span> region       <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> region_id    <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> service_id   <span class="token operator">|</span> da84735108944b6690cbcf9fab56f5fd <span class="token operator">|</span>
<span class="token operator">|</span> service_name <span class="token operator">|</span> glance                           <span class="token operator">|</span>
<span class="token operator">|</span> service_type <span class="token operator">|</span> image                            <span class="token operator">|</span>
<span class="token operator">|</span> url          <span class="token operator">|</span> http://controller:9292           <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token comment"># 4. 创建admin用户使用的端点</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack endpoint create --region RegionOne glance admin http://controller:9292</span>
+--------------+----------------------------------+
<span class="token operator">|</span> Field        <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+--------------+----------------------------------+
<span class="token operator">|</span> enabled      <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>           <span class="token operator">|</span> c176c6ff1caa4eba9083105bd2b41261 <span class="token operator">|</span>
<span class="token operator">|</span> interface    <span class="token operator">|</span> admin                            <span class="token operator">|</span>
<span class="token operator">|</span> region       <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> region_id    <span class="token operator">|</span> RegionOne                        <span class="token operator">|</span>
<span class="token operator">|</span> service_id   <span class="token operator">|</span> da84735108944b6690cbcf9fab56f5fd <span class="token operator">|</span>
<span class="token operator">|</span> service_name <span class="token operator">|</span> glance                           <span class="token operator">|</span>
<span class="token operator">|</span> service_type <span class="token operator">|</span> image                            <span class="token operator">|</span>
<span class="token operator">|</span> url          <span class="token operator">|</span> http://controller:9292           <span class="token operator">|</span>
+--------------+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>启动Glance服务并验证</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 设置开机自启</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable openstack-glance-api</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/openstack-glance-api.service to /usr/lib/systemd/system/openstack-glance-api.service.
<span class="token comment"># 2. 启动服务</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl start openstack-glance-api</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment"># 3. 查看服务状态</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl status openstack-glance-api</span>
● openstack-glance-api.service - OpenStack Image Service <span class="token punctuation">(</span>code-named Glance<span class="token punctuation">)</span> API server
Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/openstack-glance-api.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Wed <span class="token number">2023</span>-09-20 <span class="token number">11</span>:18:59 EDT<span class="token punctuation">;</span> 13s ago
Main PID: <span class="token number">5068</span> <span class="token punctuation">(</span>glance-api<span class="token punctuation">)</span>
CGroup: /system.slice/openstack-glance-api.service
        ├─5068 /usr/bin/python2 /usr/bin/glance-api
        ├─5080 /usr/bin/python2 /usr/bin/glance-api
        └─5081 /usr/bin/python2 /usr/bin/glance-api

Sep <span class="token number">20</span> <span class="token number">11</span>:18:59 controller systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started OpenStack Image Service <span class="token punctuation">(</span>code-named Glance<span class="token punctuation">)</span> API server.
Sep <span class="token number">20</span> <span class="token number">11</span>:18:59 controller glance-api<span class="token punctuation">[</span><span class="token number">5068</span><span class="token punctuation">]</span>: /usr/lib/python2.7/site-packages/paste/deploy/loadwsgi.py:22: PkgRe<span class="token punctuation">..</span>.tely.
Sep <span class="token number">20</span> <span class="token number">11</span>:18:59 controller glance-api<span class="token punctuation">[</span><span class="token number">5068</span><span class="token punctuation">]</span>: <span class="token builtin class-name">return</span> pkg_resources.EntryPoint.parse<span class="token punctuation">(</span><span class="token string">"x="</span> + s<span class="token punctuation">)</span>.load<span class="token punctuation">(</span>False<span class="token punctuation">)</span>
Hint: Some lines were ellipsized, use <span class="token parameter variable">-l</span> to show <span class="token keyword">in</span> full.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建镜像</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 获取镜像文件到本地</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># curl -O http://download.cirros-cloud.net/0.5.1/cirros-0.5.1-x86_64-disk.img</span>
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                Dload  Upload   Total   Spent    Left  Speed
<span class="token number">100</span>   <span class="token number">273</span>  <span class="token number">100</span>   <span class="token number">273</span>    <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">40</span>      <span class="token number">0</span>  <span class="token number">0</span>:00:06  <span class="token number">0</span>:00:06 --:--:--    <span class="token number">65</span>
<span class="token comment"># 2. 创建镜像</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack image create --file cirros-0.5.1-x86_64-disk.img --disk-format raw --container-format bare --public cirros</span>
<span class="token comment"># 3. 查看镜像列表</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack image list</span>
+--------------------------------------+--------+--------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name   <span class="token operator">|</span> Status <span class="token operator">|</span>
+--------------------------------------+--------+--------+G
<span class="token operator">|</span> cfd3a7d5-3339-4d11-8c18-18c6d703c03b <span class="token operator">|</span> cirros <span class="token operator">|</span> active <span class="token operator">|</span>
+--------------------------------------+--------+--------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业2：显示镜像列表后截图上传</p>
</blockquote>
</li>
</ol>
<h2 id="基于预制镜像定制OpenStack镜像"><a href="#基于预制镜像定制OpenStack镜像" class="headerlink" title="基于预制镜像定制OpenStack镜像"></a>基于预制镜像定制OpenStack镜像</h2><h3 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h3><blockquote>
<p>控制节点和计算节点都是<code>快照项目12</code></p>
</blockquote>
<h3 id="Centos镜像创建"><a href="#Centos镜像创建" class="headerlink" title="Centos镜像创建"></a>Centos镜像创建</h3><ol>
<li><p>设置虚拟机和宿主机共享</p>
<ul>
<li><p>控制节点关机状态右键-&gt;设置，选择选项-&gt;共享文件夹-&gt;总是启用并添加本地D盘内的镜像文件所在目录</p>
  <img src="https://vault.taojie.fun:28089/i/2023/09/21/2023-09-21-1695229069.png" alt="1695229067851.png" title="1695229067851.png" />
</li>
<li><p>安装vm-tools并挂载设备</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install open-vm-tools</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># vmhgfs-fuse .host:/ /mnt/hgfs -o subtype=vmhgfs-fuse,allow_other</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># file /mnt/hgfs/镜像/CentOS-7-x86_64-GenericCloud-2003.qcow2</span>
/mnt/hgfs/镜像/CentOS-7-x86_64-GenericCloud-2003.qcow2: QEMU QCOW Image <span class="token punctuation">(</span>v3<span class="token punctuation">)</span>, <span class="token number">8589934592</span> bytes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>创建镜像</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack image create --disk-format qcow2 --container-format bare   --public --file /mnt/hgfs/镜像/CentOS-7-x86_64-GenericCloud-2003.qcow2 centos7</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="创建虚拟机实例"><a href="#创建虚拟机实例" class="headerlink" title="创建虚拟机实例"></a>创建虚拟机实例</h3><ol>
<li><p>通过浏览器<code>192.168.10.20</code>访问Horizon服务的界面，设置域名<code>Default</code>、用户名<code>admin</code>、密码<code>000000</code>登录。</p>
</li>
<li><p>创建实例类型、网络。</p>
<blockquote>
<p>创建<code>实例类型</code>和<code>网络</code>时设置项目为admin，否则没有权限。可参考<a target="_blank" rel="noopener" href="https://abc.taojie.fun/2023/09/08/private_clouds/2.openstack%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%9E%E4%BE%8B">创建虚拟机实例</a>创建网络。</p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/09/21/2023-09-21-1695230412.png" alt="1695230410573.png" title="1695230410573.png" />
</li>
<li><p>设置<code>配置</code>菜单后完成实例创建：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token function">passwd</span> centos<span class="token operator">&lt;&lt;</span><span class="token string">EOF
000000
000000
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这里配置的脚本用来在实例启动时设置centos账户的密码，否则不能登录控制台</p>
</blockquote>
 <img src="https://vault.taojie.fun:28089/i/2023/09/21/2023-09-21-1695233149.png" alt="1695233147185.png" title="1695233147185.png" /></li>
</ol>
<h3 id="定制镜像"><a href="#定制镜像" class="headerlink" title="定制镜像"></a>定制镜像</h3><ol>
<li><p>在实例控制台中完成配置：</p>
<blockquote>
<p>使用账号：centos；密码：000000登录控制台</p>
</blockquote>
<ol>
<li><p><code>sudo su</code>命令切换root用户</p>
</li>
<li><p><code>passwd root</code>命令设置密码000000</p>
</li>
<li><p>编辑文件<code>/etc/cloud/cloud.cfg</code>修改第四行为<code>disable_root:0</code></p>
</li>
<li><p>重启实例使用root用户登录。</p>
</li>
</ol>
</li>
<li><p>创建快照后基于新的快照创建实例，验证root用户直接登录控制台</p>
 <img src="https://vault.taojie.fun:28089/i/2023/09/21/2023-09-21-1695235685.png" alt="1695235684061.png" title="1695235684061.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/09/21/2023-09-21-1695235198.png" alt="1695235196457.png" title="1695235196457.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/09/21/2023-09-21-1695235388.png" alt="1695235386127.png" title="1695235386127.png" />

<blockquote>
<p>作业3：登录控制台后截图上传</p>
</blockquote>
</li>
<li><p>实例快照转换成镜像</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 查看镜像列表获取ID</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack image list</span>
+--------------------------------------+-------------+--------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name        <span class="token operator">|</span> Status <span class="token operator">|</span>
+--------------------------------------+-------------+--------+
<span class="token operator">|</span> 87b290e8-57c9-4c27-bb77-9d312c6d96c2 <span class="token operator">|</span> centos7     <span class="token operator">|</span> active <span class="token operator">|</span>
<span class="token operator">|</span> 26b59df3-4fbe-4368-abd9-a5e5b58efe50 <span class="token operator">|</span> centos_test <span class="token operator">|</span> active <span class="token operator">|</span>
<span class="token operator">|</span> 3a211d53-30e2-4d42-a7cf-ee55786b176a <span class="token operator">|</span> cirros      <span class="token operator">|</span> active <span class="token operator">|</span>
+--------------------------------------+-------------+--------+
<span class="token comment"># 2. 将本地快照文件转换成镜像</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack image create centos_test_image --file /var/lib/glance/images/26b59df3-4fbe-4368-abd9-a5e5b58efe50  --disk-format qcow2 --container-format bare</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/15/private_clouds/3.OpenStack%E8%BA%AB%E4%BB%BD%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/15/private_clouds/3.OpenStack%E8%BA%AB%E4%BB%BD%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">OpenStack身份管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-15 11:52:33" itemprop="dateCreated datePublished" datetime="2023-09-15T11:52:33+08:00">2023-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-20 22:25:51" itemprop="dateModified" datetime="2023-09-20T22:25:51+08:00">2023-09-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="理解Keystone身份服务"><a href="#理解Keystone身份服务" class="headerlink" title="理解Keystone身份服务"></a>理解Keystone身份服务</h2><h3 id="Keystone简介"><a href="#Keystone简介" class="headerlink" title="Keystone简介"></a>Keystone简介</h3><p>Keystone 是OpenStack项目中的一个重要组件，是OpenStack Identity服务。主要提供身份认证（Authentication）、授权（Authorization）、用户管理。</p>
<ul>
<li><p>身份认证（Authentication）： Keystone负责验证用户的身份。它支持多种认证方法，包括用户名&#x2F;密码、令牌（Token）、证书等。用户可以使用这些认证方法之一进行身份验证，以访问OpenStack中的资源。</p>
</li>
<li><p>授权（Authorization）： 一旦用户通过身份认证，Keystone会根据用户的身份和权限规则控制用户可以访问的资源和操作。这种授权是基于角色的，用户被分配到特定角色，而角色具有特定的权限。</p>
</li>
<li><p>用户和角色管理： Keystone允许管理员创建、管理用户、角色和项目（Project），并分配特定权限给用户或角色。</p>
</li>
</ul>
<h3 id="Keystone相关名词解释"><a href="#Keystone相关名词解释" class="headerlink" title="Keystone相关名词解释"></a>Keystone相关名词解释</h3><ol>
<li><p>User（用户）： 在 Keystone 中，用户是系统中的实体，代表可以访问 OpenStack 服务的个体。用户通过身份认证来验证其身份。</p>
</li>
<li><p>Role（角色）： 角色是一组权限的集合，可以分配给用户或项目。角色决定了用户或项目可以执行的操作。</p>
</li>
<li><p>Project（项目）： 项目是 OpenStack 中的逻辑隔离单元，用于组织资源和权限。可以将用户分配到项目中，并管理项目的资源。</p>
</li>
<li><p>Domain（域）： 域是一组相关的用户、角色和项目的集合。域可以用于组织和隔离 OpenStack 环境中的用户和项目。</p>
</li>
<li><p>Endpoint（终端）： 终端是服务的访问地址，包括 URL 和访问协议。每个服务可以有多个终端，用于访问不同的服务节点。</p>
</li>
<li><p>Service（服务）： 服务代表 OpenStack 中的一个功能单元，如计算服务（Nova）、网络服务（Neutron）、镜像服务（Glance）等。每个服务有一个唯一的标识符。</p>
</li>
<li><p>Token（令牌）： 令牌是用于身份认证和授权的临时凭证。用户经过身份认证后，会获得一个令牌，该令牌允许他们在一定时间内访问特定资源。</p>
</li>
</ol>
<h3 id="Keystone的层次结构"><a href="#Keystone的层次结构" class="headerlink" title="Keystone的层次结构"></a>Keystone的层次结构</h3><img src="https://vault.taojie.fun:28089/i/2023/09/15/2023-09-15-1694788656.png" alt="4324542b834a4aecb25d739fac41150e (1).png" title="4324542b834a4aecb25d739fac41150e (1).png" />

<h3 id="Keystone的认证流程"><a href="#Keystone的认证流程" class="headerlink" title="Keystone的认证流程"></a>Keystone的认证流程</h3><img src="https://vault.taojie.fun:28089/i/2023/09/15/2023-09-15-1694789109.png" alt="1694789108795.png" title="1694789108795.png" />

<h2 id="Keystone服务安装"><a href="#Keystone服务安装" class="headerlink" title="Keystone服务安装"></a>Keystone服务安装</h2><h3 id="作业与实验环境"><a href="#作业与实验环境" class="headerlink" title="作业与实验环境"></a>作业与实验环境</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://wxstc.fanya.chaoxing.com/portal">超星网址</a><br><code>快照管理</code>：控制节点选择<code>快照5.3.13</code>，计算节点选择<code>快照5.3.9</code></p>
</blockquote>
<h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><ol>
<li><p>Keystone是运行在Web服务器上的Web应用，需要安装以下软件包：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install openstack-keystone httpd mod_wsgi</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>在安装Keystone的过程中系统会自动创建名为<code>keystone</code>的用户和用户组，通过以下命令查看：</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/passwd |grep keystone     # 查看用户名</span>
keystone:x:163:163:OpenStack Keystone Daemons:/var/lib/keystone:/sbin/nologin
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/group |grep keystone      # 查看用户组</span>
keystone:x:163:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>OpenStack Keystone作为OpenStack项目的身份认证和授权服务，需要存储大量的用户、角色、项目、域等身份信息以及相应的权限信息，因此需要为Keystone创建数据库。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p000000      # 用root用户登录数据库</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">8</span>
Server version: <span class="token number">10.3</span>.20-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> CREATE DATABASE keystone<span class="token punctuation">;</span>     <span class="token comment"># 创建名为keystone的数据库</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

 <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">// 把数据库的所有表的权限授予本地登录的keystone用户，密码为000000</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> keystone<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'keystone'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>

<span class="token comment">// 把数据库的所有表的权限授予远程登录的keystone用户，密码为000000</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> keystone<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'keystone'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'000000'</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

<span class="token comment">// 退出数据库</span>
MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改Keystone配置文件关联数据库</p>
<p> 打开<code>/etc/keystone/keystone.conf</code>后查找<code>[database]</code>字段 (600行)并修改连接主机<code>controller</code>的数据库<code>keystone</code>：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">connection = mysql+pymysql://keystone:000000@controller/keystone<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>配置令牌加密方式：查找[token]（2475行）并删除<code>provider = fernet</code>前的<code>#</code>注释符</li>
</ul>
</li>
<li><p>初始化Keystone数据库</p>
<ul>
<li><p>同步数据库</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 通过keystone用户执行数据库初始化命令</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># su keystone -s /bin/sh -c "keystone-manage db_sync"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>查看数据库是否同步，打印出数据表</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p000000</span>
Welcome to the MariaDB monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MariaDB connection <span class="token function">id</span> is <span class="token number">10</span>
Server version: <span class="token number">10.3</span>.20-MariaDB MariaDB Server

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2018</span>, Oracle, MariaDB Corporation Ab and others.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

MariaDB <span class="token punctuation">[</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">></span> use keystone<span class="token punctuation">;</span>
Reading table information <span class="token keyword">for</span> completion of table and <span class="token function">column</span> names
You can turn off this feature to get a quicker startup with <span class="token parameter variable">-A</span>

Database changed
MariaDB <span class="token punctuation">[</span>keystone<span class="token punctuation">]</span><span class="token operator">></span> show tables<span class="token punctuation">;</span>        <span class="token comment"># 打印出数据表</span>
+------------------------------------+
<span class="token operator">|</span> Tables_in_keystone                 <span class="token operator">|</span>
+------------------------------------+
<span class="token operator">|</span> access_rule                        <span class="token operator">|</span>
<span class="token operator">|</span> access_token                       <span class="token operator">|</span>
<span class="token operator">|</span> application_credential             <span class="token operator">|</span>
<span class="token operator">|</span> application_credential_access_rule <span class="token operator">|</span>
<span class="token operator">|</span> application_credential_role        <span class="token operator">|</span>
<span class="token operator">|</span> assignment                         <span class="token operator">|</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业1：完成数据库同步后显示数据表并截图</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h3 id="Keystone服务初始化"><a href="#Keystone服务初始化" class="headerlink" title="Keystone服务初始化"></a>Keystone服务初始化</h3><ol>
<li><p>初始化fernet密钥库</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 生成用来加密解密令牌的fernet密钥</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span>
<span class="token comment"># 生成用来加密解密用户凭证的fernet密钥</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>初始化admin用户身份认证信息</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># keystone-manage bootstrap --bootstrap-password 000000 --bootstrap-admin-url http://controller:5000/v3 --bootstrap-internal-url http://contoller:5000/v3 --bootstrap-public-url http://controller:5000/v3 --bootstrap-region-id RegionOne</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>此时keystone数据库内已经存放了admin用户登录所需要验证的信息。</p>
</blockquote>
</li>
<li><p>配置web服务</p>
<ul>
<li><p>在Apache服务器的配置目录中生成<code>WSGI</code>的配置文件用来支持<code>WSGI</code></p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>修改<code>/etc/httpd/conf/httpd.conf</code>文件95行为<code>ServerName controller</code>设置Apache服务的地址为控制节点主机名，重启服务、设置开机自启</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller b<span class="token punctuation">]</span><span class="token comment"># systemctl enable httpd</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
<span class="token punctuation">[</span>root@controller b<span class="token punctuation">]</span><span class="token comment"># systemctl restart httpd</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<h2 id="Keystone服务认证、身份管理"><a href="#Keystone服务认证、身份管理" class="headerlink" title="Keystone服务认证、身份管理"></a>Keystone服务认证、身份管理</h2><h3 id="通过OpenStack-管理命令进行身份管理"><a href="#通过OpenStack-管理命令进行身份管理" class="headerlink" title="通过OpenStack 管理命令进行身份管理"></a>通过OpenStack 管理命令进行身份管理</h3><ol>
<li><p><code>vi admin-login</code>创建文件添加以下身份凭证：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">export OS_USERNAME=admin
export OS_PASSWORD=000000
export OS_PROJECT_NAME=admin
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default
export OS_AUTH_URL=http://controller:5000/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>导入环境变量</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># source admin-login </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
<li><p>通过管理命令创建项目：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># openstack project create --domain default project</span>
+-------------+----------------------------------+
<span class="token operator">|</span> Field       <span class="token operator">|</span> Value                            <span class="token operator">|</span>
+-------------+----------------------------------+
<span class="token operator">|</span> description <span class="token operator">|</span>                                  <span class="token operator">|</span>
<span class="token operator">|</span> domain_id   <span class="token operator">|</span> default                          <span class="token operator">|</span>
<span class="token operator">|</span> enabled     <span class="token operator">|</span> True                             <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> 1ddf073425f44982b81884a6cd897616 <span class="token operator">|</span>
<span class="token operator">|</span> is_domain   <span class="token operator">|</span> False                            <span class="token operator">|</span>
<span class="token operator">|</span> name        <span class="token operator">|</span> project                          <span class="token operator">|</span>
<span class="token operator">|</span> options     <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>                               <span class="token operator">|</span>
<span class="token operator">|</span> parent_id   <span class="token operator">|</span> default                          <span class="token operator">|</span>
<span class="token operator">|</span> tags        <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                               <span class="token operator">|</span>
+-------------+----------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业2：项目创建完成后截图</p>
</blockquote>
</li>
<li><p>常用管理命令：</p>
 <img src="https://vault.taojie.fun:28089/i/2023/09/16/2023-09-16-1694795373.png" alt="1694795372656.png" title="1694795372656.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/09/16/2023-09-16-1694795401.png" alt="1694795400751.png" title="1694795400751.png" /></li>
</ol>
<h3 id="通过API进行身份管理"><a href="#通过API进行身份管理" class="headerlink" title="通过API进行身份管理"></a>通过API进行身份管理</h3><p>OpenStack所提供的API允许开发人员通过编程方式与OpenStack的各种服务进行通信，以实现自动化、集成和定制化的功能。</p>
<blockquote>
<p>监控和报警： OpenStack API允许开发人员编写监控应用程序，以监测OpenStack环境的状态并实时响应，包括生成警报和报告。<br>数据分析和报告： 通过API，开发人员可以获取OpenStack环境中的数据，并进行分析和报告，以支持决策制定和优化资源分配。</p>
</blockquote>
<ol>
<li><p>使用curl向openstack请求一个令牌：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-X</span> POST <span class="token variable">$OS_AUTH_URL</span>/auth/tokens <span class="token punctuation">\</span>
 <span class="token parameter variable">-H</span> <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
 <span class="token parameter variable">-d</span> <span class="token string">'&#123;
     "auth": &#123;
         "identity": &#123;
             "methods": ["password"],
             "password": &#123;
                 "user": &#123;
                     "domain": &#123;"name": "'</span>"<span class="token variable">$OS_USER_DOMAIN_NAME</span><span class="token string">"'"</span><span class="token punctuation">&#125;</span>,
                     <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"'"</span><span class="token variable">$OS_USERNAME</span><span class="token string">"'"</span>,
                     <span class="token string">"password"</span><span class="token builtin class-name">:</span> <span class="token string">"'"</span><span class="token variable">$OS_PASSWORD</span><span class="token string">"'"</span>
                 <span class="token punctuation">&#125;</span>
             <span class="token punctuation">&#125;</span>
         <span class="token punctuation">&#125;</span>,
         <span class="token string">"scope"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
             <span class="token string">"project"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
                 <span class="token string">"domain"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"'"</span><span class="token variable">$OS_PROJECT_DOMAIN_NAME</span><span class="token string">"'"</span><span class="token punctuation">&#125;</span>,
                 <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"'"</span><span class="token variable">$OS_PROJECT_NAME</span><span class="token string">"'"</span>
             <span class="token punctuation">&#125;</span>
         <span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span>
 <span class="token punctuation">&#125;</span>' <span class="token punctuation">\</span>
 <span class="token operator">|</span>python <span class="token parameter variable">-m</span> json.tool<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>从返回的响应中提取字段<code>X-Subject-Token</code>的值即获取到的token</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">* About to connect() to controller port 5000 (#0)
*   Trying 192.168.10.10...
* Connected to controller (192.168.10.10) port 5000 (#0)
> POST /v3/auth/tokens?nocatalog HTTP/1.1
> User-Agent: curl/7.29.0
> Host: controller:5000
> Accept: */*
> Content-Type: application/json
> Content-Length: 472
>
&#125; [data not shown]
* upload completely sent off: 472 out of 472 bytes
&lt; HTTP/1.1 201 CREATED
&lt; Date: Fri, 15 Sep 2023 17:29:38 GMT
&lt; Server: Apache/2.4.6 (CentOS) mod_wsgi/3.4 Python/2.7.5
&lt; X-Subject-Token: gAAAAABlBJSCUlkAxmXcgaMCjAQznrea88WgOxL5VP8PifbX-Q-boOzZUVDb3sc0cTOVUegjeNSRKdii1ZtYwBDbZ1WRTTki_2dRlrE1d_D5erFMml-3YAY5BL2vBWXSimVAXIG9jUycTLkqbcavEf79i3Z0xfPHUOaxzC9eA5dvDbS1eRA_Y2c
&lt; Vary: X-Auth-Token
&lt; x-openstack-request-id: req-ecb79fdc-f4e7-4ca8-8c02-f2d69a28f453
&lt; Content-Length: 648
&lt; Content-Type: application/json
&lt;
&#123; [data not shown]
* Connection #0 to host controller left intact<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>导出环境变量<code>OS_TOKEN</code>、通过API读取用户列表：</p>
<ul>
<li><p>将上一步提取的token导出环境变量，<code>每个人的token不一样，自行替换</code></p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># export OS_TOKEN=gAAAAABlBJSCUlkAxmXcgaMCjAQznrea88WgOxL5VP8PifbX-Q-boOzZUVDb3sc0cTOVUegjeNSRKdii1ZtYwBDbZ1WRTTki_2dRlrE1d_D5erFMml-3YAY5BL2vBWXSimVAXIG9jUycTLkqbcavEf79i3Z0xfPHUOaxzC9eA5dvDbS1eRA_Y2c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用相关的API获取用户列表</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># curl -s -X GET $OS_AUTH_URL/users -H "X-Auth-Token:$OS_TOKEN" -H "Content-Type: application/json" |python -m json.tool</span>
<span class="token punctuation">&#123;</span>
    <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"next"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"previous"</span><span class="token builtin class-name">:</span> null,
        <span class="token string">"self"</span><span class="token builtin class-name">:</span> <span class="token string">"http://controller:5000/v3/users"</span>
    <span class="token punctuation">&#125;</span>,
    <span class="token string">"users"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token string">"domain_id"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
            <span class="token string">"enabled"</span><span class="token builtin class-name">:</span> true,
            <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token string">"d21e719687444563a40a2528eb22996b"</span>,
            <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"self"</span><span class="token builtin class-name">:</span> <span class="token string">"http://controller:5000/v3/users/d21e719687444563a40a2528eb22996b"</span>
            <span class="token punctuation">&#125;</span>,
            <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"admin"</span>,
            <span class="token string">"options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,
            <span class="token string">"password_expires_at"</span><span class="token builtin class-name">:</span> null
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<blockquote>
<p>作业3：通过api获取用户列表后截图</p>
</blockquote>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/08/private_clouds/2.OpenStack%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/08/private_clouds/2.OpenStack%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">OpenStack基础操作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-08 11:01:49" itemprop="dateCreated datePublished" datetime="2023-09-08T11:01:49+08:00">2023-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-18 13:10:18" itemprop="dateModified" datetime="2023-09-18T13:10:18+08:00">2023-09-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>控制节点快照<code>项目12</code><br>计算节点快照<code>项目12</code></p>
</blockquote>
<h2 id="Horizon简介、名词解释"><a href="#Horizon简介、名词解释" class="headerlink" title="Horizon简介、名词解释"></a>Horizon简介、名词解释</h2><p>Horizon是一个开源的Web界面，用于管理和监控整个OpenStack云计算环境。它提供了直观的用户界面，允许用户通过Web浏览器执行各种云管理任务，包括创建和管理虚拟机实例、配置网络、存储、查看监控数据等。</p>
<ul>
<li><p>项目（Project）：项目是云中的组织单位，也称为租户或帐户，它包含了一组资源（如虚拟机实例、网络、存储等）。每个用户都是一个或多个项目的成员。在项目中，用户创建和管理实例和镜像。</p>
</li>
<li><p>用户（User）:  用户是OpenStack云的最终使用者，用户可以属于一个或多个项目，并根据其角色和权限来访问和管理资源。</p>
</li>
<li><p>角色（Role）: 角色是预定义的权限集合。每个项目可以分配不同的角色给用户，以控制他们可以执行的操作。常见的角色包括管理员、成员等。</p>
</li>
<li><p>虚拟机实例（Instance）： 虚拟机实例是运行在 OpenStack 计算节点上的虚拟机。</p>
</li>
<li><p>镜像（Image）： 镜像是虚拟机实例的模板，用户可以选择不同的镜像来创建虚拟机实例。</p>
</li>
</ul>
<h2 id="访问OpenStack主界面"><a href="#访问OpenStack主界面" class="headerlink" title="访问OpenStack主界面"></a>访问OpenStack主界面</h2><p>Horizon安装在计算节点上，可以通过浏览器<code>192.168.10.20</code>访问Horizon服务的界面，设置域名<code>Default</code>、用户名<code>admin</code>、密码<code>000000</code>完成登录。登录成功界面如下：</p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/10/2023-09-10-1694326793.png" alt="1694326791438.png"></p>
<blockquote>
<p>通过单击右上角<code>admin</code>用户名弹出用户菜单-&gt;设置，修改语言、时区设置。</p>
</blockquote>
<p>整个主界面分为以下三个顶级菜单（仪表板）：</p>
<pre><code>1. 项目：普通用户和管理员可见，用于项目内的资源管理。

2. 管理员：仅管理员可见，用户全局的资源管理。

3. 身份管理：管理员可用于管理整个系统的身份认证，普通用户只能管理自己的项目信息。
</code></pre>
<h2 id="创建和操作虚拟机实例"><a href="#创建和操作虚拟机实例" class="headerlink" title="创建和操作虚拟机实例"></a>创建和操作虚拟机实例</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><ol>
<li><p>实例的源：源是用来创建实例的模板，包括镜像、实例快照（镜像快照）、卷、卷快照都可以作为实例的源。</p>
</li>
<li><p>实例类型：实例类型也就是实例的规格，包括虚拟CPU核心数量、内存大小、存储容量等等。</p>
<blockquote>
<p>实例类型仅管理员所有，只有管理员有权访问。</p>
</blockquote>
</li>
<li><p>网络：网络指的是虚拟网络，选择一个虚拟网络和子网，以确定虚拟机实例的网络配置。这包括 IP 地址分配、路由设置等。可以选择将虚拟机连接到外部网络，以实现互联网访问</p>
</li>
<li><p>密钥对：密钥对是在虚拟机实例启动时注入，用于SSH或着其他远程访问的凭证。</p>
</li>
<li><p>安全组：安全组是一种网络防火墙规则集合，用于控制虚拟机实例的入站和出站流量。创建和配置安全组以允许或拒绝特定端口和协议的流量。</p>
</li>
</ol>
<h3 id="创建虚拟机实例"><a href="#创建虚拟机实例" class="headerlink" title="创建虚拟机实例"></a>创建虚拟机实例</h3><ol>
<li><p>创建项目</p>
<p>进入身份管理-&gt;项目面板，创建新项目<code>test_project</code></p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/10/2023-09-10-1694328081.png" alt="1694328079544.png"></p>
</li>
<li><p>创建用户</p>
<p> 进入身份管理-&gt;用户面板，创建新用户<code>test_user</code>，设置密码<code>000000</code>并选择主项目<code>test_project</code></p>
 <img src="https://vault.taojie.fun:28089/i/2023/09/10/2023-09-10-1694328368.png">
</li>
<li><p>创建镜像</p>
<p> 先从网络中下载<a target="_blank" rel="noopener" href="https://download.fedoraproject.org/pub/fedora/linux/releases/38/Cloud/x86_64/images/Fedora-Cloud-Base-38-1.6.x86_64.qcow2">Fedora适用于Openstack的Cloud Base镜像</a>到本地  </p>
<p> 进入管理员-&gt;计算-&gt;镜像-&gt;创建镜像，镜像源-&gt;浏览选择刚才下载好的镜像文件，镜像格式<code>qcow2</code>，</p>
<img src="https://vault.taojie.fun:28089/i/2023/09/18/2023-09-18-1695013528.png" alt="1695013525543.png" title="1695013525543.png" />

<blockquote>
<p>作业1：镜像创建完成，截图镜像列列表上传。</p>
</blockquote>
</li>
<li><p>创建实例类型</p>
<p> 进入管理员-&gt;计算-&gt;实例类型，右上角创建实例类型，并且设置实例类型的使用权，选择项目<code>test_project</code>。</p>
 <img src="https://vault.taojie.fun:28089/i/2023/09/15/2023-09-15-1694785336.png" alt="1694785335731.png" title="1694785335731.png" />

 <img src="https://vault.taojie.fun:28089/i/2023/09/18/2023-09-18-1695013697.png" alt="1695013694529.png" title="1695013694529.png" />
</li>
<li><p>创建网络</p>
<ul>
<li><p>进入管理员-&gt;网络-&gt;网络，右上角创建网络，按下图配置：</p>
  <img src="https://vault.taojie.fun:28089/i/2023/09/13/2023-09-13-1694604373.png" alt="1694604372183.png" title="1694604372183.png" />
</li>
<li><p>继续配置子网选项后下一步完成创建：</p>
  <img src="https://vault.taojie.fun:28089/i/2023/09/13/2023-09-13-1694604448.png" alt="1694604447868.png" title="1694604447868.png" /></li>
</ul>
</li>
<li><p><code>退出当前的admin用户，使用刚才创建的test_user用户登录</code>，侧边栏选择项目-&gt;计算-&gt;实例-&gt;创建实例，<code>详情</code>标签设置实例名称<code>test_instance</code></p>
<ul>
<li><p><code>源</code>标签选择源<code>Image</code>、卷大小<code>1GB</code>、在列表中选择镜像<code>cirros</code></p>
  <img src="https://vault.taojie.fun:28089/i/2023/09/11/2023-09-11-1694392927.png" alt="1694392926393.png" title="1694392926393.png" />
</li>
<li><p><code>实例类型</code>标签选择之前创建的实例类型<code>small</code>，左下角选择创建实例。</p>
  <img src="https://vault.taojie.fun:28089/i/2023/09/11/2023-09-11-1694393572.png" alt="1694393570624.png" title="1694393570624.png" />

<blockquote>
<p>作业2：使用<code>cirros</code>或者<code>fedora</code>实例创建完成，在实例列表页面登录实例的控制台截图上传。</p>
</blockquote>
  <img src="https://vault.taojie.fun:28089/i/2023/09/15/2023-09-15-1694785678.png" alt="1694785677644.png" title="1694785677644.png" />

  <img src="https://vault.taojie.fun:28089/i/2023/09/15/2023-09-15-1694785802.png" alt="1694785801589.png" title="1694785801589.png" /></li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/27/private_clouds/1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenStack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/27/private_clouds/1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenStack/" class="post-title-link" itemprop="url">初识云计算与OpenStack</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-27 22:11:49" itemprop="dateCreated datePublished" datetime="2023-06-27T22:11:49+08:00">2023-06-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-14 07:59:40" itemprop="dateModified" datetime="2023-09-14T07:59:40+08:00">2023-09-14</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://wxstc.fanya.chaoxing.com/portal">超星网址</a></p>
</blockquote>
<h2 id="传统的计算模式"><a href="#传统的计算模式" class="headerlink" title="传统的计算模式"></a>传统的计算模式</h2><h3 id="计算机系统结构"><a href="#计算机系统结构" class="headerlink" title="计算机系统结构"></a>计算机系统结构</h3><p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-25-22-09-05.png" alt="1.初识云计算与Openstack-2023-08-25-22-09-05"></p>
<p>传统的计算模式是指企业或个人在自己的本地环境中构建、管理和维护硬件设备、操作系统和应用程序，以满足其计算和存储需求。</p>
<blockquote>
<p>对于个人用户的场景：需要搭建服务或者使用Linux系统环境时，我们往往需要在本地计算机上搭建虚拟机或者单独购买一套硬件来实现。<br>对于企业用户的场景：需要对内向员工提供项目管理等等办公服务、对外向用户提供web服务，数据库服务等等，同样需要在企业内部通过搭建数据中心来实现。</p>
</blockquote>
<ul>
<li>需要购买和维护物理硬件设备，同时需要专业的IT团队来管理硬件和软件设施。（成本过高）</li>
<li>资源利用率可能不高，硬件设备难以进行快速的资源分配和释放。（企业达到一定规模后难以适应多变的需求）</li>
<li>扩展时需要购买更多硬件，时间和成本较高。（扩展性差）</li>
<li>需要考虑容灾和高可用性，可能需要复杂的架构设计。（安全性需要得到保障）</li>
</ul>
<h2 id="云计算的概念"><a href="#云计算的概念" class="headerlink" title="云计算的概念"></a>云计算的概念</h2><p><strong>云计算的定义：</strong> 云计算是一种按使用量付费的模式，它可以实现随时随地，便捷地，随需应变地从可配置计算资源共享池中获取所需的资源（例如，网络、服务器、存储、应用、及服务），资源能够快速供应并释放，使管理资源的工作量和与服务提供商的交互减小到最低限度。</p>
<blockquote>
<p>和传统模式特点比较</p>
</blockquote>
<p><strong>资源池化：</strong> 传统的虚拟化技术是将单个服务器硬件虚拟成多个虚拟机，其目的也是在于提高服务器资源的利用率。但是，由于单个服务器的CPU、内存、硬盘资源颗粒度较小，因此在虚拟化应用中，经常出现资源配置空洞，要么是CPU核数没有分配完，要么是内存没有分配完，更多的情况是硬盘容量存在大量空闲。而服务器资源池化可以更好的解决上述问题。</p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-14-41-36.jpg" alt="1.初识云计算与Openstack-2023-08-26-14-41-36"></p>
<h2 id="云计算的特点"><a href="#云计算的特点" class="headerlink" title="云计算的特点"></a>云计算的特点</h2><ol>
<li>资源池化：云计算中的资源（如计算能力、存储、网络等）被集中管理并池化，供多个用户共享。这种资源的共享和动态分配提高了资源的利用率。</li>
<li>按需分配： 用户可以根据自己的需求，自主地获取和配置计算资源，无需人工干预。这种自服务模式使用户能够快速获取所需资源，提高了效率。</li>
<li>快速弹性扩展： 用户可以根据需要快速扩展或缩减资源，以适应业务的变化。这种弹性特性允许用户在高峰时段获得更多资源，而在低谷时段释放资源。</li>
<li>可用性和容灾性：许多云服务提供商提供高可用性和容灾选项，确保服务在故障时能够持续运行，减少了业务中断的风险。</li>
</ol>
<blockquote>
<p>可扩展一方面使得上云的应用能够根据不同时段的业务需求动态调整资源另一方面，企业可以在不停机的情况下增加任意资源；可用性使得服务器出现故障时会无缝切换到资源池上的其他资源，不管是计算资源还是存储设备都能保证24小时不间断提供服务。<br>基于以上特点总结：用户不需要为应用单独购买服务器、同时不需要付出管理成本，只需要付出租用的成本就可以使用到随时能够扩容的并且有专业人员维护以保障安全的计算服务。</p>
</blockquote>
<h2 id="云计算的分类"><a href="#云计算的分类" class="headerlink" title="云计算的分类"></a>云计算的分类</h2><h3 id="按服务对象或者运营模式分类"><a href="#按服务对象或者运营模式分类" class="headerlink" title="按服务对象或者运营模式分类"></a>按服务对象或者运营模式分类</h3><ol>
<li><p>公有云：“公有”反映了这类云服务并非用户所拥有，公有云是面向大众提供计算资源的服务。是由第三方云服务提供商提供资源，如应用和存储，这些资源是在服务商的场所内部署。用户通过Internet互联网来获取这些资源的使用。<br>公有云的优势是成本低，扩展性非常好。缺点是对于云端的资源缺乏控制、保密数据的安全性、网络性能问题。<br>规模最大的几个公有云厂商：阿里云、Amazon Web Services（AWS）、Google Cloud</p>
</li>
<li><p>私有云：“私有”更多是指此类平台属于非共享资源，而非指其安全优势。私有云是为了一个客户单独使用而构建的，所以这些数据、安全和服务质量都较公有云有着更好地保障。<br>在私有云模式中，云平台的资源为包含多个用户的单一组织专用。私有云可由该组织、第三方或两者联合拥有、管理和运营。私有云的部署场所可以是在机构内部，也可以在外部。</p>
</li>
<li><p>混合云：混合云结合了公有云和私有云的特点，允许数据和应用在这两者之间流动。组织可以在私有云中部署敏感数据或关键业务应用，同时利用公有云的弹性来处理突发业务需求。混合云模型可以最大程度地平衡安全性、灵活性和成本效益。</p>
</li>
</ol>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-20-09-02.png" alt="1.初识云计算与Openstack-2023-08-26-20-09-02"></p>
<h3 id="按服务类型分类"><a href="#按服务类型分类" class="headerlink" title="按服务类型分类"></a>按服务类型分类</h3><p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-20-00-39.jpg" alt="1.初识云计算与Openstack-2023-08-26-20-00-39"></p>
<ol>
<li><p>IaaS（Infrastructure as a Service–基础架构即服务）：<br>IaaS提供了基础的计算、存储和网络资源，用户可以在这些资源上构建和管理自己的应用环境。它为用户提供了虚拟化的计算资源，包括虚拟机、存储和网络连接。用户可以根据需要自主配置和管理操作系统、应用程序和数据。</p>
<blockquote>
<p>阿里云的ECS服务器，腾讯云的CVM服务器</p>
</blockquote>
</li>
<li><p>PaaS（Platform as a Service–平台即服务）：<br>PaaS在IaaS的基础上提供了更高层次的服务，除了计算、存储和网络，还包括了开发和部署应用程序所需的平台环境。PaaS提供了开发工具、数据库、中间件和运行时环境等，使开发人员能够更专注于应用程序的开发而不必关心底层基础设施。</p>
<blockquote>
<p>阿里云的EDAS</p>
</blockquote>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-16-31-49.png" alt="1.初识云计算与Openstack-2023-08-26-16-31-49"></p>
</li>
<li><p>SaaS（Software as a Service–软件即服务）：<br>SaaS提供完整的应用程序，用户通过互联网访问这些应用程序，无需安装和维护。SaaS应用程序由云服务提供商托管和维护，用户只需要通过浏览器或移动应用访问应用功能。</p>
<blockquote>
<p>微软的Microsoft 365，各种在线工具。</p>
</blockquote>
</li>
</ol>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-16-32-26.png" alt="1.初识云计算与Openstack-2023-08-26-16-32-26"></p>
<h2 id="OpenStack介绍"><a href="#OpenStack介绍" class="headerlink" title="OpenStack介绍"></a>OpenStack介绍</h2><p>OpenStack是一个自由、开源的云计算平台。它主要作为基础设施即服务（IaaS）部署在公有云和私有云中，提供虚拟服务器和其他资源给用户使用。该软件平台由相互关联的组件组成，控制着整个数据中心内不同的厂商的处理器、存储和网络资源的硬件池。用户可以通过基于网络的仪表盘、命令行工具或RESTful网络服务来管理。</p>
<p>OpenStack始于2010年，是Rackspace和美国国家航空航天局的合作项目。截至2012年，它由2012年9月成立的非营利组织OpenStack基金会管理，旨在促进OpenStack软件及其社区。到2018年，已经有500多家公司加入了该项目。在2020年，该基金会宣布它将在2021年更名为Open Infrastructure Foundation（开放基础设施基金会）。</p>
<h3 id="适用范围"><a href="#适用范围" class="headerlink" title="适用范围"></a>适用范围</h3><p>OpenStack是基础设施即服务（IaaS）软件，让任何人都可以自行建立和提供云计算服务。</p>
<p>此外，OpenStack也用作建立防火墙内的“私有云”（Private Cloud），提供机构或企业内各部门共享资源。</p>
<h3 id="发展历程"><a href="#发展历程" class="headerlink" title="发展历程"></a>发展历程</h3><p>OpenStack每半年会发布一个版本，版本从字母A开始向后按顺序的命名；OpenStack社区为了方便描述，因此他们为每一个字母来进行投票，来选出一个单词。</p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-20-34-27.png" alt="1.初识云计算与Openstack-2023-08-26-20-34-27"></p>
<h3 id="OpenStack架构"><a href="#OpenStack架构" class="headerlink" title="OpenStack架构"></a>OpenStack架构</h3><p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-21-59-40.png" alt="1.初识云计算与Openstack-2023-08-26-21-59-40"></p>
<h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><ol>
<li>Keystone： 身份认证服务，用于管理用户、项目和角色，并提供认证和授权功能。</li>
<li>Nova： 计算服务，用于创建和管理虚拟机实例，提供计算资源。</li>
<li>Neutron： 网络服务，提供网络资源的管理和连接，包括虚拟网络、子网、路由等。</li>
<li>Glance： 镜像服务，用于管理虚拟机镜像，用户可以从镜像创建虚拟机实例。</li>
<li>Placement： 该组件于OpenStack Stein版本引入，主要用于优化虚拟机实例的资源分配和调度。</li>
</ol>
<p>其他常用组件：</p>
<ol>
<li>Cinder： 块存储服务，提供虚拟机实例所需的持久性块存储，如挂载到虚拟机的卷。</li>
<li>Swift： 对象存储服务，用于存储非结构化数据，如文件、图像和视频等。</li>
<li>Horizon： Web 控制台，提供用户界面，用于管理和监控 OpenStack 系统。</li>
</ol>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-21-11-14.png" alt="1.初识云计算与Openstack-2023-08-26-21-11-14"></p>
<blockquote>
<p>OpenStack本身是一个分布式系统，不但各个服务可以分布部署，服务中的组件也可以分布部署。<br>这种分布式特性让OpenStack具备极大的灵活性、伸缩性和高可用性。</p>
</blockquote>
<h3 id="示例架构"><a href="#示例架构" class="headerlink" title="示例架构"></a>示例架构</h3><p>示例架构需要至少两个节点（主机）来启动基本虚拟机或实例。块存储和对象存储等可选服务需要额外的节点。</p>
<p>基本两节点OpenStack部署示例：</p>
<ol>
<li><p>控制节点（Controller Node）： 这个节点承担了OpenStack核心服务的角色，例如Identity服务 (Keystone)、Dashboard服务 (Horizon)、Compute服务 (Nova API)、网络服务 (Neutron API) 等。这个节点管理OpenStack环境的整体状态。</p>
</li>
<li><p>计算节点（Compute Node）： 这个节点用于运行虚拟机实例。虚拟机的资源会在计算节点上分配和运行。它连接到控制节点以获取任务和指令，并与存储和网络资源进行交互。</p>
</li>
</ol>
<blockquote>
<p>这种配置适用于非常基本的测试、学习或演示用途，但在生产环境中，为了实现更高的性能、可用性和容错性，通常会使用更多的节点和组件。</p>
</blockquote>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-26-22-58-14.png" alt="1.初识云计算与Openstack-2023-08-26-22-58-14"></p>
<h2 id="使用packstack部署OpenStack平台"><a href="#使用packstack部署OpenStack平台" class="headerlink" title="使用packstack部署OpenStack平台"></a>使用packstack部署OpenStack平台</h2><h3 id="资源清单"><a href="#资源清单" class="headerlink" title="资源清单"></a>资源清单</h3><table>
<thead>
<tr>
<th>资源名称</th>
<th>说明</th>
<th>地址</th>
</tr>
</thead>
<tbody><tr>
<td>openStack-train.iso</td>
<td>Centos + OpenStack平台镜像</td>
<td></td>
</tr>
</tbody></table>
<h3 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h3><h4 id="节点规划"><a href="#节点规划" class="headerlink" title="节点规划"></a>节点规划</h4><table>
<thead>
<tr>
<th>节点名称（主机名）</th>
<th>外网网卡IP地址（网卡名：ens34）</th>
<th>内网网卡IP地址（网卡名：ens33）</th>
</tr>
</thead>
<tbody><tr>
<td>controller</td>
<td>192.168.20.10</td>
<td>192.168.10.10</td>
</tr>
<tr>
<td>compute</td>
<td>192.168.20.20</td>
<td>192.168.10.20</td>
</tr>
</tbody></table>
<h4 id="利用快照快速恢复系统"><a href="#利用快照快速恢复系统" class="headerlink" title="利用快照快速恢复系统"></a>利用快照快速恢复系统</h4><ol>
<li><p>控制节点虚拟机环境准备</p>
<p>虚拟机列表中右键名为<code>控制节点</code>的虚拟机-&gt;快照-&gt;快照管理器，选中<code>项目2 系统安装完成</code>后转到并确认。此时虚拟机<code>控制节点</code>已恢复到系统安装完毕后的版本（利用快照管理器可以将虚拟机快速恢复到之前已经保存过的任意状态）。</p>
<blockquote>
<p>这一步创建好的系统ROOT账户密码<code>000000</code></p>
</blockquote>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-27-20-43-21.png" alt="1.初识云计算与Openstack-2023-08-27-20-43-21"></p>
</li>
<li><p>计算节点虚拟机环境准备</p>
<p>先关闭<code>控制节点</code>虚拟机，在虚拟机列表中右键名为<code>计算节点</code>的虚拟机-&gt;移除，右键<code>控制节点</code>虚拟机-&gt;管理-&gt;克隆，按照向导提示完成虚拟机克隆，克隆自虚拟机中的当前状态，克隆方法选择<code>完整克隆</code>，虚拟机名称设置为<code>计算节点</code>。</p>
</li>
</ol>
<p>此时运行OpenStack所需的双节点系统环境已经创建完成，接下来做基础配置。</p>
<h4 id="虚拟机网络配置"><a href="#虚拟机网络配置" class="headerlink" title="虚拟机网络配置"></a>虚拟机网络配置</h4><p>此步骤的配置需要在<code>控制节点</code>和<code>计算节点</code>上完成，每个节点分别有两个网卡需要配置：一个内网网卡和一个外网网卡。</p>
<ol>
<li><p>在编辑-&gt;虚拟网络编辑器可以为虚拟机配置桥接模式网络连接、NAT 和仅主机模式网络连接。</p>
<ol>
<li><p>桥接模式</p>
<p>桥接模式网络连接通过使用主机系统上的网络适配器将虚拟机连接到网络。如果主机系统位于网络中，桥接模式网络连接通常是虚拟机访问该网络的最简单途径。</p>
</li>
<li><p>NAT模式</p>
<p>使用 NAT 模式网络时，虚拟机在外部网络中不必具有自己的 IP 地址。主机系统上会建立单独的专用网络。在默认配置中，虚拟机会在此专用网络中通过 DHCP 服务器获取地址。虚拟机和主机系统共享一个网络标识，此标识在外部网络中不可见。</p>
</li>
<li><p>仅主机模式</p>
<p>编辑-&gt;虚拟网络编辑器，右下角更改设置，按照<a href="#%E8%8A%82%E7%82%B9%E8%A7%84%E5%88%92">节点规划</a>将<code>仅主机模式</code>和<code>NAT模式</code>配置为如下图。其中<code>仅主机模式</code>的子网地址为<code>192.168.10.0</code>，<code>NAT模式</code>的子网地址为<code>192.168.20.0</code>。</p>
<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-29-14-43-53.png" alt="1.初识云计算与Openstack-2023-08-29-14-43-53"></p>
</li>
</ol>
</li>
<li><p>启动<code>控制节点</code>虚拟机，在控制节点中使用如下命令编辑<code>网卡ens33</code>的配置文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>编辑文件如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span>none
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static        <span class="token comment"># 1. 配置静态分配ip</span>
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span>stable-privacy
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>ens33
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>266c663e-d288-4d54-b100-00741dda6c70
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ens33
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes              <span class="token comment"># 2. 配置开机激活网卡</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.10.10    <span class="token comment"># 3. 配置ip地址</span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0   <span class="token comment"># 4. 配置子网掩码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ens33作为内网网口不需要配置默认网关。</p>
</blockquote>
<p>用相同的方法配置外网网卡<code>ens34</code>，配置如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span>none
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>n
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static        <span class="token comment"># 1. 配置静态分配ip</span>
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span>stable-privacy
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>ens34
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>bf2fdda3-d6bf-4a72-953f-02cd83115887
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ens34
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes              <span class="token comment"># 2. 配置开机激活网卡</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.20.10    <span class="token comment"># 3. 配置ip地址</span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0   <span class="token comment"># 4. 配置子网掩码</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.20.2    <span class="token comment"># 5. 配置网关</span>
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114    <span class="token comment"># 6. 配置dns</span>
<span class="token assign-left variable">DNS2</span><span class="token operator">=</span><span class="token number">8.8</span>.8.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用命令<code>ifup + 网卡名</code>激活上一步修改的两个网卡配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ifup ens33</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ifup ens34</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>使用命令<code>ip addr</code>查看当前网卡配置：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
   link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
   inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
      valid_lft forever preferred_lft forever
   inet6 ::1/128 scope <span class="token function">host</span>
      valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
   link/ether 00:0c:29:f2:ca:50 brd ff:ff:ff:ff:ff:ff
   inet <span class="token number">192.168</span>.10.10/24 brd <span class="token number">192.168</span>.10.255 scope global noprefixroute ens33
      valid_lft forever preferred_lft forever
   inet6 fe80::922:6217:cb6c:e63/64 scope <span class="token function">link</span> noprefixroute
      valid_lft forever preferred_lft forever
<span class="token number">3</span>: ens34: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
   link/ether 00:0c:29:f2:ca:5a brd ff:ff:ff:ff:ff:ff
   inet <span class="token number">192.168</span>.20.10/24 brd <span class="token number">192.168</span>.20.255 scope global noprefixroute ens34
      valid_lft forever preferred_lft forever
   inet6 fe80::9b23:9dcb:6af7:812d/64 scope <span class="token function">link</span> noprefixroute
      valid_lft forever preferred_lft forever <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>作业1-参考以下命令，使用<code>ping</code>命令验证当前虚拟机网络，验证完成后截图上传。</p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">//验证内网网卡和宿主机之间的网络连通性
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ping -c3 -I ens33 192.168.10.1</span>
PING <span class="token number">192.168</span>.10.1 <span class="token punctuation">(</span><span class="token number">192.168</span>.10.1<span class="token punctuation">)</span> from <span class="token number">192.168</span>.10.10 ens33: <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.10.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.154</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.10.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.587</span> ms
<span class="token number">64</span> bytes from <span class="token number">192.168</span>.10.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.461</span> ms <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">//验证外网网卡和外网资源的网络连通性
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ping -c3 -I ens34 www.baidu.com</span>
PING www.a.shifen.com <span class="token punctuation">(</span><span class="token number">153.3</span>.238.110<span class="token punctuation">)</span> from <span class="token number">192.168</span>.20.10 ens34: <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">153.3</span>.238.110 <span class="token punctuation">(</span><span class="token number">153.3</span>.238.110<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">6.73</span> ms
<span class="token number">64</span> bytes from <span class="token number">153.3</span>.238.110 <span class="token punctuation">(</span><span class="token number">153.3</span>.238.110<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">6.99</span> ms
<span class="token number">64</span> bytes from <span class="token number">153.3</span>.238.110 <span class="token punctuation">(</span><span class="token number">153.3</span>.238.110<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">6.96</span> ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>启动<code>计算节点</code>虚拟机，上述步骤完成后用相同的方法在<code>计算节点</code>上完成网络配置，首先配置内网网卡<code>ens33</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>编辑文件如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span>none
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static        <span class="token comment"># 1. 配置静态分配ip</span>
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span>stable-privacy
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>ens33
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>266c663e-d288-4d54-b100-00741dda6c70
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ens33
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes              <span class="token comment"># 2. 配置开机激活网卡</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.10.20    <span class="token comment"># 3. 配置ip地址</span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0   <span class="token comment"># 4. 配置子网掩码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>用相同的方法配置外网网卡<code>ens34</code>，配置如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">TYPE</span><span class="token operator">=</span>Ethernet
<span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span>none
<span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span>no
<span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>static        <span class="token comment"># 1. 配置静态分配ip</span>
<span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span>yes
<span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span>no
<span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span>stable-privacy
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>ens34
<span class="token assign-left variable">UUID</span><span class="token operator">=</span>bf2fdda3-d6bf-4a72-953f-02cd83115887
<span class="token assign-left variable">DEVICE</span><span class="token operator">=</span>ens34
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>yes              <span class="token comment"># 2. 配置开机激活网卡</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.20.20    <span class="token comment"># 3. 配置ip地址</span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0   <span class="token comment"># 4. 配置子网掩码</span>
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.20.2    <span class="token comment"># 5. 配置网关</span>
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114    <span class="token comment"># 6. 配置dns</span>
<span class="token assign-left variable">DNS2</span><span class="token operator">=</span><span class="token number">8.8</span>.8.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>使用命令<code>ifup + 网卡名</code>激活上一步修改的两个网卡配置  </p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ifdown ens33</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ifdown ens34</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ifup ens33</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ifup ens34</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>重复上一步使用<code>ping</code>命令验证<code>计算节点</code>的网络配置</p>
</li>
</ul>
</li>
</ol>
<p>到目前为止网络配置完成，下一步开始配置本地yum源</p>
<h4 id="配置本地YUM源、FTP服务、防火墙"><a href="#配置本地YUM源、FTP服务、防火墙" class="headerlink" title="配置本地YUM源、FTP服务、防火墙"></a>配置本地YUM源、FTP服务、防火墙</h4><ol>
<li><p>这一步是加载<a href="#%E8%B5%84%E6%BA%90%E6%B8%85%E5%8D%95">资源清单</a>中列出的两个镜像源文件到虚拟机<code>控制节点</code>中。</p>
<ul>
<li><p>右键虚拟机<code>控制节点</code>-&gt;设置-&gt;选择已有的CD&#x2F;DVD驱动器-&gt;浏览，选择本地的<code>openStack-train.iso</code>文件后完成镜像的加载，同时勾选已连接。</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-28-20-13-50.png" alt="1.初识云计算与Openstack-2023-08-28-20-13-50"></p>
</li>
</ul>
</li>
<li><p>重启<code>控制节点</code>虚拟机，镜像加载到虚拟机<code>控制节点</code>后还需要挂载到系统目录下才能进行读取。</p>
<ul>
<li><p>首先创建挂载点，挂载驱动器中的镜像到指定目录</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir /opt/openstack    # 1. 创建挂载点</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/sr0 /opt/openstack  # 2. 挂载openStack-train.iso镜像</span>
mount: /dev/sr0 is write-protected, mounting read-only<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>挂载完成后<code>df -h</code>查看挂载情况</p>
</blockquote>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/dev/sr0                  16G   16G     <span class="token number">0</span> <span class="token number">100</span>% /opt/openstack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
<li><p>这一步配置<code>控制节点</code>的YUM源，<code>控制节点</code>的源文件在本地。</p>
<ul>
<li><p>删除现有的配置文件</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /etc/yum.repos.d/*.repo</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用<code>vi /etc/yum.repos.d/local.repo</code>创建并编辑文件<code>local.repo</code>，并添加以下配置：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>base<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>base
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/openstack/base/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>extras<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>extras
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/openstack/extras/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>updates<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>updates
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/openstack/updates/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>train<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>train
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/openstack/train/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>virt<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>virt
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>file:///opt/openstack/virt/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>执行以下命令检查YUM源是否可用：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum clean all           # 1. 清除缓存</span>
Loaded plugins: fastestmirror
Cleaning repos: base extras train updates virt
Cleaning up list of fastest mirrors
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum makecache           # 2. 重建缓存</span>
Loaded plugins: fastestmirror
Determining fastest mirrors
base                                                                                                                      <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
extras                                                                                                                    <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
train                                                                                                                     <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
updates                                                                                                                   <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
virt                                                                                                                      <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">1</span>/15<span class="token punctuation">)</span>: base/primary_db                                                                                                   <span class="token operator">|</span> <span class="token number">6.0</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">2</span>/15<span class="token punctuation">)</span>: base/filelists_db                                                                                                 <span class="token operator">|</span> <span class="token number">7.0</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">3</span>/15<span class="token punctuation">)</span>: base/other_db                                                                                                     <span class="token operator">|</span> <span class="token number">2.5</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">4</span>/15<span class="token punctuation">)</span>: extras/filelists_db                                                                                               <span class="token operator">|</span> <span class="token number">259</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">5</span>/15<span class="token punctuation">)</span>: extras/other_db                                                                                                   <span class="token operator">|</span> <span class="token number">145</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">6</span>/15<span class="token punctuation">)</span>: extras/primary_db                                                                                                 <span class="token operator">|</span> <span class="token number">241</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">7</span>/15<span class="token punctuation">)</span>: train/filelists_db                                                                                               <span class="token operator">|</span> <span class="token number">3.6</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">8</span>/15<span class="token punctuation">)</span>: train/primary_db                                                                                                 <span class="token operator">|</span> <span class="token number">1.2</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">9</span>/15<span class="token punctuation">)</span>: train/other_db                                                                                                   <span class="token operator">|</span> <span class="token number">465</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">10</span>/15<span class="token punctuation">)</span>: updates/filelists_db                                                                                             <span class="token operator">|</span> <span class="token number">6.5</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">11</span>/15<span class="token punctuation">)</span>: updates/primary_db                                                                                               <span class="token operator">|</span>  <span class="token number">14</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">12</span>/15<span class="token punctuation">)</span>: updates/other_db                                                                                                 <span class="token operator">|</span> <span class="token number">914</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">13</span>/15<span class="token punctuation">)</span>: virt/filelists_db                                                                                                <span class="token operator">|</span>  <span class="token number">14</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">14</span>/15<span class="token punctuation">)</span>: virt/other_db                                                                                                    <span class="token operator">|</span>  <span class="token number">45</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">15</span>/15<span class="token punctuation">)</span>: virt/primary_db                                                                                                  <span class="token operator">|</span>  <span class="token number">56</span> kB  00:00:00
Metadata Cache Created
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum repolist            # 3. 查看仓库列表</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                                                              repo name                                                             status
base                                                                 base                                                                  <span class="token number">10,039</span>
extras                                                               extras                                                                   <span class="token number">500</span>
train                                                                train                                                                  <span class="token number">3,168</span>
updates                                                              updates                                                                <span class="token number">3,182</span>
virt                                                                 virt                                                                      <span class="token number">63</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>到目前为止<code>控制节点</code>的YUM源配置完毕，最后在<code>控制节点</code>上设置域名解析、关闭防火墙、安装FTP服务器为<code>计算节点</code>提供服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname controller  # 1. 修改主机名</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>修改完主机名后<code>ctrl + D</code>退出当前会话重新登录验证主机名设置是否生效。</p>
</blockquote>
<ul>
<li><p>在<code>/etc/hosts</code>文件最后添加以下两行域名解析</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.10.10 controller
<span class="token number">192.168</span>.10.20 compute<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>修改<code>/etc/selinux/config</code>文件中的<code>SELINUX=enforcing</code>为<code>SELINUX=disabled</code></p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>禁用SELinux和防火墙</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0                   # 1. 禁用SELinux</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld    # 2. 关闭开机启动防火墙</span>
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld       # 3. 立即关闭防火墙</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum remove -y NetworkManager   # 4. 卸载网络管理器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>安装配置FTP服务端</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install vsftpd       # 1. 安装ftp服务端</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 在<code>/etc/vsftpd/vsftpd.conf</code>文件中加入一行<code>anon_root=/opt</code>，设置匿名用户访问的根目录为YUM源所挂载的目录</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># echo "anon_root=/opt" >> /etc/vsftpd/vsftpd.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl start vsftpd      # 1. 立刻启动FTP服务端</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable vsftpd     # 2. 设置开机启动</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/vsftpd.service to /usr/lib/systemd/system/vsftpd.service.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<blockquote>
<p>第二周课前需要将控制节点还原快照5.3.6，计算节点还原快照5.3.4，在此基础上继续下一步配置。</p>
</blockquote>
<ol>
<li><p>这一步配置<code>计算节点</code>的YUM源，通过FTP服务访问挂载到<code>控制节点</code>的源文件。</p>
<ul>
<li><p>修改<code>计算节点</code>的主机名</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname compute  # 1. 修改主机名</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>在<code>/etc/hosts</code>文件最后添加以下两行域名解析</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.10.10 controller
<span class="token number">192.168</span>.10.20 compute<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>修改<code>/etc/selinux/config</code>文件中的<code>SELINUX=enforcing</code>为<code>SELINUX=disabled</code></p>
</li>
<li><p>禁用SELinux和防火墙</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0                   # 1. 禁用SELinux</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld    # 2. 关闭开机启动防火墙</span>
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld       # 3. 立即关闭防火墙</span>
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum remove -y NetworkManager   # 4. 卸载网络管理器</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>删除已有配置文件</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /etc/yum.repos.d/*.repo</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 创建配置文件<code>/etc/yum.repos.d/local.repo</code>，并添加以下配置：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>base<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>base
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://controller/openstack/base/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>extras<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>extras
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://controller/openstack/extras/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>updates<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>updates
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://controller/openstack/updates/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>train<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>train
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://controller/openstack/train/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">[</span>virt<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>virt
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>ftp://controller/openstack/virt/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>执行以下命令检查YUM源是否可用：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum clean all           # 1. 清除缓存</span>
Loaded plugins: fastestmirror
Cleaning repos: base extras train updates virt
Repository base is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
Repository extras is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
Repository updates is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
Cleaning up list of fastest mirrors
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum makecache         # 2. 重建缓存</span>
Loaded plugins: fastestmirror
Repository base is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
Repository extras is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
Repository updates is listed <span class="token function">more</span> than once <span class="token keyword">in</span> the configuration
Determining fastest mirrors
* base: mirrors.aliyun.com
* extras: mirrors.aliyun.com
* updates: mirrors.aliyun.com
base                                                                                                                      <span class="token operator">|</span> <span class="token number">3.6</span> kB  00:00:00
extras                                                                                                                    <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
train                                                                                                                     <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
updates                                                                                                                   <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
virt                                                                                                                      <span class="token operator">|</span> <span class="token number">2.9</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">1</span>/15<span class="token punctuation">)</span>: base/primary_db                                                                                                   <span class="token operator">|</span> <span class="token number">6.0</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">2</span>/15<span class="token punctuation">)</span>: base/filelists_db                                                                                                 <span class="token operator">|</span> <span class="token number">7.0</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">3</span>/15<span class="token punctuation">)</span>: base/other_db                                                                                                     <span class="token operator">|</span> <span class="token number">2.5</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">4</span>/15<span class="token punctuation">)</span>: extras/filelists_db                                                                                               <span class="token operator">|</span> <span class="token number">259</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">5</span>/15<span class="token punctuation">)</span>: extras/other_db                                                                                                   <span class="token operator">|</span> <span class="token number">145</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">6</span>/15<span class="token punctuation">)</span>: extras/primary_db                                                                                                 <span class="token operator">|</span> <span class="token number">241</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">7</span>/15<span class="token punctuation">)</span>: train/filelists_db                                                                                               <span class="token operator">|</span> <span class="token number">3.6</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">8</span>/15<span class="token punctuation">)</span>: train/primary_db                                                                                                 <span class="token operator">|</span> <span class="token number">1.2</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">9</span>/15<span class="token punctuation">)</span>: train/other_db                                                                                                   <span class="token operator">|</span> <span class="token number">465</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">10</span>/15<span class="token punctuation">)</span>: updates/filelists_db                                                                                             <span class="token operator">|</span> <span class="token number">6.5</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">11</span>/15<span class="token punctuation">)</span>: updates/primary_db                                                                                               <span class="token operator">|</span>  <span class="token number">14</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">12</span>/15<span class="token punctuation">)</span>: updates/other_db                                                                                                 <span class="token operator">|</span> <span class="token number">914</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">13</span>/15<span class="token punctuation">)</span>: virt/filelists_db                                                                                                <span class="token operator">|</span>  <span class="token number">14</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">14</span>/15<span class="token punctuation">)</span>: virt/other_db                                                                                                    <span class="token operator">|</span>  <span class="token number">45</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">15</span>/15<span class="token punctuation">)</span>: virt/primary_db                                                                                                  <span class="token operator">|</span>  <span class="token number">56</span> kB  00:00:00
Metadata Cache Created
<span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum repolist          # 3. 查看仓库列表</span>
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
repo <span class="token function">id</span>                                                              repo name                                                             status
base                                                                 base                                                                  <span class="token number">10,039</span>
extras                                                               extras                                                                   <span class="token number">500</span>
train                                                                train                                                                  <span class="token number">3,168</span>
updates                                                              updates                                                                <span class="token number">3,182</span>
virt                                                                 virt                                                                      <span class="token number">63</span>
repolist: <span class="token number">17,906</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<blockquote>
<p>作业2-完成上述<code>yum repolist</code>命令后截图上传。</p>
</blockquote>
</li>
</ol>
<h3 id="安装OpenStack平台"><a href="#安装OpenStack平台" class="headerlink" title="安装OpenStack平台"></a>安装OpenStack平台</h3><ul>
<li><p><code>控制节点</code>安装配置deltarpm来兼容packstack</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum -y install deltarpm</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 在<code>/etc/yum.conf</code>文件中加一行禁用deltarpm</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># echo "deltarpm=0" >>/etc/yum.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>计算节点</code>安装配置deltarpm来兼容packstack</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># yum -y install deltarpm</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 在<code>/etc/yum.conf</code>文件中加一行禁用deltarpm</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@compute ~<span class="token punctuation">]</span><span class="token comment"># echo "deltarpm=0" >>/etc/yum.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>配置<code>iptables</code>允许ftp服务的20&#x2F;21端口</p>
<ol>
<li><p>编辑文件 <code>/etc/sysconfig/iptables-config</code> ，设置第6行<code>IPTABLES_MODULES=</code>值为<code>ip_conntrack_ftp</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">IPTABLES_MODULES</span><span class="token operator">=</span><span class="token string">"ip_conntrack_ftp"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用<code>iptables</code>命令添加两行防火墙规则</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -A INPUT -p tcp -m tcp --dport 21 -j ACCEPT</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -A INPUT -p tcp -m tcp --dport 20 -j ACCEPT</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables -L</span>
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># iptables-save > /etc/sysconfig/iptables</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>在控制节点安装packstack</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># yum install -y openstack-packstack</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>生成配置文件</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># packstack --gen-answer-file=openstack.txt --os-neutron-l2-agent=openvswitch --os-neutron-ml2-mechanism-drivers=openvswitch --os-neutron-ml2-tenant-network-types=vxlan --os-neutron-ml2-type-drivers=vxlan,flat --provision-demo=n --os-neutron-ovs-bridge-mappings=extnet:br-ex --os-neutron-ovs-bridge-interfaces=br-ex:ens34</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>修改配置文件中的IP地址为内网IP</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/192.168.20.10/192.168.10.10/g' openstack.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 修改文件<code>openstack.txt</code>中计算机点的IP</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/CONFIG_COMPUTE_HOSTS=.*/CONFIG_COMPUTE_HOSTS=192.168.10.20/g' openstack.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>开始安装OpenStack</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">packstack --answer-file<span class="token operator">=</span>openstack.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> packstack运行结束后如下图</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note1.%E5%88%9D%E8%AF%86%E4%BA%91%E8%AE%A1%E7%AE%97%E4%B8%8EOpenstack-2023-08-31-01-28-23.png" alt="1.初识云计算与Openstack-2023-08-31-01-28-23"></p>
</li>
<li><p>登录OpenStack平台</p>
<p> 接下来可以通过预先配置的网址<a target="_blank" rel="noopener" href="http://192.168.10.10/dashboard">http://192.168.10.10/dashboard</a>访问OpenStack平台</p>
<p> 账户信息通过<code>cat keystonerc_admin</code>查看</p>
</li>
</ul>
<blockquote>
<p>作业3-登录OpenStack平台后截图上传</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/20/c_program/4.%E7%AC%AC%E5%9B%9B%E5%91%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/20/c_program/4.%E7%AC%AC%E5%9B%9B%E5%91%A8/" class="post-title-link" itemprop="url">第四周</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-20 13:15:40" itemprop="dateCreated datePublished" datetime="2023-06-20T13:15:40+08:00">2023-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h2><h3 id="一维数组的定义和初始化"><a href="#一维数组的定义和初始化" class="headerlink" title="一维数组的定义和初始化"></a>一维数组的定义和初始化</h3><p>数组属于一种构造数据类型，由一定数量的相同类型的元素构成。</p>
<ul>
<li><p>一维数组定义的语法格式：</p>
  <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">&lt;</span>数据类型<span class="token operator">></span> <span class="token operator">&lt;</span>数组名称<span class="token operator">></span><span class="token punctuation">[</span><span class="token operator">&lt;</span>大小<span class="token operator">></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>元素<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>元素<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>元素N<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>  其中：</p>
<ol>
<li>&lt;数据类型&gt; 指定数组中元素的数据类型，可以是基本类型（如 int、float、char 等）或自定义类型。  </li>
<li>&lt;数组名称&gt; 是数组的标识符，用于在程序中引用该数组。  </li>
<li>&lt;大小&gt; 指定数组的大小，即数组中元素的个数。  </li>
<li>{&lt;元素1&gt;, &lt;元素2&gt;, …, &lt;元素N&gt;} 是可选的初始化列表，用于初始化数组中的元素。</li>
</ol>
<p>  数组定义举例：</p>
  <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// 定义一个包含 5个整数的数组</span>
<span class="token keyword">int</span> numbers<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 定义一个包含 4个字符的数组</span>
<span class="token keyword">char</span> characters<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'A'</span><span class="token punctuation">,</span> <span class="token char">'B'</span><span class="token punctuation">,</span> <span class="token char">'C'</span><span class="token punctuation">,</span> <span class="token char">'D'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 定义一个包含 6个浮点数的数组</span>
<span class="token keyword">float</span> values<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>一维数组的初始化</p>
<p>  创建test.c文件，编辑以下内容，可以通过IDE的调试功能观察数组的初始化:</p>
  <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> number<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">//定义一个包含4个字符的数组并对前三个元素进行初始化</span>
    <span class="token keyword">char</span> characters<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'A'</span><span class="token punctuation">,</span> <span class="token char">'B'</span><span class="token punctuation">,</span> <span class="token char">'C'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">//定义一个包含6个浮点数的数组并对第一个元素进行初始化</span>
    <span class="token keyword">float</span> values<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1.0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="一维数组的引用"><a href="#一维数组的引用" class="headerlink" title="一维数组的引用"></a>一维数组的引用</h3><p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note4.%E7%AC%AC%E5%9B%9B%E5%91%A8-2023-06-24-00-05-18.png" alt="4.第四周-2023-06-24-00-05-18"></p>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> number<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第一个元素是：%d\n"</span><span class="token punctuation">,</span> number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：第一个元素是：1</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第二个元素是：%d\n"</span><span class="token punctuation">,</span> number<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：第二个元素是：2</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"第三个元素是：%d\n"</span><span class="token punctuation">,</span> number<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：第三个元素是：3</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h2><p>二维数组是由多个一维数组组成的数据结构，在C语言中可以使用以下方式进行定义和初始化：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">数据类型 数组名[行数][列数];<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://vault.taojie.fun:28089/i/2023/09/02/note4.%E7%AC%AC%E5%9B%9B%E5%91%A8-2023-06-24-00-40-55.png" alt="4.第四周-2023-06-24-00-40-55"></p>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 定义一个 3x4 的整数二维数组</span>
    <span class="token keyword">int</span> number<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化二维数组的元素</span>
    number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token comment">//在定义时初始化数组</span>
    <span class="token keyword">int</span> num<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>


    <span class="token comment">// 打印输出二维数组的元素</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"number:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> number<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="字符串与字符数组"><a href="#字符串与字符数组" class="headerlink" title="字符串与字符数组"></a>字符串与字符数组</h2><p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">/*字符数组赋初值*/</span>
    <span class="token keyword">char</span> cArr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token char">'I'</span><span class="token punctuation">,</span><span class="token char">'L'</span><span class="token punctuation">,</span><span class="token char">'O'</span><span class="token punctuation">,</span><span class="token char">'V'</span><span class="token punctuation">,</span><span class="token char">'E'</span><span class="token punctuation">,</span><span class="token char">'C'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">/*字符串赋初值
    编译时会自动在末尾增加一个 null 字符*/</span>
    <span class="token keyword">char</span> sArr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"ILOVEC"</span><span class="token punctuation">;</span>
    <span class="token comment">/*用sizeof（）求长度*/</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"cArr的长度=%d\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>cArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：cArr的长度=6</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sArr的长度=%d\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>sArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：sArr的长度=7</span>
    <span class="token comment">/*用strlen（）求长度*/</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"cArr的长度=%d\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>cArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：cArr的长度=12</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sArr的长度=%d\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>sArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出：sArr的长度=6</span>
    <span class="token comment">/*用printf的%s打印内容*/</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"cArr的内容=%s\n"</span><span class="token punctuation">,</span> cArr<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//输出：cArr的内容=ILOVECILOVEC</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sArr的内容=%s\n"</span><span class="token punctuation">,</span> sArr<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//输出：sArr的内容=ILOVEC</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>对于字符数组，其长度是固定的，其中任何一个数组元素都可以为 null 字符。因此，字符数组不一定是字符串。</li>
<li>对于字符串，它必须以 null 结尾，其后的字符不属于该字符串。字符串一定是字符数组，它是最后一个字符为 null 字符的字符数组。</li>
</ul>
<h2 id="函数的定义和调用"><a href="#函数的定义和调用" class="headerlink" title="函数的定义和调用"></a>函数的定义和调用</h2><p>函数定义的一般格式：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">返回值类型 函数名<span class="token punctuation">(</span>参数列表<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 函数体</span>
    <span class="token comment">// 执行特定的功能代码</span>
    <span class="token comment">// 可能包含 return 语句用于返回结果</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token comment">// 用户自定义函数，计算两个整数的和</span>
<span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用自定义函数</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The sum is: %d\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要注意以下几点：</p>
<ol>
<li>返回值类型：指定函数返回的结果的类型，可以是整数类型、浮点类型、字符类型或指针类型等。</li>
<li>函数名：用于标识函数的名称，在调用函数时使用该名称。</li>
<li>参数列表：列出函数接受的参数类型和参数名称，多个参数之间用逗号分隔。</li>
<li>函数体：包含了执行特定功能的代码，可以是一条或多条语句。</li>
<li>返回值：使用return语句将结果返回给调用者。返回值类型必须与函数定义中的返回值类型匹配。</li>
</ol>
<p>函数声明的用法：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token comment">// 函数声明</span>
<span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用自定义函数</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The sum is: %d\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 函数定义</span>
<span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="函数的值传递"><a href="#函数的值传递" class="headerlink" title="函数的值传递"></a>函数的值传递</h3><p>在 C 语言中，函数参数的传递方式是值传递（pass-by-value）。这意味着在函数调用时，实际参数的值会被复制给形式参数（函数定义中的参数），并在函数内部使用。因此，函数内部对形式参数的修改不会影响到实际参数的值。</p>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">modifyValue</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment">// 修改形式参数 x 的值</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Before function call: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//输出结果：Before function call: 5</span>

    <span class="token function">modifyValue</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用函数，传递实际参数 num</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"After function call: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//输出结果：After function call: 5</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要注意的是，如果实际参数是指针类型，函数可以通过指针间接地修改实际参数所指向的值。这是因为指针本身也是一个值，通过复制指针的值，函数可以访问和修改指针所指向的内存。但是，这并不改变值传递的本质，只是通过指针来间接地修改了实际参数的值。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">modifyValue</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment">// 通过指针修改实际参数的值</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Before function call: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">modifyValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 传递实际参数的地址作为指针参数</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"After function call: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="递归调用"><a href="#递归调用" class="headerlink" title="递归调用"></a>递归调用</h3><p>在 C 语言中，递归调用是指一个函数直接或间接地调用自身。递归调用通常用于解决可以分解为相同问题的子问题的情况，每次递归调用都在更小的范围内解决问题，直到达到终止条件。</p>
<p>下面是一个示例，演示了在 C 语言中使用递归调用计算斐波那契数列的第 n 个数字（斐波那契数列前11位：1，1，2，3，5，8，13，21，34，55，89）：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 终止条件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  
    <span class="token comment">// 递归调用</span>
    <span class="token keyword">return</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The %dth Fibonacci number is: %d\n"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="全局变量和局部变量"><a href="#全局变量和局部变量" class="headerlink" title="全局变量和局部变量"></a>全局变量和局部变量</h3><p>在C语言中，局部变量和全局变量是两种不同的变量类型，它们具有不同的作用域和生存周期。</p>
<ul>
<li><p>局部变量</p>
<ol>
<li>局部变量是在函数内部声明的变量，它只在函数的作用域内可见。</li>
<li>局部变量的作用域仅限于声明它的函数内部，函数执行结束后，局部变量将被销毁。</li>
<li>局部变量必须在使用之前先进行声明。</li>
<li>局部变量的生命周期随着函数的调用和执行而开始和结束。</li>
</ol>
<p>  示例代码：</p>
  <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment">// 局部变量 x</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Inside foo: %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// printf("%d\n", x);  // 错误，无法访问 foo 函数内的局部变量 x</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>全局变量</p>
<ol>
<li>全局变量是在函数外部声明的变量，它可以在整个程序的任何地方访问。</li>
<li>全局变量的作用域从声明开始，延伸到文件的末尾，可以在程序的任何地方使用和修改它。</li>
<li>全局变量在程序启动时创建，在程序结束时销毁。</li>
<li>全局变量可以在任何函数内部进行访问，但需要通过关键字 extern 进行声明。</li>
</ol>
<p>  示例代码：</p>
  <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> globalVar <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>  <span class="token comment">// 全局变量</span>

<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Inside foo: %d\n"</span><span class="token punctuation">,</span> globalVar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Inside main: %d\n"</span><span class="token punctuation">,</span> globalVar<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p> 需要注意的是，全局变量的使用应谨慎，因为全局变量的可见性和可修改性可能会导致程序的可维护性和可理解性下降。一般来说，应该尽量避免过度使用全局变量，而是优先使用局部变量来限制变量的作用范围，以提高代码的可读性和可维护性。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/16/c_program/3.%E7%AC%AC%E4%B8%89%E5%91%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/16/c_program/3.%E7%AC%AC%E4%B8%89%E5%91%A8/" class="post-title-link" itemprop="url">第三周</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-16 22:22:10" itemprop="dateCreated datePublished" datetime="2023-06-16T22:22:10+08:00">2023-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="C语言中的输入输出函数"><a href="#C语言中的输入输出函数" class="headerlink" title="C语言中的输入输出函数"></a>C语言中的输入输出函数</h2><p>C语言有很多函数能够实现各种信息的输入和输出，信息的输入主要来源是标准输入（键盘），信息的输出主要目标是标准输出（屏幕），下面介绍几种常见的输入输出函数。</p>
<h3 id="printf和scanf"><a href="#printf和scanf" class="headerlink" title="printf和scanf"></a>printf和scanf</h3><ol>
<li><p>printf用于将数据格式化输出到标准输出（通常是屏幕）</p>
<p> printf函数原型如下：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> printf() 函数接受一个格式化字符串<code>format</code>和可变数量的参数，根据格式化字符串中的占位符将参数格式化为字符串并输出到标准输出（通常是控制台）。返回值为输出的字符数。</p>
<p> 常见的格式化占位符以及含义：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">%d：输出有符号十进制整数。
%u：输出无符号十进制整数。
%f：输出浮点数。
%c：输出字符。
%s：输出字符串。
%x：输出无符号十六进制整数。
%o：输出无符号八进制整数。
%e：以指数形式输出浮点数。
%p：输出指针的地址。
%%：输出一个百分号。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 创建test.c文件并编辑以下代码，注释部分为运行结果：</p>
 <pre class="line-numbers language-c" data-language="c"><div class="caption"><span>print用法示例</span></div><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> pi <span class="token operator">=</span> <span class="token number">3.14159</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'A'</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Hello, World!"</span><span class="token punctuation">;</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Integer: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//Integer: 10</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Float: %.2f\n"</span><span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//Float: 3.14</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Integer: %d\nFloat: %.2f\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Character: %c\n"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//Character: A</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"String: %s\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//String: Hello, World!</span>

<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>scanf用于从标准输入（通常是键盘）读取格式化的数据</p>
<p> scanf原型如下：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> scanf() 函数接受一个格式化字符串<code>format</code>和对应的参数列表，根据格式化字符串中的占位符从输入流中读取数据，并将读取到的数据存储到对应的变量中。返回值为成功读取的变量的数量。</p>
<p> 创建test.c文件并编辑以下代码：</p>
 <pre class="line-numbers language-c" data-language="c"><div class="caption"><span>scanf用法示例</span></div><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    <span class="token keyword">float</span> pi<span class="token punctuation">;</span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    <span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter an integer: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter a float: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%f"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter a character: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">" %c"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter a string: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Integer: %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Float: %.2f\n"</span><span class="token punctuation">,</span> pi<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Character: %c\n"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"String: %s\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">Enter an integer: 10
Enter a float: 10.1
Enter a character: d
Enter a string: string
Integer: 10
Float: 10.10
Character: d
String: string<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="getchar和putchar"><a href="#getchar和putchar" class="headerlink" title="getchar和putchar"></a>getchar和putchar</h3><ol>
<li><p>getchar用于从输入流中读取单个字符</p>
<p> getchar函数原型如下：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> getchar() 函数没有参数，它从标准输入（通常是键盘）读取一个字符，并返回读取到的字符的ASCII码值（作为整数）。</p>
<p> 创建test.c文件并编辑以下代码：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> ch<span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter a character: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ch <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You entered: %c\n"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">Enter a character: d
You entered: d

Enter a character: dd
You entered: d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>putchar用于将一个字符输出到标准输出（通常是屏幕）</p>
<p> putchar函数原型如下：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> putchar()函数接受一个整数参数<code>c</code>，它表示要输出的字符的ASCII码值。函数将该字符输出到标准输出，并返回输出的字符。</p>
<p> 创建test.c文件并编辑以下代码：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'A'</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Character: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putchar</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
 <pre class="line-numbers language-text" data-language="text"><code class="language-text">Character: A
 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="其他输入输出函数"><a href="#其他输入输出函数" class="headerlink" title="其他输入输出函数"></a>其他输入输出函数</h3><ul>
<li><p>标准输入输出（stdio.h库）：</p>
<ul>
<li>printf()：用于将数据格式化输出到标准输出（通常是控制台）。</li>
<li>scanf()：用于从标准输入（键盘）读取格式化的数据。</li>
<li>getchar()：用于从标准输入（键盘）读取单个字符。</li>
<li>puts()：用于将字符串输出到标准输出（控制台）并自动换行。</li>
<li>gets()：用于从标准输入（键盘）读取字符串（已被弃用，请使用 fgets()）。</li>
</ul>
</li>
<li><p>文件输入输出（stdio.h库）：</p>
<ul>
<li>fopen()：打开文件并返回文件指针。</li>
<li>fclose()：关闭文件。</li>
<li>fprintf()：将数据格式化输出到文件。</li>
<li>fscanf()：从文件读取格式化的数据。</li>
<li>fgets()：从文件读取一行字符串。</li>
</ul>
</li>
<li><p>字符输入输出（ctype.h库）：</p>
<ul>
<li>putc()：将一个字符写入指定的文件。</li>
<li>getc()：从指定的文件读取一个字符。</li>
</ul>
</li>
<li><p>格式化输出（stdarg.h库）：</p>
<ul>
<li>sprintf()：将数据格式化输出到字符串。</li>
<li>printf()：将数据格式化输出到字符串或标准输出。</li>
</ul>
</li>
</ul>
<h2 id="控制语句：分支和跳转"><a href="#控制语句：分支和跳转" class="headerlink" title="控制语句：分支和跳转"></a>控制语句：分支和跳转</h2><h3 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h3><p>if语句的语法格式：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span><span class="token punctuation">(</span>boolean_expression<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
   <span class="token comment">/* 如果布尔表达式为真将执行的语句 */</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果布尔表达式为 true，则 if 语句内的代码块将被执行。如果布尔表达式为 false，则 if 语句结束后的第一组代码（闭括号后）将被执行。<br>C 语言把任何非零和非空的值假定为 true，把零或 null 假定为 false。</p>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num<span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter a number: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The number is positive.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The number is negative.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The number is zero.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以使用各种类型的运算符来构建表达式：</p>
<ol>
<li><p>关系运算符：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 执行代码块</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>逻辑运算符：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c">    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 执行代码块</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>位运算符：</p>
 <pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> flags <span class="token operator">=</span> <span class="token number">0</span>b1011<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&amp;</span> <span class="token number">0</span>b1000<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 执行代码块</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="switch语句"><a href="#switch语句" class="headerlink" title="switch语句"></a>switch语句</h3><p><code>switch</code>语句是C语言中用于多路分支的控制语句，它根据表达式的值，选择性地执行与每个选项相关联的代码块。以下是<code>switch</code>语句的基本用法：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">switch</span> <span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> constant1<span class="token operator">:</span>
        <span class="token comment">// 与 constant1 相关的代码块</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> constant2<span class="token operator">:</span>
        <span class="token comment">// 与 constant2 相关的代码块</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token comment">// 更多的 case 分支...</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token comment">// 默认情况的代码块</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>switch</code>语句包含以下几个部分：</p>
<ol>
<li><p><code>expression</code>：一个表达式，其结果将与每个case分支的常量值进行比较。</p>
</li>
<li><p><code>case</code>分支：每个case后面跟着一个常量表达式，用于与expression进行比较。如果expression的值与某个case的常量值匹配，将执行与该case相关联的代码块。</p>
</li>
<li><p><code>break</code>语句：在每个case分支的代码块结束时使用break语句，以终止switch语句的执行。如果忽略了break语句，将会发生”穿透”现象，即会继续执行下一个case分支中的代码块，直到遇到break或switch语句结束。</p>
</li>
<li><p><code>default</code>分支：在所有的case分支都不匹配时，将执行default分支中的代码块。default是可选的，可以省略。</p>
</li>
</ol>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> choice<span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter a number between 1 and 3: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>choice<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>choice<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You selected option 1.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You selected option 2.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You selected option 3.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Invalid option.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Enter a number between 1 and 3: 2
You selected option 2.

Enter a number between 1 and 3: 5
Invalid option.

Enter a number between 1 and 3: 2.1
You selected option 2.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="控制语句：循环"><a href="#控制语句：循环" class="headerlink" title="控制语句：循环"></a>控制语句：循环</h2><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>for循环是C语言中常用的一种迭代控制结构，它可以用于重复执行一段代码块，且提供了更灵活的循环控制。以下是for循环的语法：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span>initialization<span class="token punctuation">;</span> condition<span class="token punctuation">;</span> increment<span class="token operator">/</span>decrement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 循环体代码块</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>for循环包含以下四个部分：</p>
<ol>
<li><p>initialization：在循环开始前执行的初始化表达式，用于初始化循环计数器或其他变量。</p>
</li>
<li><p>condition：在每次循环迭代前进行判断的条件表达式。只有当条件为真时，循环体中的代码块才会执行。如果条件为假，循环将结束，程序将继续执行循环后的代码。</p>
</li>
<li><p>increment&#x2F;decrement：在每次循环迭代后执行的增量或减量操作。它用于更新循环计数器或其他变量的值，以控制循环的进程。</p>
</li>
<li><p>循环体代码块：在 for 循环的花括号内部，是需要重复执行的代码块。这些代码将按照循环条件和增量&#x2F;减量操作的规则反复执行。</p>
</li>
</ol>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Count: %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Count: 1
Count: 2
Count: 3
Count: 4
Count: 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要注意的是，for循环的各个部分都是可选的。如果省略了某个部分，相应的功能将被忽略，但循环仍然可以正常工作。例如，可以省略初始化表达式或增量操作，只保留条件表达式，以及在循环体内手动控制循环变量的更新。这样的灵活性使得for循环非常适用于各种迭代场景。</p>
<h3 id="while循环和do-while循环"><a href="#while循环和do-while循环" class="headerlink" title="while循环和do-while循环"></a>while循环和do-while循环</h3><p><code>while</code>循环是C语言中的一种迭代控制结构，它用于重复执行一段代码块，只要给定的条件为真。以下是<code>while</code>循环的语法</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">while</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 循环体代码块</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>while 循环包含以下两个部分：</p>
<ol>
<li><p>condition：一个条件表达式，用于判断循环是否继续执行。如果条件为真，循环将继续执行循环体中的代码块；如果条件为假，循环将结束，程序将继续执行循环后的代码。</p>
</li>
<li><p>循环体代码块：在 while 循环的花括号内部，是需要重复执行的代码块。这些代码将反复执行，直到条件为假。</p>
</li>
</ol>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Count: %d\n"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在上述示例中，<code>while</code>循环的条件是<code>count&lt;5</code>，只要<code>count</code>的值小于5，循环体中的代码块将被重复执行。每次循环，<code>count</code>的值会递增，并打印出当前的值。当<code>count</code>的值达到或超过5时，条件为假，循环结束。</p>
<p>需要注意的是，如果条件一开始就为假，循环体中的代码块将不会执行，循环将被跳过。因此，在使用<code>while</code>循环时，请确保循环条件能够在某个时刻变为假，以避免陷入无限循环。通常，在循环体中需要修改条件表达式或使用控制语句（如<code>break</code>）来终止循环。</p>
<h3 id="continue语句和break语句"><a href="#continue语句和break语句" class="headerlink" title="continue语句和break语句"></a>continue语句和break语句</h3><p>continue语句用于跳过当前循环迭代中剩余的代码，直接进行下一次迭代。它的作用是终止当前迭代的剩余代码，然后重新开始下一次循环迭代。continue语句通常与条件语句结合使用，用于在满足特定条件时跳过当前迭代。</p>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 当 i 等于 3 时跳过当前迭代</span>
        <span class="token punctuation">&#125;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Count: %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Count: 1
Count: 2
Count: 4
Count: 5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>在上述示例中，当<code>i</code>等于<code>3</code>时，<code>continue</code>语句将跳过<code>printf</code>语句，直接进入下一次循环迭代。因此，输出结果中不会包含数字<code>3</code>。</p>
<p><code>break</code>语句用于完全终止当前的循环，不再执行循环中的任何代码，并跳出循环体继续执行循环后的代码。它通常与条件语句结合使用，用于在满足特定条件时提前结束循环。</p>
<p>创建test.c文件，编辑以下代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 当 i 等于 3 时终止循环</span>
        <span class="token punctuation">&#125;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Count: %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>gcc -o test test.c</code>命令编译后使用<code>./test</code>运行代码，按提示信息输入相应类型的数据：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Count: 1
Count: 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>在上述示例中，当<code>i</code>等于<code>3</code>时，<code>break</code>语句将完全终止循环，不再执行任何循环代码。因此，输出结果中只包含数字<code>1</code>和<code>2</code>，循环在此处结束。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/16/linux_shell/12.%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86/" class="post-title-link" itemprop="url">项目实战集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-16 21:36:20" itemprop="dateCreated datePublished" datetime="2023-06-16T21:36:20+08:00">2023-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ping命令"><a href="#ping命令" class="headerlink" title="ping命令"></a>ping命令</h2><p>Linux ping 命令用于检测主机。</p>
<p>执行 ping 指令会使用 ICMP 传输协议，发出要求回应的信息，若远端主机的网络功能没有问题，就会回应该信息，因而得知该主机运作正常。</p>
<pre class="line-numbers language-test" data-language="test"><code class="language-test">-d 使用Socket的SO_DEBUG功能。
-c &lt;完成次数&gt; 设置完成要求回应的次数。
-f 极限检测。
-i&lt;间隔秒数&gt; 指定收发信息的间隔时间。
-I&lt;网络界面&gt; 使用指定的网络接口送出数据包。
-l&lt;前置载入&gt; 设置在送出要求信息之前，先行发出的数据包。
-n 只输出数值。
-p&lt;范本样式&gt; 设置填满数据包的范本样式。
-q 不显示指令执行过程，开头和结尾的相关信息除外。
-r 忽略普通的Routing Table，直接将数据包送到远端主机上。
-R 记录路由过程。
-s&lt;数据包大小&gt; 设置数据包的大小。
-t&lt;存活数值&gt; 设置存活数值TTL的大小。
-v 详细显示指令的执行过程。
-w &lt;deadline&gt; 在 deadline 秒后退出。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="服务器状态检测脚本"><a href="#服务器状态检测脚本" class="headerlink" title="服务器状态检测脚本"></a>服务器状态检测脚本</h2><p>使用for循环判断主机是否存活：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">ip_list</span><span class="token operator">=</span><span class="token string">"192.168.1.1 127.0.0.1 0.0.0.0"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">ip</span> <span class="token keyword">in</span> <span class="token variable">$ip_list</span>
<span class="token keyword">do</span>
        <span class="token keyword">for</span> <span class="token for-or-select variable">count</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">do</span>
                <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-w1</span> <span class="token variable">$ip</span> <span class="token operator">&amp;></span>/dev/null
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is ok"</span>
                        <span class="token builtin class-name">break</span>
                <span class="token keyword">fi</span>
        <span class="token keyword">done</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-eq</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is failure"</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用while循环判断主机是否存活：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment">#ip_list="192.168.1.1 127.0.0.1 0.0.0.0"</span>

<span class="token keyword">while</span> <span class="token builtin class-name">read</span> <span class="token function">ip</span>
<span class="token keyword">do</span>
        <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1</span>
        <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-le</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">do</span>
                <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-w1</span> <span class="token variable">$ip</span> <span class="token operator">&amp;></span>/dev/null
                <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is ok"</span>
                        <span class="token builtin class-name">break</span>
                <span class="token keyword">fi</span>
                <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$count<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>
        <span class="token keyword">done</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$count</span> <span class="token parameter variable">-eq</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ip</span> ping is failure"</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span> <span class="token operator">&lt;</span>ip.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Nginx日志参数"><a href="#Nginx日志参数" class="headerlink" title="Nginx日志参数"></a>Nginx日志参数</h2><table>
<thead>
<tr>
<th>变量名称</th>
<th>变量描述</th>
<th>举例说明</th>
</tr>
</thead>
<tbody><tr>
<td>$remote_addr</td>
<td>客户端地址</td>
<td>113.140.15.90</td>
</tr>
<tr>
<td>$remote_user</td>
<td>客户端用户名称</td>
<td>–</td>
</tr>
<tr>
<td>$time_local</td>
<td>访问时间和时区</td>
<td>18&#x2F;Jul&#x2F;2012:17:00:01 +0800</td>
</tr>
<tr>
<td>$request</td>
<td>请求的URI和HTTP协议</td>
<td>“GET &#x2F;pa&#x2F;img&#x2F;home&#x2F;logo-alipay-t.png HTTP:&#x2F;1.1″</td>
</tr>
<tr>
<td>$http_host</td>
<td>请求地址，即浏览器中你输入的地址（IP或域名）</td>
<td>img.alipay.com10.253.70.103</td>
</tr>
<tr>
<td>$status</td>
<td>HTTP请求状态</td>
<td>200</td>
</tr>
<tr>
<td>$upstream_status</td>
<td>upstream状态</td>
<td>200</td>
</tr>
<tr>
<td>$body_bytes_sent</td>
<td>发送给客户端文件内容大小</td>
<td>547</td>
</tr>
<tr>
<td>$http_referer</td>
<td>跳转来源</td>
<td>“<a target="_blank" rel="noopener" href="https://cashier.alip/ay.com%E2%80%A6/%E2%80%9D">https://cashier.alip/ay.com…/”</a></td>
</tr>
<tr>
<td>$http_user_agent</td>
<td>用户终端代理</td>
<td>“Mozilla&#x2F;4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident&#x2F;4.0; SV1; GTB7.0; .NET4.0C;</td>
</tr>
<tr>
<td>$ssl_protocol</td>
<td>SSL协议版本</td>
<td>TLSv1</td>
</tr>
<tr>
<td>$ssl_cipher</td>
<td>交换数据中的算法</td>
<td>RC4-SHA</td>
</tr>
<tr>
<td>$upstream_addr</td>
<td>后台upstream的地址，即真正提供服务的主机地址</td>
<td>10.228.35.247:80</td>
</tr>
<tr>
<td>$request_time</td>
<td>整个请求的总时间</td>
<td>0.205</td>
</tr>
<tr>
<td>$upstream_response_time</td>
<td>请求过程中，upstream响应时间</td>
<td>0.002</td>
</tr>
</tbody></table>
<h2 id="xargs命令"><a href="#xargs命令" class="headerlink" title="xargs命令"></a>xargs命令</h2><p><code>xargs</code>是给命令传递参数的一个过滤器，也是组合多个命令的一个工具。</p>
<p><code>xargs</code>可以将管道或标准输入（stdin）数据转换成命令行参数，也能够从文件的输出中读取数据。</p>
<h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>定界符<span class="token operator">></span>：指定输入项的定界符，默认为换行符。
<span class="token parameter variable">-I</span> <span class="token operator">&lt;</span>占位符<span class="token operator">></span>：指定替代字符串，用于替换命令中的参数位置。
<span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>数量<span class="token operator">></span>：指定每次执行的参数数量。
-t：显示实际执行的命令。
-p：提示用户确认是否执行命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="通过cat命令理解xargs用法"><a href="#通过cat命令理解xargs用法" class="headerlink" title="通过cat命令理解xargs用法"></a>通过<code>cat</code>命令理解<code>xargs</code>用法</h3><ul>
<li><p>原始文件</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@sh:~<span class="token comment"># cat file.txt</span>
file1
file2
file3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过管道符号讲标准输出转换为标准输入传递给cat</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@sh:~<span class="token comment"># cat file.txt|cat</span>
file1
file2
file3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过管道符号和xargs将标准输出转换为参数传递给cat</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@sh:~<span class="token comment"># cat file.txt|xargs cat</span>
cat: file1: No such <span class="token function">file</span> or directory
cat: file2: No such <span class="token function">file</span> or directory
cat: file3: No such <span class="token function">file</span> or directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><ol>
<li><p>查找并打包日志</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"*.log"</span> <span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">tar</span> <span class="token parameter variable">-cvzf</span> log.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>对日志文件进行文字查找</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-name</span> <span class="token string">"*.log"</span> <span class="token operator">|</span><span class="token function">xargs</span> <span class="token function">grep</span> <span class="token parameter variable">-n</span> <span class="token string">"error"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>批量创建目录</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span>  /var/log <span class="token parameter variable">-maxdepth</span> <span class="token number">1</span> <span class="token parameter variable">-type</span> d <span class="token operator">|</span><span class="token function">xargs</span> <span class="token parameter variable">-I</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token function">mkdir</span> .<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="uniq命令"><a href="#uniq命令" class="headerlink" title="uniq命令"></a>uniq命令</h2><p>Linux uniq命令用于检查及删除文本文件中重复出现的行列，一般与 sort 命令结合使用。</p>
<p>uniq命令可检查文本文件中重复出现的行列。</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-c或--count 在每列旁边显示该行重复出现的次数。
-d或--repeated 仅显示重复出现的行列。
-f&lt;栏位>或--skip-fields=&lt;栏位> 忽略比较指定的栏位。
-s&lt;字符位置>或--skip-chars=&lt;字符位置> 忽略比较指定的字符。
-u或--unique 仅显示出一次的行列。
-w&lt;字符位置>或--check-chars=&lt;字符位置> 指定要比较的字符。
--help 显示帮助。
--version 显示版本信息。
[输入文件] 指定已排序好的文本文件。如果不指定此项，则从标准读取数据；
[输出文件] 指定输出的文件。如果不指定此选项，则将内容显示到标准输出设备（显示终端）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>文本文件包含以下内容：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Copy code
apple
banana
apple
orange
orange
apple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用<code>uniq -c</code>命令来统计重复行的次数：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">uniq</span> <span class="token parameter variable">-c</span> data.txt
      <span class="token number">1</span> apple
      <span class="token number">1</span> banana
      <span class="token number">2</span> apple
      <span class="token number">2</span> orange
      <span class="token number">1</span> apple<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出的每一行都包含两部分：重复行的次数和该行的内容。在上面的示例中，第一行的<code>apple</code>只出现了一次，第二行的<code>banana</code>只出现了一次，第三行的<code>apple</code>出现了两次，以此类推。</p>
<h2 id="多机部署MySQL"><a href="#多机部署MySQL" class="headerlink" title="多机部署MySQL"></a>多机部署MySQL</h2><h3 id="实验环境搭建"><a href="#实验环境搭建" class="headerlink" title="实验环境搭建"></a>实验环境搭建</h3><ol>
<li><p>配置<code>centos</code>虚拟机网络</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## 配置ip地址和子网掩码</span>
<span class="token function">sudo</span> <span class="token function">ifconfig</span> <span class="token punctuation">[</span>网口名<span class="token punctuation">]</span> <span class="token punctuation">[</span>ip<span class="token punctuation">]</span>/24
<span class="token comment">## 配置默认网关</span>
<span class="token function">sudo</span> route <span class="token function">add</span> default gw <span class="token punctuation">[</span>网关<span class="token punctuation">]</span>
<span class="token function">ping</span> baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>本项目通过docker搭建实验环境，首先需要在<code>centos7</code>虚拟机中安装<code>docker</code><br>运行以下命令使用官方安装脚本自动安装Docker</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>启动docker服务</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">docker</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>通过镜像<code>linuxserver/openssh-server</code>创建多个主机</p>
<ol>
<li><p>创建主机1，默认ssh端口号2222，主机名设置为host1，外部ssh端口号2221</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> host1<span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD_ACCESS</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_PASSWORD</span><span class="token operator">=</span>password <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span>demo <span class="token punctuation">\</span>
 <span class="token parameter variable">-p</span> <span class="token number">2221</span>:2222 lscr.io/linuxserver/openssh-server:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建主机2，默认ssh端口号2222，主机名设置为host2，外部ssh端口号2222</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> host2 <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD_ACCESS</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_PASSWORD</span><span class="token operator">=</span>password <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span>demo <span class="token punctuation">\</span>
 <span class="token parameter variable">-p</span> <span class="token number">2222</span>:2222 lscr.io/linuxserver/openssh-server:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>创建主机3，默认ssh端口号2222，主机名设置为host3，外部ssh端口号2223</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> host3 <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD_ACCESS</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_PASSWORD</span><span class="token operator">=</span>password <span class="token punctuation">\</span>
 <span class="token parameter variable">-e</span> <span class="token assign-left variable">USER_NAME</span><span class="token operator">=</span>demo <span class="token punctuation">\</span>
 <span class="token parameter variable">-p</span> <span class="token number">2223</span>:2222 lscr.io/linuxserver/openssh-server:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
</li>
<li><p>通过<code>sudo docker ps</code>查看容器信息</p>
<p> <img src="/%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0%EF%BC%9A%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98%E9%9B%86%20b1f29f1f66bb4b5791f43d861b5bb655/Untitled.png" alt="Untitled"></p>
</li>
<li><p>容器常用命令</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">## 查看当前运行的容器状态</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span>

<span class="token comment">## 停止容器</span>
<span class="token function">sudo</span> <span class="token function">docker</span> stop 容器名

<span class="token comment">## 删除容器</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">rm</span> 容器名

<span class="token comment">## 进入正在运行的容器</span>
<span class="token function">sudo</span> <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 容器名 /bin/bash

<span class="token comment">##从容器中退出</span>
exit或者使用快捷键CTRL + p 然后CTRL + q<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>通过<code>ping -p 2221 localhost</code>验证centos和容器之间的网络</p>
</li>
<li><p>通过<code>ssh -p 2221 demo@localhost</code>验证ssh服务，使用用户名<code>demo</code>和密码<code>password</code>登录容器，在容器内使用exit断开ssh连接。</p>
</li>
</ol>
<h3 id="推送公钥到各个主机"><a href="#推送公钥到各个主机" class="headerlink" title="推送公钥到各个主机"></a>推送公钥到各个主机</h3><ul>
<li><p>ssh密钥登录原理</p>
<p>  我们一般使用 PuTTY 等 SSH 客户端来远程管理 Linux 服务器。但是，一般的密码方式登录，容易有密码被暴力破解的问题。所以，一般我们会将 SSH 的端口设置为默认的 22 以外的端口，或者禁用 root 账户登录。其实，有一个更好的办法来保证安全，而且让你可以放心地用 root 账户从远程登录——那就是通过密钥方式登录。</p>
<p>  密钥形式登录的原理是：利用密钥生成器制作一对密钥——一只公钥和一只私钥。将公钥添加到服务器的某个账户上，然后在客户端利用私钥即可完成认证并登录。</p>
</li>
</ul>
<ol>
<li><code>ssh-keygen</code>制作密钥对</li>
<li><code>ls ~/.ssh</code>查看密钥文件</li>
<li><code>ssh-copy-id -p 2221 demo@localhost</code> 推送公钥到目标主机</li>
<li><code>ssh -p 2221 demo@localhost</code>验证密钥登录</li>
</ol>
<h3 id="批量推送公钥"><a href="#批量推送公钥" class="headerlink" title="批量推送公钥"></a>批量推送公钥</h3><ol>
<li><p>centos虚拟机安装expect工具</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token function">expect</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> <code>expect</code> 是一个用于自动化交互式命令行工具的工具集，它可以用于编写脚本来处理需要与外部程序进行交互的场景。以下是 <code>expect</code> 常用的命令和用法：</p>
<ol>
<li><p><code>spawn</code>：启动一个新的进程并与其进行交互。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">spawn <span class="token function">ssh</span> user@hostname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 上述命令将启动一个 SSH 连接，并与远程主机进行交互。</p>
</li>
<li><p><code>expect</code>：匹配预期的输出或交互，并执行相应的操作。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">expect</span> <span class="token string">"password:"</span>
send <span class="token string">"mypassword<span class="token entity" title="\r">\r</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 上述命令会等待输出中出现 “password:”，然后发送密码。</p>
</li>
<li><p><code>send</code>：向进程发送字符串。</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">send <span class="token string">"ls<span class="token entity" title="\r">\r</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 上述命令会发送 “ls” 命令给进程。</p>
</li>
</ol>
</li>
<li><p>批量推送公钥脚本</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">port_list</span><span class="token operator">=</span><span class="token string">"2221 2223"</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"password"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">$port_list</span>
<span class="token keyword">do</span>
        /usr/bin/expect <span class="token parameter variable">-c</span> <span class="token string">"
                spawn ssh-copy-id -p <span class="token variable">$i</span> demo@localhost
                expect &#123;
                <span class="token entity" title="\&quot;">\"</span>*connecting<span class="token entity" title="\&quot;">\"</span> &#123; send <span class="token entity" title="\&quot;">\"</span>yes<span class="token entity" title="\r">\r</span><span class="token entity" title="\&quot;">\"</span>; exp_continue &#125; &#125;
                expect &#123;
                <span class="token entity" title="\&quot;">\"</span>*password<span class="token entity" title="\&quot;">\"</span> &#123; send <span class="token entity" title="\&quot;">\"</span><span class="token variable">$password</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\&quot;">\"</span>; exp_continue &#125; &#125;
                expect eof
                "</span>
<span class="token keyword">done</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="多机部署MySQL脚本"><a href="#多机部署MySQL脚本" class="headerlink" title="多机部署MySQL脚本"></a>多机部署MySQL脚本</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">port_list</span><span class="token operator">=</span><span class="token string">"2221 2222 2223"</span>
<span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"password"</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable">$port_list</span>
<span class="token keyword">do</span>
        <span class="token function">ping</span> <span class="token parameter variable">-c1</span> <span class="token parameter variable">-w1</span> <span class="token parameter variable">-p</span> <span class="token variable">$i</span> localhost
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                /usr/bin/expect <span class="token parameter variable">-c</span> <span class="token string">"
                spawn ssh -p <span class="token variable">$i</span> demo@localhost <span class="token entity" title="\&quot;">\"</span>sudo apk add mysql mysql-client<span class="token entity" title="\&quot;">\"</span>      
                expect &#123;
                <span class="token entity" title="\&quot;">\"</span>*password<span class="token entity" title="\&quot;">\"</span> &#123; send <span class="token entity" title="\&quot;">\"</span><span class="token variable">$password</span><span class="token entity" title="\r">\r</span><span class="token entity" title="\&quot;">\"</span>;exp_continue&#125;&#125;
                expect eof
                "</span>
        <span class="token keyword">fi</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/16/linux_shell/11.%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/06/16/linux_shell/11.%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC%E6%9E%84%E5%BB%BA/" class="post-title-link" itemprop="url">系统资源性能瓶颈脚本构建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-16 21:35:08" itemprop="dateCreated datePublished" datetime="2023-06-16T21:35:08+08:00">2023-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-03 13:17:06" itemprop="dateModified" datetime="2023-09-03T13:17:06+08:00">2023-09-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="常见的系统性能分析工具"><a href="#常见的系统性能分析工具" class="headerlink" title="常见的系统性能分析工具"></a>常见的系统性能分析工具</h2><ul>
<li>为什么利用Shell脚本进行系统资源性能分析<ol>
<li>在系统性能分析中，我们需要收集大量的数据并进行分析，而手动操作比较繁琐且容易出错，而且不易重复。使用shell脚本可以自动化执行这些操作，提高效率和准确性。</li>
<li>由于shell脚本的灵活性和可编程性，可以根据不同需求和环境对脚本进行维护和扩展，实现各种不同的性能分析操作，可以大大提高工作效率和准确性。</li>
</ol>
</li>
</ul>
<h3 id="vmstat"><a href="#vmstat" class="headerlink" title="vmstat"></a>vmstat</h3><p>vmstat是一个用于Linux系统的性能分析工具，它能够实时地监测CPU、内存、I&#x2F;O、交换分区等系统性能数据，并将这些数据以一定的时间间隔（默认为2秒）输出到终端或日志文件中，提供给用户进行分析和优化。</p>
<ul>
<li><p>vmstat输出信息含义：</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">r：等待运行的进程数目，即运行队列长度；
b：处于不可中断状态（blocked）的进程数目；
swpd：使用虚拟内存的大小，单位为KB；
free：空闲物理内存的大小，单位为KB；
buff：用作缓存的内存大小，单位为KB；
cache：用作缓存的页缓存的大小，单位为KB；
si：从磁盘交换入的内存大小，单位为KB/s；
so：向磁盘交换出的内存大小，单位为KB/s；
bi：从块设备读取的块数，单位为块/s；
bo：向块设备写入的块数，单位为块/s；
in：每秒中断数，包括时钟中断；
cs：每秒上下文切换次数；
us：用户进程占用CPU时间百分比；
sy：系统内核占用CPU时间百分比；
id：CPU空闲时间百分比；
wa：等待I/O完成时间百分比;
st：虚拟机占用CPU时间百分比；<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查看系统的整体性能信息： <code>vmstat</code></p>
</li>
<li><p>每隔一段时间查看系统的整体性能信息： <code>vmstat 5 1</code></p>
</li>
<li><p>输出带有时间戳的系统整体性能信息： <code>vmstat -t</code></p>
</li>
<li><p>显示磁盘信息： <code>vmstat -d</code></p>
</li>
<li><p>显示指定的硬盘分区状态： <code>vmstat -p disk part</code></p>
</li>
<li><p>修改输出信息的单位： <code>vmstat -S M</code></p>
</li>
</ul>
<h3 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h3><p>iostat是一个常用的性能分析工具，它可以监测CPU、磁盘、网络等系统资源的使用情况。</p>
<ul>
<li><p>输出信息含义：</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">rrqm/s：    每秒合并读操作的次数
wrqm/s：    每秒合并写操作的次数
r/s：       每秒读操作的次数 （IOPS）
w/s：       每秒写操作的次数 （IOPS）
rMB/s：     每秒读带宽
wMB/s：     每秒写带宽
avgrq-sz：  I/O请求的平均大小（扇区数）
avgqu-sz：  I/O请求队列的平均长度
await：     每个I/O平均耗时，单位是ms，这个时间包括I/O在队列中等待耗时，以及最终被磁盘设备处理的时间
r_await：   每个读操作的平均耗时
w_await：   每个写操作的平均耗时
%util：     该磁盘设备的繁忙度，该设备有I/O（即非空闲）的时间比率，不考虑I/O有多少，只考虑有没有。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>iostat常见选项：</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">-c 表示显示cpu使用情况，默认不写也会显示cpu使用情况
-d 表示显示磁盘使用情况，默认不写也会显示disk使用情况
-h  友好显示
-x 表示显示额外的统计信息
-k 表示以kb为单位显示磁盘请求数
-m 表示以M为单位显示磁盘请求数
-V 显示版本信
-p  [磁盘] 显示磁盘和分区的情况<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p><code>netstat</code> 是一个用于显示网络连接、路由表、网络接口状态等网络相关信息的命令行工具。它可用于查看当前系统的网络状态、连接情况以及网络性能信息。</p>
<ul>
<li><p>常见选项以及含义</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-a</span> <span class="token punctuation">(</span>all<span class="token punctuation">)</span>显示所有选项，默认不显示LISTEN相关
<span class="token parameter variable">-t</span> <span class="token punctuation">(</span>tcp<span class="token punctuation">)</span>仅显示tcp相关选项
<span class="token parameter variable">-u</span> <span class="token punctuation">(</span>udp<span class="token punctuation">)</span>仅显示udp相关选项
<span class="token parameter variable">-n</span> 拒绝显示别名，能显示数字的全部转化成数字。
<span class="token parameter variable">-l</span> 仅列出有在 Listen <span class="token punctuation">(</span>监听<span class="token punctuation">)</span> 的服務状态
<span class="token parameter variable">-p</span> 显示建立相关链接的程序名
<span class="token parameter variable">-r</span> 显示路由信息，路由表
<span class="token parameter variable">-e</span> 显示扩展信息，例如uid等
<span class="token parameter variable">-s</span> 按各个协议进行统计
<span class="token parameter variable">-c</span> 每隔一个固定时间，执行该netstat命令。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>Linux ps （英文全拼：process status）命令用于显示当前进程的状态，类似于 windows 的任务管理器。</p>
<ul>
<li><p>ps命令常用选项</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">-A 列出所有的进程
-w 显示加宽可以显示较多的资讯
-au 显示较详细的资讯
-aux 显示所有包含其他使用者的进程<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>ps命令输出字段含义</p>
  <pre class="line-numbers language-text" data-language="text"><code class="language-text">USER: 行程拥有者
PID: pid
%CPU: 占用的 CPU 使用率
%MEM: 占用的记忆体使用率
VSZ: 占用的虚拟记忆体大小
RSS: 占用的记忆体大小
TTY: 终端的次要装置号码 (minor device number of tty)
STAT: 该行程的状态:

D: 无法中断的休眠状态 (通常 IO 的进程)
R: 正在执行中
S: 静止状态
T: 暂停执行
Z: 不存在但暂时无法消除
W: 没有足够的记忆体分页可分配
&lt;: 高优先序的行程
N: 低优先序的行程
L: 有记忆体分页分配并锁在记忆体内 (实时系统或捱A I/O)
START: 行程开始时间
TIME: 执行的时间
COMMAND:所执行的指令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="Shell基础回顾"><a href="#Shell基础回顾" class="headerlink" title="Shell基础回顾"></a>Shell基础回顾</h2><h3 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h3><ul>
<li>引用用户变量和环境变量</li>
<li>命令替换</li>
<li>从键盘读入赋值</li>
</ul>
<h3 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">function</span> 函数名 <span class="token punctuation">&#123;</span>
    函数体
<span class="token punctuation">&#125;</span>

函数名<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    函数体
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="if条件测试"><a href="#if条件测试" class="headerlink" title="if条件测试"></a>if条件测试</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> condition <span class="token punctuation">]</span>
<span class="token keyword">then</span>
 commands
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>condition可以判断三种条件：</p>
<ol>
<li><p>文件比较</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-43-25.png" alt="3.Shell条件测试-2023-06-16-20-43-25"></p>
</li>
<li><p>字符串比较</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-20-46-41.png" alt="3.Shell条件测试-2023-06-16-20-46-41"></p>
</li>
<li><p>数值比较</p>
<p> <img src="https://vault.taojie.fun:28089/i/2023/09/02/note3.Shell%E6%9D%A1%E4%BB%B6%E6%B5%8B%E8%AF%95-2023-06-16-21-06-44.png" alt="3.Shell条件测试-2023-06-16-21-06-44"></p>
</li>
</ol>
<ul>
<li><p>if多条件测试：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token variable"><span class="token punctuation">((</span> a <span class="token operator">></span> b <span class="token punctuation">))</span></span> <span class="token operator">&amp;&amp;</span> <span class="token variable"><span class="token punctuation">((</span> a <span class="token operator">&lt;</span> c <span class="token punctuation">))</span></span> 
或者
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$a</span> <span class="token operator">></span> <span class="token variable">$b</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$a</span> <span class="token operator">&lt;</span> <span class="token variable">$c</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> 
或者 
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$a</span> <span class="token parameter variable">-gt</span> <span class="token variable">$b</span> <span class="token parameter variable">-a</span> <span class="token variable">$a</span> <span class="token parameter variable">-lt</span> <span class="token variable">$c</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">while</span> <span class="token punctuation">[</span> 条件 <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    循环体
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中，<code>条件</code>是一个可以执行的测试命令或表达式，如果返回值为0，则为真，循环继续执行；否则为假，循环结束。</p>
<p>例如，下面的代码中，<code>while</code> 循环会一直执行，直到变量 <code>i</code> 的值达到 5：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-le</span> <span class="token number">5</span> <span class="token punctuation">]</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"当前变量的值是 <span class="token variable">$i</span>"</span>
    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $i <span class="token operator">+</span> <span class="token number">1</span> <span class="token variable">))</span></span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> 变量名 <span class="token keyword">in</span> 列表
<span class="token keyword">do</span>
    循环体
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Shell脚本其他用法"><a href="#Shell脚本其他用法" class="headerlink" title="Shell脚本其他用法"></a>Shell脚本其他用法</h3><h3 id="select-in"><a href="#select-in" class="headerlink" title="select in"></a>select in</h3><p>select in 循环用来增强交互性，它可以显示出带编号的菜单，用户输入不同的编号就可以选择不同的菜单，并执行不同的功能。</p>
<p>Shell select in 循环的用法如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">select</span> <span class="token for-or-select variable">variable</span> <span class="token keyword">in</span> value_list
<span class="token keyword">do</span>
    statements
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>实例：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">"What is your favourite OS?"</span>
<span class="token keyword">select</span> <span class="token for-or-select variable">name</span> <span class="token keyword">in</span> <span class="token string">"Linux"</span> <span class="token string">"Windows"</span> <span class="token string">"Mac OS"</span> <span class="token string">"UNIX"</span> <span class="token string">"Android"</span>
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token variable">$name</span>
<span class="token keyword">done</span>
<span class="token builtin class-name">echo</span> <span class="token string">"You have selected <span class="token variable">$name</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>select in 通常和  <code>case in</code> 一起使用，在用户输入不同的编号时可以做出不同的反应。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">"What is your favourite OS?"</span>
<span class="token keyword">select</span> <span class="token for-or-select variable">name</span> <span class="token keyword">in</span> <span class="token string">"Linux"</span> <span class="token string">"Windows"</span> <span class="token string">"Mac OS"</span> <span class="token string">"UNIX"</span> <span class="token string">"Android"</span>
<span class="token keyword">do</span>
    <span class="token keyword">case</span> <span class="token variable">$name</span> <span class="token keyword">in</span>
        <span class="token string">"Linux"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"Linux是一个类UNIX操作系统，它开源免费，运行在各种服务器设备和嵌入式设备。"</span>
            <span class="token builtin class-name">break</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"Windows"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"Windows是微软开发的个人电脑操作系统，它是闭源收费的。"</span>
            <span class="token builtin class-name">break</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"Mac OS"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"Mac OS是苹果公司基于UNIX开发的一款图形界面操作系统，只能运行与苹果提供的硬件之上。"</span>
            <span class="token builtin class-name">break</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"UNIX"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"UNIX是操作系统的开山鼻祖，现在已经逐渐退出历史舞台，只应用在特殊场合。"</span>
            <span class="token builtin class-name">break</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token string">"Android"</span><span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"Android是由Google开发的手机操作系统，目前已经占据了70%的市场份额。"</span>
            <span class="token builtin class-name">break</span>
            <span class="token punctuation">;</span><span class="token punctuation">;</span>
        *<span class="token punctuation">)</span>
            <span class="token builtin class-name">echo</span> <span class="token string">"输入错误，请重新输入"</span>
    <span class="token keyword">esac</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="echo-e"><a href="#echo-e" class="headerlink" title="echo -e"></a>echo -e</h3><p>在 shell 脚本中，可以使用 <code>echo</code> 命令输出信息，但是默认情况下输出的文本是单色的，可能不够直观。如果要在输出中使用颜色，可以使用 <code>echo -e</code> 命令。</p>
<p><code>echo -e</code> 可以解析特定的转义序列，其中包括用于设置文本颜色的序列。常用的文本颜色序列如下：</p>
<ul>
<li><code>\033[0m</code>：重置所有属性，包括颜色。</li>
<li><code>\033[30m</code> - <code>\033[37m</code>：设置前景色为黑色到白色。</li>
<li><code>\033[40m</code> - <code>\033[47m</code>：设置背景色为黑色到白色。</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[31mThis is red text<span class="token entity" title="\033">\033</span>[0m"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="和-区别"><a href="#和-区别" class="headerlink" title="$和${}区别"></a>$和${}区别</h3><p><code>$</code> 符号后跟变量名，表示对变量进行简单的替换。例如，<code>$var</code> 表示将变量 <code>var</code> 的值替换到命令中或输出中。这种形式适用于大多数简单的变量替换场景。</p>
<p><code>$&#123;&#125;</code> 是一种更加复杂的语法形式，它可以用于更精确地定义变量扩展的边界。<code>$&#123;&#125;</code> 可以用于以下情况：</p>
<ol>
<li>明确指定变量的边界：<code>$&#123;var&#125;</code> 表示变量 <code>var</code> 的边界，可用于区分变量名与紧随其后的字符。这在与其他字符连接时特别有用，例如<code>$&#123;var&#125;name</code>。</li>
<li>执行变量替换时，<code>$&#123;&#125;</code> 可以使用更复杂的表达式，例如变量的默认值、字符串替换、命令替换等。示例：<code>$&#123;var:-default&#125;</code>、<code>$&#123;var/foo/bar&#125;</code>、<code>$&#123;var//pattern/replacement&#125;</code>。</li>
</ol>
<p>下面是一些<code>$&#123;&#125;</code>的用法示例：</p>
<ul>
<li>变量替换：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Alice"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Hello, <span class="token variable">$&#123;name&#125;</span>!"</span>  <span class="token comment"># 输出：Hello, Alice!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>指定变量边界：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"Hello,"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$&#123;text&#125;</span>world"</span>  <span class="token comment"># 输出：Hello, !</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>默认值设定：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Hello, <span class="token variable">$&#123;name<span class="token operator">:-</span>Guest&#125;</span>!"</span>  <span class="token comment"># 输出：Hello, Guest!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>字符串替换：</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">text</span><span class="token operator">=</span><span class="token string">"Hello, world!"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$&#123;text<span class="token operator">/</span>world<span class="token operator">/</span>Universe&#125;</span>"</span>  <span class="token comment"># 输出：Hello, Universe!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>$&#123;&#125;</code> 可以根据需要组合和嵌套，用于更复杂的变量操作和替换。它提供了更大的灵活性和精确性，使变量扩展更加强大。</p>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>Linux sort 命令用于将文本文件内容加以排序。</p>
<p>sort 可针对文本文件的内容，以行为单位来排序。</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-b 忽略每行前面开始出的空格字符。
-c 检查文件是否已经按照顺序排序。
-d 排序时，处理英文字母、数字及空格字符外，忽略其他的字符。
-f 排序时，将小写字母视为大写字母。
-i 排序时，除了040至176之间的ASCII字符外，忽略其他的字符。
-m 将几个排序好的文件进行合并。
-M 将前面3个字母依照月份的缩写进行排序。
-n 依照数值的大小排序。
-u 意味着是唯一的(unique)，输出的结果是去完重了的。
-o&lt;输出文件> 将排序后的结果存入指定的文件。
-r 以相反的顺序来排序。
-t&lt;分隔字符> 指定排序时所用的栏位分隔字符。
+&lt;起始栏位>-&lt;结束栏位> 以指定的栏位来排序，范围由起始栏位到结束栏位的前一栏位。
--help 显示帮助。
--version 显示版本信息。
[-k field1[,field2]] 按指定的列进行排序。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>用法举例</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">##原始文件</span>
$ <span class="token function">cat</span> testfile      <span class="token comment"># testfile文件原有排序  </span>
<span class="token builtin class-name">test</span> <span class="token number">30</span>  
Hello <span class="token number">95</span>  
Linux <span class="token number">85</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  使用sort默认的排序方式</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sort</span> testfile <span class="token comment"># 重排结果  </span>
Hello <span class="token number">95</span>  
Linux <span class="token number">85</span>  
<span class="token builtin class-name">test</span> <span class="token number">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>  使用 -k 参数设置对第二列的值进行重排，结果如下：</p>
  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sort</span> testfile <span class="token parameter variable">-k</span> <span class="token number">2</span>
<span class="token builtin class-name">test</span> <span class="token number">30</span>  
Linux <span class="token number">85</span> 
Hello <span class="token number">95</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="awk工具扩展"><a href="#awk工具扩展" class="headerlink" title="awk工具扩展"></a>awk工具扩展</h2><h3 id="awk内的for循环"><a href="#awk内的for循环" class="headerlink" title="awk内的for循环"></a>awk内的for循环</h3><p>在Awk中，for循环用于迭代执行一系列的操作。Awk中的for循环有两种形式：基于条件的for循环和基于集合的for循环。</p>
<ol>
<li><p>基于条件的for循环：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token punctuation">(</span>初始化<span class="token punctuation">;</span> 条件<span class="token punctuation">;</span> 迭代<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># 循环体</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p> 初始化在循环开始前执行，条件在每次迭代前进行检查，如果条件为真，则执行循环体，迭代在每次循环体执行完后执行。</p>
</li>
<li><p>基于集合的for循环：</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token punctuation">(</span>变量 <span class="token keyword">in</span> 集合<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># 循环体</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p>在awk中，数组是一种常用的数据结构，用于存储和操作数据。</p>
<ol>
<li>声明数组：使用<code>arrayName[index] = value</code>语法来声明数组，并将指定的索引位置赋值为对应的值。例如：<code>fruits[0] = &quot;apple&quot;</code>。</li>
<li>访问数组元素：使用<code>arrayName[index]</code>语法来访问数组的特定元素。例如：<code>fruits[0]</code>表示访问数组<code>fruits</code>中索引为0的元素。</li>
<li>遍历数组：可以使用<code>for (index in arrayName)</code>语法来遍历数组中的所有元素。</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F: <span class="token string">'&#123;shells[$NF]++&#125; END&#123;for (i in shells)&#123;print i,shells[i]&#125;&#125;'</span> /etc/passwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="第一节课代码"><a href="#第一节课代码" class="headerlink" title="第一节课代码"></a>第一节课代码</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#</span>
<span class="token function-name function">os_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-e</span> /etc/redhat-release <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token assign-left variable">REDHAT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/redhat-release <span class="token operator">|</span><span class="token function">cut</span> -d<span class="token string">' '</span> <span class="token parameter variable">-f1</span><span class="token variable">`</span></span>
        <span class="token keyword">else</span>
                <span class="token assign-left variable">DEBIAN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/issue <span class="token operator">|</span><span class="token function">cut</span> -d<span class="token string">' '</span> <span class="token parameter variable">-f1</span><span class="token variable">`</span></span>
        <span class="token keyword">fi</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$REDHAT</span>"</span> <span class="token operator">==</span> <span class="token string">"CentOS"</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$REDHAT</span>"</span> <span class="token operator">==</span> <span class="token string">"Red"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token assign-left variable">P_M</span><span class="token operator">=</span>yum
        <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$DEBIAN</span>"</span> <span class="token operator">==</span> <span class="token string">"Ubuntu"</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$DEBIAN</span>"</span> <span class="token operator">==</span> <span class="token string">"ubutnu"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token assign-left variable">P_M</span><span class="token operator">=</span>apt-get
        <span class="token keyword">else</span>
                <span class="token builtin class-name">echo</span><span class="token string">"Operating system does not support."</span>
                <span class="token builtin class-name">exit</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">#查看登录的用户是否为 root</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token environment constant">$LOGNAME</span> <span class="token operator">!=</span> root <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"Please use the root account operation."</span>
        <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
<span class="token comment">#查看是否存在 vmstat 命令</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">which</span> <span class="token function">vmstat</span> <span class="token operator">&amp;></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"vmstat command not found, now the install."</span>
        <span class="token function">sleep</span> <span class="token number">1</span>
        os_check
        <span class="token variable">$P_M</span> <span class="token function">install</span> procps <span class="token parameter variable">-y</span>
        <span class="token builtin class-name">echo</span>    <span class="token string">"-----------------------------------------------------------------
        ------"</span>
<span class="token keyword">fi</span>
<span class="token comment">#查看是否有 iostat 命令</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token function">which</span> iostat <span class="token operator">&amp;></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"iostat command not found, now the install."</span>
        <span class="token function">sleep</span> <span class="token number">1</span>
        os_check
        <span class="token variable">$P_M</span> <span class="token function">install</span> sysstat <span class="token parameter variable">-y</span>
        <span class="token builtin class-name">echo</span>   <span class="token string">"------------------------------------------------------------------
        -----"</span>
<span class="token keyword">fi</span>
<span class="token comment">#打印菜单</span>
<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token keyword">select</span> <span class="token for-or-select variable">input</span> <span class="token keyword">in</span> cpu_load disk_load disk_use disk_inode mem_use tcp_status cpu_top10 mem_top10 traffic quit<span class="token punctuation">;</span> <span class="token keyword">do</span>
                <span class="token keyword">case</span> <span class="token variable">$input</span> <span class="token keyword">in</span>
                        cpu_load<span class="token punctuation">)</span>
                                <span class="token comment">#CPU 利用率与负载</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"-----------------------------------------------------"</span>
                                <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span>
                                <span class="token keyword">while</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-le</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
                                        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\033">\033</span>[32m 参考值<span class="token variable">$&#123;i&#125;</span><span class="token entity" title="\033">\033</span>[0m"</span>
                                        <span class="token assign-left variable">UTIL</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;if(NR==3)print 100-$15"%"&#125;'</span><span class="token variable">`</span></span>
                                        <span class="token assign-left variable"><span class="token environment constant">USER</span></span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;if(NR==3)print $13"%"&#125;'</span><span class="token variable">`</span></span>
                                        <span class="token assign-left variable">SYS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;if(NR==3)print $14"%"&#125;'</span><span class="token variable">`</span></span>
                                        <span class="token assign-left variable">IOWAIT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'&#123;if(NR==3)print $16"%"&#125;'</span><span class="token variable">`</span></span>
                                        <span class="token builtin class-name">echo</span> <span class="token string">"Util: <span class="token variable">$UTIL</span>"</span>
                                        <span class="token builtin class-name">echo</span> <span class="token string">"User use: <span class="token environment constant">$USER</span>"</span>
                                        <span class="token builtin class-name">echo</span> <span class="token string">"System use: <span class="token variable">$SYS</span>"</span>
                                        <span class="token builtin class-name">echo</span> <span class="token string">"I/O wait: <span class="token variable">$IOWAIT</span>"</span> 
                                        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span>
                                        <span class="token function">sleep</span> <span class="token number">1</span>
                                <span class="token keyword">done</span>
                                <span class="token builtin class-name">echo</span> <span class="token string">"  -------------------------------------------------------"</span>
                                <span class="token builtin class-name">break</span>
                                <span class="token punctuation">;</span><span class="token punctuation">;</span>
                        quit<span class="token punctuation">)</span>
                                <span class="token builtin class-name">exit</span> <span class="token number">0</span>
                                <span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token keyword">esac</span>
        <span class="token keyword">done</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/source/index.md/page/2/">2</a><a class="page-number" href="/source/index.md/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/source/index.md/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
